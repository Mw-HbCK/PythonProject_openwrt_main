<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bandix Monitor - Áî®Êà∑‰∏≠ÂøÉ (ÊµãËØï‰øÆÊîπ)</title>
    <style>
        /* CSSÂèòÈáèÂÆö‰πâ - ‰∫ÆËâ≤‰∏ªÈ¢ò */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e0e0e0;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --text-inverse: #ffffff;
            --border-color: #e0e0e0;
            --border-color-light: #eee;
            --accent-color: #667eea;
            --accent-hover: #764ba2;
            --success-bg: #efe;
            --success-text: #3c3;
            --success-border: #cfc;
            --error-bg: #fee;
            --error-text: #c33;
            --error-border: #fcc;
            --shadow: rgba(0,0,0,0.3);
            --shadow-accent: rgba(102, 126, 234, 0.3);
            --shadow-hover: rgba(102, 126, 234, 0.4);
            --status-online: #28a745;
            --status-offline: #dc3545;
            --btn-secondary-bg: #6c757d;
            --btn-secondary-hover: #5a6268;
            --card-info-bg: #e3f2fd;
        }
        
        /* CSSÂèòÈáèÂÆö‰πâ - ÊöóËâ≤‰∏ªÈ¢ò */
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #404040;
            --bg-gradient: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-tertiary: #808080;
            --text-inverse: #ffffff;
            --border-color: #404040;
            --border-color-light: #333333;
            --accent-color: #667eea;
            --accent-hover: #7c8fee;
            --success-bg: #1e3a1e;
            --success-text: #4ade80;
            --success-border: #22c55e;
            --error-bg: #3a1e1e;
            --error-text: #f87171;
            --error-border: #ef4444;
            --shadow: rgba(0,0,0,0.5);
            --shadow-accent: rgba(102, 126, 234, 0.4);
            --shadow-hover: rgba(102, 126, 234, 0.5);
            --status-online: #22c55e;
            --status-offline: #ef4444;
            --btn-secondary-bg: #4a5568;
            --btn-secondary-hover: #5a6268;
            --card-info-bg: #1e3a52;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* ÁæéÂåñÊªöÂä®Êù° - Firefox */
            scrollbar-width: thin;
            scrollbar-color: #667eea var(--bg-secondary);
        }
        
        /* ÁæéÂåñÊªöÂä®Êù° - WebkitÊµèËßàÂô® (Chrome, Safari, Edge) */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            border: 2px solid var(--bg-secondary);
            transition: background 0.3s ease;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        
        /* ÊöóËâ≤‰∏ªÈ¢ò‰∏ãÁöÑÊªöÂä®Êù° */
        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }
        
        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            border-color: var(--bg-tertiary);
        }
        
        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
        }
        
        [data-theme="dark"] * {
            scrollbar-color: #4a5568 var(--bg-tertiary);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        body.user-center-active {
            align-items: flex-start;
        }
        
        .container {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: 0 20px 60px var(--shadow);
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px;
            transition: background 0.3s ease;
        }
        
        .login-container {
            max-width: 500px;
            margin: 0 auto;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: var(--text-primary);
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .form-group {
            margin-bottom: 24px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
            transition: color 0.3s ease;
        }
        
        .form-group:focus-within label {
            color: var(--accent-color);
        }
        
        input,
        select,
        textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: inherit;
        }
        
        input:hover,
        select:hover,
        textarea:hover {
            border-color: var(--accent-color);
        }
        
        input[type="number"],
        input[type="datetime-local"],
        select {
            font-size: 14px;
            padding: 12px 16px;
            cursor: pointer;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.12), 0 2px 8px rgba(102, 126, 234, 0.15);
            transform: translateY(-1px);
        }
        
        input[type="number"]:focus,
        input[type="datetime-local"]:focus,
        select:focus {
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.12), 0 2px 8px rgba(102, 126, 234, 0.15);
        }
        
        input::placeholder {
            color: var(--text-tertiary);
            opacity: 0.7;
        }
        
        button {
            width: 100%;
            padding: 14px 24px;
            background: var(--bg-gradient);
            color: var(--text-inverse);
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.3px;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--shadow-hover);
        }
        
        button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 4px 12px var(--shadow-hover);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .link {
            text-align: center;
            margin-top: 20px;
            color: var(--text-secondary);
        }
        
        .link a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 500;
        }
        
        .link a:hover {
            text-decoration: underline;
        }
        
        .error {
            background: var(--error-bg);
            color: var(--error-text);
            padding: 16px 20px;
            border-radius: 10px;
            margin-bottom: 24px;
            border-left: 4px solid var(--error-border);
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.15);
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .error::before {
            content: '‚ö†Ô∏è';
            font-size: 20px;
        }
        
        .success {
            background: var(--success-bg);
            color: var(--success-text);
            padding: 16px 20px;
            border-radius: 10px;
            margin-bottom: 24px;
            border-left: 4px solid var(--success-border);
            box-shadow: 0 2px 8px rgba(60, 200, 60, 0.15);
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .success::before {
            content: '‚úÖ';
            font-size: 20px;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ‰∏ªÂ∏ÉÂ±ÄÊ†∑Âºè */
        .main-layout {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        /* ‰æßËæπÊ†èÊ†∑Âºè */
        .sidebar {
            width: 220px;
            min-width: 220px;
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 12px 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
            height: fit-content;
            position: sticky;
            top: 20px;
            border: 1px solid var(--border-color-light);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        /* Ê†áÁ≠æÈ°µÊ†∑ÂºèÔºà‰æßËæπÊ†èÊåâÈíÆÔºâ */
        .tab {
            padding: 14px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-secondary);
            border-left: 4px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            text-align: left;
            white-space: nowrap;
            position: relative;
            margin: 2px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .tab::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: var(--accent-color);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.1;
            border-radius: 0 8px 8px 0;
        }
        
        .tab:hover {
            color: var(--accent-color);
            background: var(--bg-primary);
            padding-left: 24px;
            transform: translateX(4px);
        }
        
        .tab:hover::before {
            width: 100%;
        }
        
        .tab.active {
            color: var(--accent-color);
            background: var(--bg-primary);
            border-left-color: var(--accent-color);
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
            padding-left: 24px;
        }
        
        .tab.active::before {
            width: 100%;
        }
        
        /* ‰∏ªÂÜÖÂÆπÂå∫Âüü */
        .main-content {
            flex: 1;
            min-width: 0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* APIÊñáÊ°£ÈìæÊé•Ê†∑ÂºèÔºà‰æßËæπÊ†èÔºâ */
        .api-doc-link {
            margin-top: auto;
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            border-left: 3px solid transparent;
            border-top: 1px solid var(--border-color);
            transition: all 0.3s;
            white-space: nowrap;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: 0;
            margin-right: 0;
            margin-bottom: 0;
            width: 100%;
            text-align: left;
        }
        
        .api-doc-link:hover {
            color: var(--accent-color);
            background: var(--bg-primary);
            text-decoration: none;
        }
        
        .api-doc-link-icon {
            font-size: 16px;
        }
        
        
        .user-info {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color-light);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .user-info:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .user-info h2 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .info-item {
            margin-bottom: 15px;
        }
        
        .info-item label {
            font-weight: 600;
            color: var(--text-secondary);
            display: block;
            margin-bottom: 5px;
        }
        
        .token-box {
            background: var(--bg-primary);
            padding: 14px 16px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: var(--text-primary);
            position: relative;
            transition: all 0.3s ease;
            line-height: 1.6;
        }
        
        .token-box:hover {
            border-color: var(--accent-color);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }
        
        .copy-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: var(--accent-color);
            font-size: 14px;
        }
        
        .user-info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding: 12px 0;
        }
        
        .user-info-header .username-display {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .user-info-header .logout-btn {
            padding: 8px 16px !important;
            font-size: 13px !important;
            width: auto;
        }
        
        .actions {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .actions button {
            margin-bottom: 0;
            width: auto;
            padding: 8px 16px !important;
            font-size: 13px !important;
        }
        
        .btn-secondary {
            background: var(--btn-secondary-bg);
        }
        
        .btn-secondary:hover {
            background: var(--btn-secondary-hover);
        }
        
        /* Êï∞ÊçÆÊü•ËØ¢Ê†∑Âºè */
        .data-query-content {
            padding: 0;
        }
        
        .controls {
            padding: 24px 0;
            border-bottom: 2px solid var(--border-color-light);
            display: flex;
            gap: 20px;
            align-items: flex-end;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }
        
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .control-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color-light);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
            transition: border-color 0.3s;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .control-group select:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .btn-query {
            padding: 12px 22px;
            background: var(--bg-gradient);
            color: var(--text-inverse);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            letter-spacing: 0.3px;
        }
        
        .btn-query:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-hover);
        }
        
        .btn-query:active {
            transform: translateY(0);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color-light);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--accent-color);
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }
        
        .stat-card .label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border-color-light);
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            background: var(--bg-primary);
        }
        
        .table-container::-webkit-scrollbar {
            height: 8px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 0 0 12px 12px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--bg-primary);
        }
        
        thead {
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th {
            padding: 16px 18px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        tbody tr {
            transition: all 0.2s ease;
        }
        
        tbody tr:nth-child(even) {
            background: var(--bg-secondary);
            opacity: 0.5;
        }
        
        td {
            padding: 14px 18px;
            border-bottom: 1px solid var(--border-color-light);
            color: var(--text-primary);
        }
        
        tbody tr:hover {
            background: var(--bg-secondary) !important;
            opacity: 1 !important;
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        tbody tr:last-child td {
            border-bottom: none;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
            padding: 20px;
            flex-wrap: wrap;
        }
        
        .pagination button {
            padding: 10px 18px;
            border: 2px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: auto;
            font-weight: 500;
            font-size: 14px;
        }
        
        .pagination button:hover:not(:disabled) {
            background: var(--accent-color);
            color: var(--text-inverse);
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .pagination button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .pagination button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .pagination .page-info {
            padding: 10px 20px;
            color: var(--text-secondary);
        }
        
        .loading {
            text-align: center;
            padding: 60px 40px;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .loading .loading-spinner {
            margin: 0;
        }
        
        .empty {
            text-align: center;
            padding: 60px 40px;
            color: var(--text-tertiary);
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }
        
        .empty::before {
            content: 'üì≠';
            font-size: 48px;
            opacity: 0.5;
        }
        
        /* ‰ª™Ë°®ÁõòÊ†∑Âºè */
        .dashboard-controls {
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color-light);
            display: flex;
            gap: 20px;
            align-items: flex-end;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background: var(--bg-gradient);
            border-radius: 16px;
            padding: 28px;
            color: var(--text-inverse);
            box-shadow: 0 8px 24px var(--shadow-accent), 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px var(--shadow-hover), 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .dashboard-card:hover::before {
            left: 100%;
        }
        
        .dashboard-card .card-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .dashboard-card .card-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .dashboard-card .card-unit {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 400;
        }
        
        .dashboard-card .card-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .dashboard-section {
            margin-bottom: 30px;
        }
        
        .dashboard-section h2 {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: 600;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }
        
        .dashboard-section h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }
        
        .system-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: 5px;
            transition: background 0.3s ease;
        }
        
        .status-label {
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .status-value {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        #rankingTable {
            width: 100%;
            margin-top: 15px;
        }
        
        #rankingTable th {
            background: var(--bg-secondary);
            font-weight: 600;
        }
        
        .device-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .device-status.online {
            background: var(--status-online);
        }
        
        .device-status.offline {
            background: var(--status-offline);
        }
        
        /* RadioÊåâÈíÆÊ†∑Âºè‰ºòÂåñ */
        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .radio-option {
            position: relative;
            flex: 1;
            min-width: 200px;
        }
        
        @media (max-width: 768px) {
            .radio-option {
                min-width: 100%;
            }
        }
        
        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            width: 0;
            height: 0;
        }
        
        .radio-option label {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0;
        }
        
        .radio-option label:hover {
            border-color: var(--accent-color);
            background: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        .radio-option input[type="radio"]:checked + label {
            border-color: var(--accent-color);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            color: var(--accent-color);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        .radio-option label::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            margin-right: 12px;
            display: inline-block;
            position: relative;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .radio-option input[type="radio"]:checked + label::before {
            border-color: var(--accent-color);
            background: var(--accent-color);
            box-shadow: 0 0 0 4px var(--bg-primary), 0 0 0 6px var(--accent-color);
        }
        
        .radio-option label::after {
            content: '';
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--bg-primary);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .radio-option input[type="radio"]:checked + label::after {
            opacity: 1;
        }
        
        /* CheckboxÊ†∑Âºè‰ºòÂåñ */
        .checkbox-container,
        label.checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            margin-bottom: 0;
        }
        
        .checkbox-container input[type="checkbox"],
        label.checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0;
            margin-right: 8px;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-primary);
            position: relative;
            flex-shrink: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .checkbox-container input[type="checkbox"]:hover,
        label.checkbox-label input[type="checkbox"]:hover {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .checkbox-container input[type="checkbox"]:checked,
        label.checkbox-label input[type="checkbox"]:checked {
            background: var(--accent-color);
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }
        
        .checkbox-container input[type="checkbox"]:checked::after,
        label.checkbox-label input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
        }
        
        .checkbox-container input[type="checkbox"]:focus,
        label.checkbox-label input[type="checkbox"]:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        .checkbox-container input[type="checkbox"]:disabled,
        label.checkbox-label input[type="checkbox"]:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--bg-secondary);
        }
        
        .checkbox-container span,
        label.checkbox-label span {
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Êó•ÂøóÊü•ÁúãÂô®Ê†∑Âºè */
        .log-line {
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        
        .log-error {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--error-text);
        }
        
        .log-warning {
            background-color: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }
        
        .log-info {
            background-color: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        
        .log-debug {
            background-color: rgba(107, 114, 128, 0.1);
            color: var(--text-secondary);
        }
        
        /* ÈÖçÁΩÆÁÆ°ÁêÜ‰∏âÁ∫ßÂØºËà™Ê†∑Âºè */
        .config-nav-sidebar {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .config-nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: row;
            gap: 10px;
            flex-wrap: nowrap;
            overflow-x: auto;
        }
        
        .config-nav-item {
            padding: 10px 20px;
            background: transparent;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
            min-width: 120px;
        }
        
        .config-nav-item:hover {
            background: var(--bg-primary);
            border-color: var(--accent-color);
            color: var(--accent-color);
            transform: translateY(-1px);
        }
        
        .config-nav-item.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--text-inverse);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .config-section {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        
        .config-section.active {
            display: block;
        }
        
        .config-content-area {
            background: transparent;
        }
        
        /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content {
            background: var(--bg-primary);
            padding: 32px;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color-light);
        }
        
        .modal-content h2 {
            margin-top: 0;
            color: var(--text-primary);
        }
        
        .modal-form-group {
            margin-bottom: 20px;
        }
        
        .modal-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .modal-form-group input,
        .modal-form-group select,
        .modal-form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .modal-form-group input:focus,
        .modal-form-group select:focus,
        .modal-form-group textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .modal-form-group small {
            color: var(--text-secondary);
            font-size: 12px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .modal-button {
            padding: 10px 20px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-button:hover {
            background: var(--bg-secondary);
        }
        
        .modal-button-primary {
            background: var(--bg-gradient);
            color: var(--text-inverse);
            border: none;
        }
        
        .modal-button-primary:hover {
            box-shadow: 0 2px 8px var(--shadow-hover);
        }
        
        /* Ê¥ªÂä®ÂëäË≠¶Ê†è */
        .active-alerts-bar {
            background: var(--error-bg);
            border: 1px solid var(--error-border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .active-alerts-bar h3 {
            color: var(--error-text);
            margin-bottom: 10px;
        }
        
        .active-alert-item {
            padding: 8px 12px;
            margin-bottom: 8px;
            background: var(--bg-primary);
            border-radius: 4px;
            border-left: 4px solid var(--error-border);
        }
        
        .active-alert-item:last-child {
            margin-bottom: 0;
        }
        
        /* Âä†ËΩΩÂä®Áîª */
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-container {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .loading-container .loading-spinner {
            margin-bottom: 15px;
        }
        
        /* È™®Êû∂Â±è */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-tertiary) 50%, var(--bg-secondary) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
            border-radius: 4px;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-text {
            height: 16px;
            margin-bottom: 10px;
        }
        
        .skeleton-title {
            height: 24px;
            width: 60%;
            margin-bottom: 20px;
        }
        
        /* ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆ */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            padding: 10px;
            width: 44px;
            height: 44px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 2px 8px var(--shadow);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        
        .theme-toggle:hover {
            background: var(--bg-secondary);
            transform: scale(1.05);
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .main-layout {
                flex-direction: column;
                gap: 15px;
            }
            
            .sidebar {
                width: 100%;
                min-width: unset;
                position: static;
                padding: 10px 0;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .api-doc-link {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .api-doc-link span:not(.api-doc-link-icon) {
                display: inline;
            }
            
            .main-content {
                width: 100%;
            }
            
            .controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .control-group {
                width: 100%;
                min-width: unset;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .system-status-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            table {
                min-width: 600px;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
                max-height: 95vh;
            }
            
            .theme-toggle {
                top: 10px;
                right: 10px;
                padding: 8px;
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .modal-buttons {
                flex-direction: column;
            }
            
            .modal-button {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .dashboard-card {
                padding: 20px;
            }
            
            .dashboard-card .card-value {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆ -->
    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="ÂàáÊç¢‰∏ªÈ¢ò">
        üåô
    </button>
    
    <!-- ÁôªÂΩï/Ê≥®ÂÜåË°®Âçï -->
    <div id="authContainer" class="container login-container">
        <div id="loginForm">
            <h1>Áî®Êà∑ÁôªÂΩï</h1>
            <div id="message"></div>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Áî®Êà∑Âêç</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">ÂØÜÁ†Å</label>
                    <input type="password" id="password" name="password" autocomplete="current-password" required>
                </div>
                <button type="submit">ÁôªÂΩï</button>
            </form>
            <div class="link">
                ËøòÊ≤°ÊúâË¥¶Âè∑Ôºü<a href="#" onclick="showRegister(); return false;">Á´ãÂç≥Ê≥®ÂÜå</a>
            </div>
        </div>
        
        <div id="registerForm" style="display: none;">
            <h1>Áî®Êà∑Ê≥®ÂÜå</h1>
            <div id="register-message"></div>
            <form id="register-form">
                <div class="form-group">
                    <label for="reg-username">Áî®Êà∑Âêç</label>
                    <input type="text" id="reg-username" name="username" required minlength="3">
                </div>
                <div class="form-group">
                    <label for="reg-password">ÂØÜÁ†Å</label>
                    <input type="password" id="reg-password" name="password" autocomplete="new-password" required minlength="6">
                </div>
                <button type="submit">Ê≥®ÂÜå</button>
            </form>
            <div class="link">
                Â∑≤ÊúâË¥¶Âè∑Ôºü<a href="#" onclick="showLogin(); return false;">Á´ãÂç≥ÁôªÂΩï</a>
            </div>
            </div>
        </div>
        
    <!-- Áî®Êà∑‰∏≠ÂøÉ -->
    <div id="userCenter" class="container" style="display: none;">
        <h1>Bandix Monitor - Áî®Êà∑‰∏≠ÂøÉ</h1>
            <div id="user-message"></div>
        
        <!-- ‰æßËæπÊ†èÂíå‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-layout">
            <!-- ‰æßËæπÊ†èÂØºËà™ -->
            <div class="sidebar">
                <button class="tab active" onclick="switchTab('userInfo')">üë§ Áî®Êà∑‰ø°ÊÅØ</button>
                <button class="tab" onclick="switchTab('dashboard')">üìä ÂÆûÊó∂ÁõëÊéß</button>
                <button class="tab" onclick="switchTab('charts')">üìà Êï∞ÊçÆÂõæË°®</button>
                <button class="tab" onclick="switchTab('statistics')">üìä ÁªüËÆ°ÂàÜÊûê</button>
                <button class="tab" onclick="switchTab('dataManagement')">üóÑÔ∏è Êï∞ÊçÆÁÆ°ÁêÜ</button>
                <button class="tab" onclick="switchTab('reportManagement')">üìã Êä•Ë°®ÁÆ°ÁêÜ</button>
                <button class="tab" onclick="switchTab('alerts')">üîî ÂëäË≠¶ÁÆ°ÁêÜ</button>
                <button class="tab" onclick="switchTab('dataQuery')">üìä Êï∞ÊçÆÊü•ËØ¢</button>
                <button class="tab" onclick="switchTab('config')" id="configTabBtn" style="display: none;">‚öôÔ∏è ÈÖçÁΩÆÁÆ°ÁêÜ</button>
                <button class="tab" onclick="switchTab('userManagement')" id="userManagementTabBtn" style="display: none;">üë• Áî®Êà∑ÁÆ°ÁêÜ</button>
                <button class="tab" onclick="switchTab('apiStats')" id="apiStatsTabBtn" style="display: none;">üìä APIÁªüËÆ°</button>
                <button class="tab" onclick="switchTab('mysqlManagement')" id="mysqlManagementTabBtn" style="display: none;">üóÑÔ∏è MySQLÁÆ°ÁêÜ</button>
                <a href="/api/docs" target="_blank" class="api-doc-link" title="Êü•ÁúãAPIÊñáÊ°£">
                    <span class="api-doc-link-icon">üìö</span>
                    <span>APIÊñáÊ°£</span>
                </a>
            </div>
            
            <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
            <div class="main-content">
                <!-- Áî®Êà∑‰ø°ÊÅØÊ†áÁ≠æÈ°µ -->
        <div id="userInfoTab" class="tab-content active">
            <div id="user-info-header" class="user-info-header"></div>
            <div id="user-info" class="user-info"></div>
            <div class="actions">
                <button class="copy-btn" onclick="refreshToken()">Âà∑Êñ∞ Token</button>
            </div>
        </div>
        
        <!-- ÂÆûÊó∂ÁõëÊéß‰ª™Ë°®ÁõòÊ†áÁ≠æÈ°µ -->
        <div id="dashboardTab" class="tab-content">
            <div class="data-query-content">
                <div class="dashboard-controls">
                    <div class="control-group" style="flex: 0 0 auto; min-width: auto;">
                        <label>Âà∑Êñ∞Èó¥Èöî</label>
                        <select id="refreshIntervalSelect">
                            <option value="1">1Áßí</option>
                            <option value="2">2Áßí</option>
                            <option value="5">5Áßí</option>
                            <option value="10" selected>10Áßí</option>
                            <option value="30">30Áßí</option>
                            <option value="0">ÊâãÂä®Âà∑Êñ∞</option>
                        </select>
                    </div>
                    <div class="control-group" style="flex: 0 0 auto; min-width: auto; align-self: flex-end;">
                        <button class="btn-query" onclick="manualRefreshDashboard()">üîÑ ÊâãÂä®Âà∑Êñ∞</button>
                    </div>
                </div>
                
                <div id="dashboardError" class="error" style="display: none;"></div>
                
                <!-- ÂÆûÊó∂ÊµÅÈáèÂç°Áâá -->
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <div class="card-label">ÂΩìÂâç‰∏ãË°åÈÄüÁéá</div>
                        <div class="card-value" id="currentDownSpeed">-</div>
                        <div class="card-subtitle" id="currentDownSpeedFormatted">-</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-label">ÂΩìÂâç‰∏äË°åÈÄüÁéá</div>
                        <div class="card-value" id="currentUpSpeed">-</div>
                        <div class="card-subtitle" id="currentUpSpeedFormatted">-</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-label">ÊÄª‰∏ãËΩΩÊµÅÈáè</div>
                        <div class="card-value" id="totalDownload">-</div>
                        <div class="card-subtitle" id="totalDownloadFormatted">-</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-label">ÊÄª‰∏ä‰º†ÊµÅÈáè</div>
                        <div class="card-value" id="totalUpload">-</div>
                        <div class="card-subtitle" id="totalUploadFormatted">-</div>
                    </div>
                </div>
                
                <!-- Á≥ªÁªüÁä∂ÊÄÅÂç°Áâá -->
                <div class="dashboard-section">
                    <h3>Á≥ªÁªüÁä∂ÊÄÅ</h3>
                    <div class="system-status-grid">
                        <div class="status-item">
                            <span class="status-label">Êï∞ÊçÆÊî∂ÈõÜÊúçÂä°:</span>
                            <span class="status-value" id="collectorStatus">-</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Êï∞ÊçÆÂ∫ìËÆ∞ÂΩïÊï∞:</span>
                            <span class="status-value" id="totalRecords">-</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">ËÆæÂ§áÊÄªÊï∞:</span>
                            <span class="status-value" id="deviceCount">-</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">ÊúÄÊñ∞Êï∞ÊçÆÊó∂Èó¥:</span>
                            <span class="status-value" id="latestDataTime">-</span>
                        </div>
                    </div>
                </div>
                
                <!-- ËÆæÂ§áÂàóË°®ÂíåÊéíË°åÊ¶ú -->
                <div class="dashboard-section">
                    <h3>ËÆæÂ§áÁä∂ÊÄÅ‰∏éÊµÅÈáèÊéíË°åÊ¶ú</h3>
                    <div id="deviceRankingTable" class="table-container" style="display: none;">
                        <table id="rankingTable">
                            <thead>
                                <tr>
                                    <th>Áä∂ÊÄÅ</th>
                                    <th>ËÆæÂ§áÂêçÁß∞</th>
                                    <th>MACÂú∞ÂùÄ</th>
                                    <th>IPÂú∞ÂùÄ</th>
                                    <th>‰∏ãË°åÈÄüÁéá</th>
                                    <th>‰∏äË°åÈÄüÁéá</th>
                                    <th>ÊÄªÊµÅÈáè</th>
                                    <th>ÊúÄÂêéÊ¥ªË∑É</th>
                                </tr>
                            </thead>
                            <tbody id="rankingTableBody">
                            </tbody>
                        </table>
                    </div>
                    <div id="rankingEmpty" class="empty" style="display: none;">
                        ÊöÇÊó†ËÆæÂ§áÊï∞ÊçÆ
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Êï∞ÊçÆÂõæË°®Ê†áÁ≠æÈ°µ -->
        <div id="chartsTab" class="tab-content">
            <div class="data-query-content">
                <div class="controls">
                    <div class="control-group">
                        <label>ÂõæË°®Á±ªÂûã</label>
                        <select id="chartTypeSelect">
                            <option value="traffic_trend">ÊµÅÈáèË∂ãÂäøÂõæ</option>
                            <option value="device_comparison">ËÆæÂ§áÂØπÊØîÂõæ</option>
                        </select>
                    </div>
                    
                    <div class="control-group" id="deviceSelectorGroup" style="display: none;">
                        <label>ËÆæÂ§áÔºàÊµÅÈáèË∂ãÂäøÂõæÔºâ</label>
                        <select id="chartDeviceSelect">
                            <option value="total">ÂÖ®ÁΩëÊµÅÈáè</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Êó∂Èó¥ËåÉÂõ¥</label>
                        <select id="timeRangeSelect">
                            <option value="1">ÊúÄËøë1Â∞èÊó∂</option>
                            <option value="6">ÊúÄËøë6Â∞èÊó∂</option>
                            <option value="24" selected>ÊúÄËøë24Â∞èÊó∂</option>
                            <option value="72">ÊúÄËøë3Â§©</option>
                            <option value="168">ÊúÄËøë7Â§©</option>
                        </select>
                    </div>
                    
                    <div class="control-group" style="flex: 0 0 auto; min-width: auto; align-self: flex-end;">
                        <button class="btn-query" onclick="loadChart()">üìä ÁîüÊàêÂõæË°®</button>
                    </div>
                </div>
                
                <div id="chartLoading" class="loading-container" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div>Âä†ËΩΩÂõæË°®Êï∞ÊçÆ‰∏≠...</div>
                </div>
                
                <div id="chartError" class="error" style="display: none;"></div>
                
                <div id="chartsContainer" style="margin-top: 30px;">
                    <div id="trafficTrendChart" style="display: none;">
                        <canvas id="trafficTrendCanvas" style="max-height: 400px;"></canvas>
                    </div>
                    
                    <div id="deviceComparisonChart" style="display: none;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 12px; font-weight: 600; color: var(--text-primary); font-size: 16px;">ÂØπÊØîÁ±ªÂûãÔºö</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="comparisonTypeSpeed" name="comparisonType" value="speed" checked onchange="loadDeviceComparison()">
                                    <label for="comparisonTypeSpeed">
                                        ‚ö° ÈÄüÁéáÂØπÊØî
                                    </label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="comparisonTypeTotal" name="comparisonType" value="total" onchange="loadDeviceComparison()">
                                    <label for="comparisonTypeTotal">
                                        üìä ÊµÅÈáèÂØπÊØî
                                    </label>
                                </div>
                            </div>
                        </div>
                        <canvas id="deviceComparisonCanvas" style="max-height: 400px;"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÁªüËÆ°ÂàÜÊûêÊ†áÁ≠æÈ°µ -->
        <div id="statisticsTab" class="tab-content">
            <div class="data-query-content">
                <div id="statisticsError" class="error" style="display: none;"></div>
                
                <!-- ÊµÅÈáèÁªüËÆ°Ê±áÊÄªÂç°Áâá -->
                <div class="dashboard-section">
                    <h2>ÊµÅÈáèÁªüËÆ°Ê±áÊÄª</h2>
                    <div class="dashboard-cards">
                        <div class="dashboard-card">
                            <div class="card-label">‰ªäÊó•‰∏ãËΩΩ</div>
                            <div class="card-value" id="todayDownload">-</div>
                            <div class="card-unit" id="todayDownloadFormatted">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">‰ªäÊó•‰∏ä‰º†</div>
                            <div class="card-value" id="todayUpload">-</div>
                            <div class="card-unit" id="todayUploadFormatted">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">Êú¨Âë®‰∏ãËΩΩ</div>
                            <div class="card-value" id="weekDownload">-</div>
                            <div class="card-unit" id="weekDownloadFormatted">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">Êú¨Âë®‰∏ä‰º†</div>
                            <div class="card-value" id="weekUpload">-</div>
                            <div class="card-unit" id="weekUploadFormatted">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">Êú¨Êúà‰∏ãËΩΩ</div>
                            <div class="card-value" id="monthDownload">-</div>
                            <div class="card-unit" id="monthDownloadFormatted">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">Êú¨Êúà‰∏ä‰º†</div>
                            <div class="card-value" id="monthUpload">-</div>
                            <div class="card-unit" id="monthUploadFormatted">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- ÈÄüÁéáÁªüËÆ°Âç°Áâá -->
                <div class="dashboard-section">
                    <h2>ÈÄüÁéáÁªüËÆ°</h2>
                    <div class="dashboard-cards">
                        <div class="dashboard-card">
                            <div class="card-label">Âπ≥Âùá‰∏ãË°åÈÄüÁéá</div>
                            <div class="card-value" id="avgDownSpeed">-</div>
                            <div class="card-unit" id="avgDownSpeedFormatted">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">Âπ≥Âùá‰∏äË°åÈÄüÁéá</div>
                            <div class="card-value" id="avgUpSpeed">-</div>
                            <div class="card-unit" id="avgUpSpeedFormatted">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">Â≥∞ÂÄº‰∏ãË°åÈÄüÁéá</div>
                            <div class="card-value" id="peakDownSpeed">-</div>
                            <div class="card-unit" id="peakDownSpeedFormatted">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">Â≥∞ÂÄº‰∏äË°åÈÄüÁéá</div>
                            <div class="card-value" id="peakUpSpeed">-</div>
                            <div class="card-unit" id="peakUpSpeedFormatted">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- ËÆæÂ§áÊéíÂêçË°®Ê†º -->
                <div class="dashboard-section">
                    <h2>ËÆæÂ§áÊµÅÈáèÊéíÂêç (Top 10)</h2>
                    <div id="deviceRankingTableContainer" class="table-container">
                        <table id="statisticsDeviceRankingTable">
                            <thead>
                                <tr>
                                    <th>ÊéíÂêç</th>
                                    <th>ËÆæÂ§áÂêçÁß∞</th>
                                    <th>MACÂú∞ÂùÄ</th>
                                    <th>IPÂú∞ÂùÄ</th>
                                    <th>‰∏ãËΩΩÊµÅÈáè</th>
                                    <th>‰∏ä‰º†ÊµÅÈáè</th>
                                    <th>ÊÄªÊµÅÈáè</th>
                                </tr>
                            </thead>
                            <tbody id="statisticsDeviceRankingTableBody">
                                <tr><td colspan="7" style="text-align: center;">ÊöÇÊó†Êï∞ÊçÆ</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ËÆæÂ§áÊµÅÈáèÂç†ÊØîÂõæË°® -->
                <div class="dashboard-section">
                    <h2>ËÆæÂ§áÊµÅÈáèÂç†ÊØî</h2>
                    <div style="max-width: 600px; margin: 0 auto;">
                        <canvas id="trafficDistributionChart" style="max-height: 400px;"></canvas>
                    </div>
                </div>
                
                <!-- Êó∂Èó¥ÊÆµÂØπÊØîÂõæË°® -->
                <div class="dashboard-section">
                    <h2>Êó∂Èó¥ÊÆµÂØπÊØî</h2>
                    <div style="max-width: 800px; margin: 0 auto;">
                        <canvas id="periodComparisonChart" style="max-height: 400px;"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Êï∞ÊçÆÁÆ°ÁêÜÊ†áÁ≠æÈ°µ -->
        <div id="dataManagementTab" class="tab-content">
            <div class="data-query-content">
                <div id="dataManagementError" class="error" style="display: none;"></div>
                <div id="dataManagementSuccess" class="success" style="display: none;"></div>
                
                <!-- Êï∞ÊçÆÂ∫ìÁªüËÆ°‰ø°ÊÅØ -->
                <div class="dashboard-section">
                    <h2>Êï∞ÊçÆÂ∫ìÁªüËÆ°‰ø°ÊÅØ</h2>
                    <div class="dashboard-cards">
                        <div class="dashboard-card">
                            <div class="card-label">Êï∞ÊçÆÂ∫ìÂ§ßÂ∞è</div>
                            <div class="card-value" id="databaseSize">-</div>
                            <div class="card-unit" id="databaseSizeFormatted">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">ÂÖ®ÁΩëÊµÅÈáèËÆ∞ÂΩïÊï∞</div>
                            <div class="card-value" id="totalTrafficRecords">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">ËÆæÂ§áÊµÅÈáèËÆ∞ÂΩïÊï∞</div>
                            <div class="card-value" id="deviceTrafficRecords">-</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-label">ËÆæÂ§áÊï∞Èáè</div>
                            <div class="card-value" id="managementDeviceCount">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- Êï∞ÊçÆÊ∏ÖÁêÜÂå∫Âüü -->
                <div class="dashboard-section">
                    <h2>Êï∞ÊçÆÊ∏ÖÁêÜ</h2>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 12px; font-weight: 600; color: var(--text-primary); font-size: 16px;">Ê∏ÖÁêÜÊñπÂºèÔºö</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="cleanupTypeKeepDays" name="cleanupType" value="keep_days" checked onchange="updateCleanupUI()">
                                    <label for="cleanupTypeKeepDays">
                                        üìÖ ‰øùÁïôÊúÄËøëNÂ§©ÁöÑÊï∞ÊçÆ
                                    </label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="cleanupTypeTimeRange" name="cleanupType" value="time_range" onchange="updateCleanupUI()">
                                    <label for="cleanupTypeTimeRange">
                                        üïê ÊâãÂä®ÊåáÂÆöÊó∂Èó¥ËåÉÂõ¥
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="keepDaysGroup" style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--text-primary);">‰øùÁïôÂ§©Êï∞Ôºö</label>
                            <input type="number" id="keepDays" min="1" value="30" style="padding: 10px; width: 200px; max-width: 100%; border: 2px solid var(--border-color); border-radius: 6px; font-size: 14px; background: var(--bg-primary); color: var(--text-primary); transition: border-color 0.3s;">
                            <small style="display: block; margin-top: 6px; color: var(--text-secondary); font-size: 13px;">‰øùÁïôÊúÄËøëNÂ§©ÁöÑÊï∞ÊçÆÔºåËæÉÊó©ÁöÑÊï∞ÊçÆÂ∞ÜË¢´Âà†Èô§</small>
                        </div>
                        
                        <div id="timeRangeGroup" style="margin-bottom: 20px; display: none;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--text-primary);">ÂºÄÂßãÊó∂Èó¥Ôºö</label>
                                <input type="datetime-local" id="cleanupStartTime" style="padding: 10px; width: 250px; max-width: 100%; border: 2px solid var(--border-color); border-radius: 6px; font-size: 14px; background: var(--bg-primary); color: var(--text-primary); transition: border-color 0.3s;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--text-primary);">ÁªìÊùüÊó∂Èó¥Ôºö</label>
                                <input type="datetime-local" id="cleanupEndTime" style="padding: 10px; width: 250px; max-width: 100%; border: 2px solid var(--border-color); border-radius: 6px; font-size: 14px; background: var(--bg-primary); color: var(--text-primary); transition: border-color 0.3s;">
                            </div>
                            <small style="display: block; margin-top: 8px; color: var(--text-secondary); font-size: 13px;">ÊåáÂÆöÊó∂Èó¥ËåÉÂõ¥ÂÜÖÁöÑÊï∞ÊçÆÂ∞ÜË¢´Âà†Èô§</small>
                        </div>
                        
                        <div id="cleanupPreview" style="margin-bottom: 15px; padding: 12px 16px; background: var(--success-bg); border: 1px solid var(--success-border); border-radius: 6px; display: none; color: var(--success-text);">
                            <strong>È¢ÑËßàÔºö</strong>Â∞ÜÂà†Èô§ <span id="previewDeleteCount" style="font-weight: 600;">0</span> Êù°ËÆ∞ÂΩï
                        </div>
                        
                        <div style="display: flex; justify-content: flex-end; gap: 10px;">
                            <button class="btn-query" onclick="previewCleanup()" style="padding: 8px 16px !important; font-size: 13px !important; width: auto;">È¢ÑËßàÊ∏ÖÁêÜ</button>
                            <button class="btn-query" onclick="executeCleanup()" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); padding: 8px 16px !important; font-size: 13px !important; width: auto;">ÊâßË°åÊ∏ÖÁêÜ</button>
                        </div>
                    </div>
                </div>
                
                <!-- Êï∞ÊçÆÂ∫ì‰ºòÂåñÂå∫Âüü -->
                <div class="dashboard-section">
                    <h2>Êï∞ÊçÆÂ∫ì‰ºòÂåñ</h2>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="margin-bottom: 15px; color: #666;">
                            VACUUMÂëΩ‰ª§Â∞ÜÈáçÂª∫Êï∞ÊçÆÂ∫ìÊñá‰ª∂ÔºåÂõûÊî∂Êú™‰ΩøÁî®ÁöÑÁ©∫Èó¥Ôºå‰ºòÂåñÊï∞ÊçÆÂ∫ìÊÄßËÉΩ„ÄÇÂª∫ËÆÆÂú®Êï∞ÊçÆÊ∏ÖÁêÜÂêéÊâßË°å„ÄÇ
                        </p>
                        <div style="display: flex; justify-content: flex-end;">
                            <button class="btn-query" onclick="executeVacuum()" style="padding: 8px 16px !important; font-size: 13px !important; width: auto;">ÊâßË°å‰ºòÂåñ</button>
                        </div>
                        <div id="vacuumResult" style="margin-top: 15px; display: none;"></div>
                    </div>
                </div>
                
                <!-- Êï∞ÊçÆÂ§á‰ªΩÂå∫Âüü -->
                <div class="dashboard-section">
                    <h2>Êï∞ÊçÆÂ§á‰ªΩ</h2>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <p style="margin-bottom: 15px; color: #666;">
                            ÂØºÂá∫Êï∞ÊçÆÂ∫ì‰∏∫SQLÊñá‰ª∂ÔºåÂèØÁî®‰∫éÊï∞ÊçÆÊÅ¢Â§ç„ÄÇÂ§á‰ªΩÊñá‰ª∂ÂåÖÂê´ÊâÄÊúâË°®ÁªìÊûÑÂíåÊï∞ÊçÆ„ÄÇ
                        </p>
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button class="btn-query" onclick="triggerManualBackup()" style="padding: 8px 16px !important; font-size: 13px !important; width: auto;">üîÑ ÊâãÂä®Â§á‰ªΩ</button>
                            <button class="btn-query" onclick="downloadBackup()" style="padding: 8px 16px !important; font-size: 13px !important; width: auto;">üì• ‰∏ãËΩΩÊúÄÊñ∞Â§á‰ªΩ</button>
                        </div>
                        <div id="backupInfo" style="margin-top: 15px; padding: 10px; background: white; border-radius: 4px; display: none;">
                            <div><strong>Êï∞ÊçÆÂ∫ìÂ§ßÂ∞èÔºö</strong><span id="backupDatabaseSize">-</span></div>
                            <div style="margin-top: 5px;"><strong>ËÆ∞ÂΩïÊï∞Ôºö</strong><span id="backupRecordCount">-</span></div>
                        </div>
                    </div>
                </div>
                
                <!-- Â§á‰ªΩÂéÜÂè≤ËÆ∞ÂΩï -->
                <div class="dashboard-section">
                    <h2>Â§á‰ªΩÂéÜÂè≤ËÆ∞ÂΩï</h2>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <div id="backupHistoryLoading" class="loading-container" style="display: none;">
                            <div class="loading-spinner"></div>
                            <div>Âä†ËΩΩ‰∏≠...</div>
                        </div>
                        <div id="backupHistoryError" class="error" style="display: none;"></div>
                        
                        <div id="backupHistoryTable" style="display: none;">
                            <table class="data-table" style="width: 100%;">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Êñá‰ª∂Âêç</th>
                                        <th>Â§ßÂ∞è</th>
                                        <th>Êï∞ÊçÆÂ∫ì</th>
                                        <th>Áä∂ÊÄÅ</th>
                                        <th>‰∫ëÂ≠òÂÇ®</th>
                                        <th>ÂàõÂª∫Êó∂Èó¥</th>
                                        <th>Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody id="backupHistoryTableBody">
                                </tbody>
                            </table>
                            
                            <div id="backupHistoryPagination" style="margin-top: 20px; display: flex; justify-content: center; align-items: center; gap: 10px;">
                            </div>
                        </div>
                        
                        <div id="backupHistoryEmpty" style="text-align: center; padding: 40px; color: #666; display: none;">
                            ÊöÇÊó†Â§á‰ªΩËÆ∞ÂΩï
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÂëäË≠¶ÁÆ°ÁêÜÊ†áÁ≠æÈ°µ -->
        <div id="alertsTab" class="tab-content">
            <div class="data-query-content">
                <div id="alertsError" class="error" style="display: none;"></div>
                <div id="alertsSuccess" class="success" style="display: none;"></div>
                
                <!-- ÂëäË≠¶ËßÑÂàôÁÆ°ÁêÜ -->
                <div class="dashboard-section">
                    <h2>ÂëäË≠¶ËßÑÂàôÁÆ°ÁêÜ</h2>
                    <div style="margin-bottom: 20px; display: flex; justify-content: flex-end;">
                        <button class="btn-query" onclick="showCreateRuleForm()" style="padding: 8px 16px !important; font-size: 13px !important; width: auto !important;">‚ûï Êñ∞Âª∫ËßÑÂàô</button>
                    </div>
                    
                    <!-- ËßÑÂàôÂàóË°® -->
                    <div id="rulesTableContainer" class="table-container">
                        <table id="rulesTable" style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">ËßÑÂàôÂêçÁß∞</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">ÂëäË≠¶Á±ªÂûã</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">ÈòàÂÄº/Êù°‰ª∂</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">‰∏•ÈáçÁ®ãÂ∫¶</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Áä∂ÊÄÅ</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="rulesTableBody">
                                <tr>
                                    <td colspan="6" style="padding: 20px; text-align: center; color: #999;">Âä†ËΩΩ‰∏≠...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Êñ∞Âª∫/ÁºñËæëËßÑÂàôË°®ÂçïÔºàÊ®°ÊÄÅÊ°ÜÔºâ -->
                <div id="ruleFormModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 8px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <h2 id="ruleFormTitle" style="margin-top: 0;">Êñ∞Âª∫ÂëäË≠¶ËßÑÂàô</h2>
                        <form id="ruleForm" onsubmit="saveRule(event)">
                            <input type="hidden" id="ruleId" value="">
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">ËßÑÂàôÂêçÁß∞ *</label>
                                <input type="text" id="ruleName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">ÂëäË≠¶Á±ªÂûã *</label>
                                <select id="ruleType" required onchange="updateRuleForm()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">-- ËØ∑ÈÄâÊã© --</option>
                                    <option value="traffic_threshold">ÊµÅÈáèÈòàÂÄºÂëäË≠¶</option>
                                    <option value="device_offline">ËÆæÂ§áÁ¶ªÁ∫øÂëäË≠¶</option>
                                </select>
                            </div>
                            
                            <div id="trafficThresholdFields" style="display: none; margin-bottom: 20px;">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">ÊµÅÈáèÈòàÂÄº (Â≠óËäÇ/Áßí) *</label>
                                    <input type="number" id="thresholdBytes" min="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <small style="color: #666;">‰æãÂ¶Ç: 1048576 Ë°®Á§∫ 1MB/s (1048576 Â≠óËäÇ/Áßí)</small>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">ÁõÆÊ†áËÆæÂ§á</label>
                                    <select id="ruleDeviceId" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="">ÊâÄÊúâËÆæÂ§áÔºàÂÖ®ÁΩëÊµÅÈáèÔºâ</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div id="offlineThresholdFields" style="display: none; margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Á¶ªÁ∫øÈòàÂÄº (ÂàÜÈíü) *</label>
                                <input type="number" id="offlineThresholdMinutes" min="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">ËÆæÂ§áË∂ÖËøáÊ≠§Êó∂Èó¥Êú™Ê¥ªÂä®Â∞ÜËß¶ÂèëÂëäË≠¶</small>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">‰∏•ÈáçÁ®ãÂ∫¶ *</label>
                                <select id="ruleSeverity" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="warning">Ë≠¶Âëä (ÈªÑËâ≤)</option>
                                    <option value="critical">‰∏•Èáç (Á∫¢Ëâ≤)</option>
                                    <option value="info">‰ø°ÊÅØ (ËìùËâ≤)</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">ÈÄöÁü•ÊñπÂºè *</label>
                                <div id="notificationMethodsContainer" style="border: 1px solid #ddd; border-radius: 4px; padding: 12px; background: #f8f9fa;">
                                    <div style="display: flex; flex-direction: column; gap: 8px;">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="notificationMethodPage" value="page" checked>
                                            <span>È°µÈù¢ÈÄöÁü•ÔºàÁ≥ªÁªüÂÜÖÈÄöÁü•Ôºâ</span>
                                        </label>
                                        <label id="notificationMethodEmailLabel" class="checkbox-label" style="opacity: 0.5;">
                                            <input type="checkbox" id="notificationMethodEmail" value="email" disabled>
                                            <span>ÈÇÆ‰ª∂ÈÄöÁü•ÔºàÊú™ÈÖçÁΩÆÔºâ</span>
                                        </label>
                                        <label id="notificationMethodWebhookLabel" class="checkbox-label" style="opacity: 0.5;">
                                            <input type="checkbox" id="notificationMethodWebhook" value="webhook" disabled>
                                            <span>Webhook ÈÄöÁü•ÔºàÊú™ÈÖçÁΩÆÔºâ</span>
                                        </label>
                                        <label id="notificationMethodTelegramLabel" class="checkbox-label" style="opacity: 0.5;">
                                            <input type="checkbox" id="notificationMethodTelegram" value="telegram" disabled>
                                            <span>Telegram ÈÄöÁü•ÔºàÊú™ÈÖçÁΩÆÔºâ</span>
                                        </label>
                                        <label id="notificationMethodWecomLabel" class="checkbox-label" style="opacity: 0.5;">
                                            <input type="checkbox" id="notificationMethodWecom" value="wecom" disabled>
                                            <span>‰ºÅ‰∏öÂæÆ‰ø°ÈÄöÁü•ÔºàÊú™ÈÖçÁΩÆÔºâ</span>
                                        </label>
                                        <label id="notificationMethodDingtalkLabel" class="checkbox-label" style="opacity: 0.5;">
                                            <input type="checkbox" id="notificationMethodDingtalk" value="dingtalk" disabled>
                                            <span>ÈíâÈíâÈÄöÁü•ÔºàÊú™ÈÖçÁΩÆÔºâ</span>
                                        </label>
                                    </div>
                                </div>
                                <small style="color: #666;">È°µÈù¢ÈÄöÁü•ÊÄªÊòØÂèØÁî®ÔºåÂÖ∂‰ªñÈÄöÁü•ÊñπÂºèÈúÄË¶ÅÂú®ÈÖçÁΩÆÁÆ°ÁêÜ‰∏≠ÂÖàÈÖçÁΩÆ</small>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="ruleEnabled" checked>
                                    <span>ÂêØÁî®ËßÑÂàô</span>
                                </label>
                            </div>
                            
                            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                <button type="button" onclick="closeRuleForm()" style="padding: 10px 20px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer;">ÂèñÊ∂à</button>
                                <button type="submit" style="padding: 10px 20px; border: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 4px; cursor: pointer;">‰øùÂ≠ò</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- ÈÄöÁü•Ê∏†ÈÅìÈÖçÁΩÆ -->
                <div class="dashboard-section" style="margin-top: 40px;">
                    <h2>ÈÄöÁü•Ê∏†ÈÅìÈÖçÁΩÆ</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">ÈÖçÁΩÆÂëäË≠¶ÈÄöÁü•ÁöÑÂèëÈÄÅÊ∏†ÈÅì</p>
                    
                    <form id="notificationConfigForm">
                        <div id="notificationConfigError" class="error" style="display: none; margin-bottom: 15px;"></div>
                        <div id="notificationConfigSuccess" class="success" style="display: none; margin-bottom: 15px;"></div>
                        
                        <!-- ÈÇÆ‰ª∂ÈÄöÁü•ÈÖçÁΩÆ -->
                        <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <h3 style="margin-bottom: 15px; color: var(--text-primary);">ÈÇÆ‰ª∂ÈÄöÁü•</h3>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="alertsEmailEnabled" name="notifications.email_enabled">
                                    <span>ÂêØÁî®ÈÇÆ‰ª∂ÈÄöÁü•</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="alertsEmailSmtpHost">SMTPÊúçÂä°Âô®</label>
                                <input type="text" id="alertsEmailSmtpHost" name="notifications.email_smtp_host" placeholder="smtp.example.com">
                            </div>
                            <div class="form-group">
                                <label for="alertsEmailSmtpPort">SMTPÁ´ØÂè£</label>
                                <input type="number" id="alertsEmailSmtpPort" name="notifications.email_smtp_port" placeholder="587" min="1" max="65535">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="alertsEmailUseTls" name="notifications.email_use_tls" checked>
                                    <span>‰ΩøÁî®TLS/SSL</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="alertsEmailUsername">Áî®Êà∑Âêç</label>
                                <input type="text" id="alertsEmailUsername" name="notifications.email_username" placeholder="your-email@example.com">
                            </div>
                            <div class="form-group">
                                <label for="alertsEmailPassword">ÂØÜÁ†Å</label>
                                <input type="password" id="alertsEmailPassword" name="notifications.email_password" placeholder="ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπ">
                            </div>
                            <div class="form-group">
                                <label for="alertsEmailFrom">Âèë‰ª∂‰∫∫Âú∞ÂùÄ</label>
                                <input type="email" id="alertsEmailFrom" name="notifications.email_from" placeholder="alerts@example.com">
                            </div>
                            <div class="form-group">
                                <label for="alertsEmailTo">Êî∂‰ª∂‰∫∫Âú∞ÂùÄ</label>
                                <input type="text" id="alertsEmailTo" name="notifications.email_to" placeholder="admin@example.com (Â§ö‰∏™Áî®ÈÄóÂè∑ÂàÜÈöî)">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Â§ö‰∏™Êî∂‰ª∂‰∫∫Áî®ÈÄóÂè∑ÊàñÂàÜÂè∑ÂàÜÈöî</small>
                            </div>
                            <button type="button" onclick="testNotification('email')" class="btn-secondary" style="margin-top: 10px;">üìß ÊµãËØïÈÇÆ‰ª∂ÈÄöÁü•</button>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" onclick="saveAlertsNotificationConfig()" class="btn-query" style="flex: 1;">üíæ ‰øùÂ≠òÈÄöÁü•ÈÖçÁΩÆ</button>
                            <button type="button" onclick="loadAlertsNotificationConfig()" class="btn-secondary" style="flex: 1;">üîÑ ÈáçÊñ∞Âä†ËΩΩ</button>
                        </div>
                    </form>
                </div>
                
                <!-- ÂëäË≠¶ÂéÜÂè≤ -->
                <div class="dashboard-section" style="margin-top: 40px;">
                    <h2>ÂëäË≠¶ÂéÜÂè≤</h2>
                    
                    <!-- Á≠õÈÄâÊù°‰ª∂ -->
                    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 500;">Áä∂ÊÄÅ</label>
                                <select id="historyStatusFilter" onchange="loadAlertHistory()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="triggered">Â∑≤Ëß¶Âèë</option>
                                    <option value="acknowledged">Â∑≤Á°ÆËÆ§</option>
                                    <option value="resolved">Â∑≤Ëß£ÂÜ≥</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 500;">ÂëäË≠¶Á±ªÂûã</label>
                                <select id="historyTypeFilter" onchange="loadAlertHistory()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="traffic_threshold">ÊµÅÈáèÈòàÂÄº</option>
                                    <option value="device_offline">ËÆæÂ§áÁ¶ªÁ∫ø</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 500;">‰∏•ÈáçÁ®ãÂ∫¶</label>
                                <select id="historySeverityFilter" onchange="loadAlertHistory()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="critical">‰∏•Èáç</option>
                                    <option value="warning">Ë≠¶Âëä</option>
                                    <option value="info">‰ø°ÊÅØ</option>
                                </select>
                            </div>
                            <div>
                                <button class="btn-query" onclick="loadAlertHistory()">üîç Á≠õÈÄâ</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÂëäË≠¶ÂéÜÂè≤ÂàóË°® -->
                    <div id="alertHistoryTableContainer" class="table-container">
                        <table id="alertHistoryTable" style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Ëß¶ÂèëÊó∂Èó¥</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">ÂëäË≠¶Á±ªÂûã</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Ê∂àÊÅØ</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">‰∏•ÈáçÁ®ãÂ∫¶</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Áä∂ÊÄÅ</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="alertHistoryTableBody">
                                <tr>
                                    <td colspan="6" style="padding: 20px; text-align: center; color: #999;">Âä†ËΩΩ‰∏≠...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- ÂàÜÈ°µ -->
                    <div id="alertHistoryPagination" style="margin-top: 20px; display: flex; justify-content: center; gap: 10px; align-items: center;">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Êï∞ÊçÆÊü•ËØ¢Ê†áÁ≠æÈ°µ -->
        <div id="dataQueryTab" class="tab-content">
            <div class="data-query-content">
                <div class="controls">
                    <div class="control-group">
                        <label>ÈÄâÊã©Ë°®</label>
                        <select id="tableSelect">
                            <option value="">-- ËØ∑ÈÄâÊã©Ë°® --</option>
                            <option value="total_traffic">ÂÖ®ÁΩëÊµÅÈáè (total_traffic)</option>
                            <option value="device_traffic">ËÆæÂ§áÊµÅÈáè (device_traffic)</option>
                            <option value="devices">ËÆæÂ§á‰ø°ÊÅØ (devices)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>ËÆæÂ§á (‰ªÖËÆæÂ§áÊµÅÈáèË°®)</label>
                        <select id="deviceSelect" disabled>
                            <option value="">-- Âä†ËΩΩ‰∏≠ --</option>
                        </select>
                    </div>
                    
                    <div class="control-group" style="flex: 0 0 auto; min-width: auto; align-self: flex-end;">
                        <button class="btn-query" onclick="loadData()">üîç Êü•ËØ¢</button>
                    </div>
                    
                    <div class="control-group" style="flex: 0 0 auto; min-width: auto; align-self: flex-end;">
                        <button class="btn-query" onclick="exportToCSV()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">üì• ÂØºÂá∫CSV</button>
                    </div>
                    
                    <div class="control-group" style="flex: 0 0 auto; min-width: auto; align-self: flex-end;">
                        <button class="btn-query" onclick="exportToExcel()" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">üìä ÂØºÂá∫Excel</button>
                    </div>
                </div>
                
                <div id="statsContainer" class="stats" style="display: none;"></div>
                
                <div id="loading" class="loading-container" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div>Âä†ËΩΩ‰∏≠...</div>
                </div>
                
                <div id="error" class="error" style="display: none;"></div>
                
                <div id="tableContainer" class="table-container" style="display: none;">
                    <table id="dataTable">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
                
                <div id="empty" class="empty" style="display: none;">
                    ÊöÇÊó†Êï∞ÊçÆ
                </div>
                
                <div id="pagination" class="pagination" style="display: none;"></div>
            </div>
        </div>
        
        <!-- Áî®Êà∑ÁÆ°ÁêÜÊ†áÁ≠æÈ°µ -->
        <div id="userManagementTab" class="tab-content">
            <div class="data-query-content">
                <div id="userManagementError" class="error" style="display: none;"></div>
                <div id="userManagementSuccess" class="success" style="display: none;"></div>
                
                <div style="margin-bottom: 20px;">
                    <div style="margin-bottom: 10px;">
                        <h2 style="margin-bottom: 10px;">Áî®Êà∑ÁÆ°ÁêÜ</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 0;">ÁÆ°ÁêÜÁ≥ªÁªüÁî®Êà∑Ë¥¶Êà∑</p>
                    </div>
                    <div style="display: flex; justify-content: flex-end;">
                        <button class="btn-query" onclick="showCreateUserDialog()" style="padding: 8px 12px !important; font-size: 13px !important; width: auto !important;">
                            ‚ûï Êñ∞Âª∫
                        </button>
                    </div>
                </div>
                
                <div id="userManagementLoading" class="loading-container" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div>Âä†ËΩΩ‰∏≠...</div>
                </div>
                
                <div id="userManagementContent" style="display: none;">
                    <!-- Áî®Êà∑ÂàóË°®Ë°®Ê†º -->
                    <div style="overflow-x: auto;">
                        <table class="data-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Áî®Êà∑Âêç</th>
                                    <th>ËßíËâ≤</th>
                                    <th>Áä∂ÊÄÅ</th>
                                    <th>ÂàõÂª∫Êó∂Èó¥</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="userListTableBody">
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- ÂàÜÈ°µ -->
                    <div id="userManagementPagination" class="pagination" style="margin-top: 20px;"></div>
                </div>
                
                <!-- Áî®Êà∑ÁºñËæë/ÂàõÂª∫ÂØπËØùÊ°Ü -->
                <div id="userEditModal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-width: 500px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 id="userEditModalTitle">ÁºñËæëÁî®Êà∑</h2>
                            <button onclick="closeUserEditModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-primary); margin-left: auto;">&times;</button>
                        </div>
                        <form id="userEditForm" onsubmit="saveUser(event)">
                            <input type="hidden" id="editUserId" value="">
                            <div class="form-group">
                                <label for="editUsername">Áî®Êà∑Âêç</label>
                                <input type="text" id="editUsername" required>
                            </div>
                            <div class="form-group" id="editPasswordGroup" style="display: none;">
                                <label for="editPassword">ÂØÜÁ†Å</label>
                                <input type="password" id="editPassword" autocomplete="new-password" minlength="6">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπÂØÜÁ†ÅÔºàÂàõÂª∫Áî®Êà∑Êó∂ÂøÖÂ°´Ôºâ</small>
                            </div>
                            <div class="form-group">
                                <label for="editRole">ËßíËâ≤</label>
                                <select id="editRole" required>
                                    <option value="user">ÊôÆÈÄöÁî®Êà∑</option>
                                    <option value="admin">ÁÆ°ÁêÜÂëò</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="editIsActive" checked>
                                    <span>ÂêØÁî®Ë¥¶Êà∑</span>
                                </label>
                            </div>
                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                <button type="button" class="btn-secondary" onclick="closeUserEditModal()">ÂèñÊ∂à</button>
                                <button type="submit" class="btn-query">‰øùÂ≠ò</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Êä•Ë°®ÁÆ°ÁêÜÊ†áÁ≠æÈ°µ -->
        <div id="reportManagementTab" class="tab-content">
            <div class="data-query-content">
                <div id="reportError" class="error" style="display: none;"></div>
                <div id="reportSuccess" class="success" style="display: none;"></div>
                
                <div style="margin-bottom: 20px;">
                    <h2 style="margin-bottom: 10px;">Êä•Ë°®ÁÆ°ÁêÜ</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Êü•ÁúãÊä•Ë°®ÂéÜÂè≤ËÆ∞ÂΩï„ÄÅÊâãÂä®ÁîüÊàêÊä•Ë°®„ÄÅ‰∏ãËΩΩÊä•Ë°®Êñá‰ª∂</p>
                </div>
                
                <!-- ÊâãÂä®ÁîüÊàêÊä•Ë°® -->
                <div class="dashboard-section" style="margin-bottom: 30px;">
                    <h3>ÊâãÂä®ÁîüÊàêÊä•Ë°®</h3>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px;">
                        <div class="form-group">
                            <label for="manualReportType">Êä•Ë°®Á±ªÂûã</label>
                            <select id="manualReportType" style="width: 200px;">
                                <option value="daily">Êó•Êä•</option>
                                <option value="weekly">Âë®Êä•</option>
                                <option value="monthly">ÊúàÊä•</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <button class="btn-query" onclick="generateManualReport()">üìä ÁîüÊàêÊä•Ë°®</button>
                        </div>
                    </div>
                </div>
                
                <!-- Êä•Ë°®ÂéÜÂè≤ËÆ∞ÂΩï -->
                <div class="dashboard-section">
                    <h3>Êä•Ë°®ÂéÜÂè≤ËÆ∞ÂΩï</h3>
                    <div style="margin-bottom: 15px;">
                        <label for="reportTypeFilter" style="margin-right: 10px;">Á≠õÈÄâÁ±ªÂûãÔºö</label>
                        <select id="reportTypeFilter" onchange="loadReportHistory()" style="width: 150px;">
                            <option value="">ÂÖ®ÈÉ®</option>
                            <option value="daily">Êó•Êä•</option>
                            <option value="weekly">Âë®Êä•</option>
                            <option value="monthly">ÊúàÊä•</option>
                        </select>
                    </div>
                    
                    <div id="reportHistoryLoading" class="loading-container" style="display: none;">
                        <div class="loading-spinner"></div>
                        <div>Âä†ËΩΩ‰∏≠...</div>
                    </div>
                    
                    <div id="reportHistoryError" class="error" style="display: none;"></div>
                    
                    <div id="reportHistoryTable" style="display: none;">
                        <table class="data-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Á±ªÂûã</th>
                                    <th>Âë®Êúü</th>
                                    <th>ÁîüÊàêÊó∂Èó¥</th>
                                    <th>Êñá‰ª∂Â§ßÂ∞è</th>
                                    <th>Áä∂ÊÄÅ</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="reportHistoryTableBody">
                            </tbody>
                        </table>
                        <div id="reportHistoryPagination" style="margin-top: 20px; display: flex; justify-content: center; align-items: center; gap: 10px;">
                        </div>
                    </div>
                    
                    <div id="reportHistoryEmpty" style="text-align: center; padding: 40px; color: #666; display: none;">
                        <p>ÊöÇÊó†Êä•Ë°®ËÆ∞ÂΩï</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- APIÁªüËÆ°Ê†áÁ≠æÈ°µ -->
        <div id="apiStatsTab" class="tab-content">
            <div class="data-query-content">
                <div id="apiStatsError" class="error" style="display: none;"></div>
                <div id="apiStatsSuccess" class="success" style="display: none;"></div>
                
                <div style="margin-bottom: 20px;">
                    <h2 style="margin-bottom: 10px;">APIË∞ÉÁî®ÁªüËÆ°</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Êü•ÁúãAPIÁ´ØÁÇπÁöÑË∞ÉÁî®ÁªüËÆ°‰ø°ÊÅØÔºåÂåÖÊã¨Ë∞ÉÁî®Ê¨°Êï∞„ÄÅÁî®Êà∑ÂàÜÂ∏ÉÁ≠â</p>
                </div>
                
                <!-- ÁªüËÆ°ÊëòË¶ÅÂç°Áâá -->
                <div class="dashboard-cards" style="margin-bottom: 30px;">
                    <div class="dashboard-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="card-label">ÊÄªË∞ÉÁî®Ê¨°Êï∞</div>
                        <div class="card-value" id="totalCalls">-</div>
                        <div class="card-subtitle">Á¥ØËÆ°APIË∞ÉÁî®ÊÄªÊï∞</div>
                    </div>
                    <div class="dashboard-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="card-label">Á´ØÁÇπÊï∞Èáè</div>
                        <div class="card-value" id="uniqueEndpoints">-</div>
                        <div class="card-subtitle">Â∑≤ÁªüËÆ°ÁöÑAPIÁ´ØÁÇπ</div>
                    </div>
                    <div class="dashboard-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="card-label">Ê¥ªË∑ÉÁî®Êà∑</div>
                        <div class="card-value" id="activeUsers">-</div>
                        <div class="card-subtitle">Ë∞ÉÁî®APIÁöÑÁî®Êà∑Êï∞</div>
                    </div>
                </div>
                
                <!-- Êó∂Èó¥ËåÉÂõ¥Á≠õÈÄâÂíåÊìç‰ΩúÊ†è -->
                <div class="dashboard-section" style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; margin-bottom: 30px;">
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="font-weight: 600; color: var(--text-primary);">Êó∂Èó¥ËåÉÂõ¥Ôºö</label>
                            <select id="statsTimeRange" onchange="loadApiStats()" style="padding: 10px 15px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); font-size: 14px; cursor: pointer; min-width: 140px;">
                                <option value="all">ÂÖ®ÈÉ®Êó∂Èó¥</option>
                                <option value="today">‰ªäÊó•</option>
                                <option value="week">Êú¨Âë®</option>
                                <option value="month">Êú¨Êúà</option>
                            </select>
                        </div>
                        <button onclick="loadApiStats()" class="btn-query" style="padding: 10px 20px; display: flex; align-items: center; gap: 8px;">
                            <span>üîÑ</span>
                            <span>Âà∑Êñ∞Êï∞ÊçÆ</span>
                        </button>
                    </div>
                </div>
                
                <!-- TopÁ´ØÁÇπÊéíË°åÊ¶ú -->
                <div class="dashboard-section" style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: var(--text-primary); font-size: 18px; font-weight: 600;">üèÜ ÁÉ≠Èó®Á´ØÁÇπÊéíË°åÊ¶ú (Top 10)</h3>
                    </div>
                    <div id="topEndpointsLoading" class="loading-container" style="display: none;">
                        <div class="loading-spinner"></div>
                        <div>Âä†ËΩΩ‰∏≠...</div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table id="topEndpointsTable" style="width: 100%; border-collapse: collapse; background: var(--bg-primary); border-radius: 8px; overflow: hidden;">
                            <thead>
                                <tr style="background: var(--bg-primary); border-bottom: 2px solid var(--border-color);">
                                    <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">ÊéíÂêç</th>
                                    <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">Á´ØÁÇπ</th>
                                    <th style="padding: 14px 16px; text-align: center; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">ÊñπÊ≥ï</th>
                                    <th style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">Ë∞ÉÁî®Ê¨°Êï∞</th>
                                    <th style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">Áî®Êà∑Êï∞</th>
                                    <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">ÊúÄÂêéË∞ÉÁî®</th>
                                    <th style="padding: 14px 16px; text-align: center; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="topEndpointsTableBody">
                                <tr>
                                    <td colspan="7" style="padding: 40px 20px; text-align: center; color: var(--text-secondary);">ÊöÇÊó†Êï∞ÊçÆ</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ÊâÄÊúâÁ´ØÁÇπÂàóË°® -->
                <div class="dashboard-section" style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                        <h3 style="margin: 0; color: var(--text-primary); font-size: 18px; font-weight: 600;">üìã ÊâÄÊúâÁ´ØÁÇπÁªüËÆ°</h3>
                        <div style="flex: 1; max-width: 400px; min-width: 200px;">
                            <input type="text" id="endpointSearch" placeholder="üîç ÊêúÁ¥¢Á´ØÁÇπ..." 
                                   onkeyup="filterEndpoints()" 
                                   style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); font-size: 14px; transition: border-color 0.3s;"
                                   onfocus="this.style.borderColor='var(--accent-color)'"
                                   onblur="this.style.borderColor='var(--border-color)'">
                        </div>
                    </div>
                    <div id="allEndpointsLoading" class="loading-container" style="display: none;">
                        <div class="loading-spinner"></div>
                        <div>Âä†ËΩΩ‰∏≠...</div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table id="allEndpointsTable" style="width: 100%; border-collapse: collapse; background: var(--bg-primary); border-radius: 8px; overflow: hidden;">
                            <thead>
                                <tr style="background: var(--bg-primary); border-bottom: 2px solid var(--border-color);">
                                    <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">Á´ØÁÇπ</th>
                                    <th style="padding: 14px 16px; text-align: center; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">ÊñπÊ≥ï</th>
                                    <th style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">Ë∞ÉÁî®Ê¨°Êï∞</th>
                                    <th style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">Áî®Êà∑Êï∞</th>
                                    <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">ÊúÄÂêéË∞ÉÁî®</th>
                                    <th style="padding: 14px 16px; text-align: center; font-weight: 600; color: var(--text-primary); font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="allEndpointsTableBody">
                                <tr>
                                    <td colspan="6" style="padding: 40px 20px; text-align: center; color: var(--text-secondary);">ÊöÇÊó†Êï∞ÊçÆ</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MySQLÁÆ°ÁêÜÊ†áÁ≠æÈ°µ -->
        <div id="mysqlManagementTab" class="tab-content">
            <div class="data-query-content">
                <div id="mysqlError" class="error" style="display: none;"></div>
                <div id="mysqlSuccess" class="success" style="display: none;"></div>
                
                <div style="margin-bottom: 20px;">
                    <h2 style="margin-bottom: 10px;">MySQLÊï∞ÊçÆÂ∫ìÁÆ°ÁêÜ</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">ÈÖçÁΩÆMySQLÊï∞ÊçÆÂ∫ìËøûÊé•Âπ∂Êü•ÁúãËøûÊé•Áä∂ÊÄÅ</p>
                </div>
                
                <!-- MySQLËøûÊé•Áä∂ÊÄÅ -->
                <div class="dashboard-section" style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);">ËøûÊé•Áä∂ÊÄÅ</h3>
                    <div id="mysqlStatusInfo" style="padding: 15px; border-radius: 8px; background: var(--bg-primary); border: 1px solid var(--border-color);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong style="color: var(--text-primary);">Áä∂ÊÄÅÔºö</strong>
                            <span id="mysqlStatusText" style="color: var(--text-secondary);">-</span>
                        </div>
                        <div style="margin-top: 10px;">
                            <p id="mysqlStatusMessage" style="color: var(--text-secondary); font-size: 13px; margin: 0;">-</p>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button type="button" onclick="checkMysqlStatus()" class="btn-secondary" style="padding: 10px 20px; font-size: 14px;">üîÑ Âà∑Êñ∞Áä∂ÊÄÅ</button>
                    </div>
                </div>
                
                <!-- MySQLËøûÊé•ÈÖçÁΩÆ -->
                <div class="dashboard-section" style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);">MySQLËøûÊé•ÈÖçÁΩÆ</h3>
                    <form id="mysqlConfigForm">
                        <div class="form-group">
                            <label for="mysqlHost">‰∏ªÊú∫Âú∞ÂùÄ</label>
                            <input type="text" id="mysqlHost" name="mysql_host" placeholder="localhost" required>
                        </div>
                        <div class="form-group">
                            <label for="mysqlPort">Á´ØÂè£</label>
                            <input type="number" id="mysqlPort" name="mysql_port" placeholder="3306" value="3306" min="1" max="65535" required>
                        </div>
                        <div class="form-group">
                            <label for="mysqlUser">Áî®Êà∑Âêç</label>
                            <input type="text" id="mysqlUser" name="mysql_user" placeholder="root" required>
                        </div>
                        <div class="form-group">
                            <label for="mysqlPassword">ÂØÜÁ†Å</label>
                            <input type="password" id="mysqlPassword" name="mysql_password" placeholder="ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπ">
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπÂΩìÂâçÂØÜÁ†Å</small>
                        </div>
                        <div class="form-group">
                            <label for="mysqlDatabase">Êï∞ÊçÆÂ∫ìÂêçÁß∞</label>
                            <input type="text" id="mysqlDatabase" name="mysql_database" placeholder="bandix_monitor" required>
                        </div>
                        <div class="form-group">
                            <label for="mysqlCharset">Â≠óÁ¨¶ÈõÜ</label>
                            <input type="text" id="mysqlCharset" name="mysql_charset" placeholder="utf8mb4" value="utf8mb4" required>
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Êé®Ëçê‰ΩøÁî®utf8mb4‰ª•ÊîØÊåÅÂÆåÊï¥ÁöÑUTF-8Â≠óÁ¨¶ÈõÜ</small>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" onclick="testMysqlConnection()" class="btn-secondary" style="flex: 1; padding: 12px 20px; font-size: 14px;">üîó ÊµãËØïËøûÊé•</button>
                            <button type="button" onclick="saveMysqlConfig()" class="btn-query" style="flex: 1; padding: 12px 20px; font-size: 14px;">üíæ ‰øùÂ≠òÈÖçÁΩÆ</button>
                            <button type="button" onclick="loadMysqlConfig()" class="btn-secondary" style="flex: 1; padding: 12px 20px; font-size: 14px;">üîÑ ÈáçÊñ∞Âä†ËΩΩ</button>
                        </div>
                    </form>
                </div>
                
            </div>
        </div>
        
        <!-- ÈÖçÁΩÆÁÆ°ÁêÜÊ†áÁ≠æÈ°µ -->
        <div id="configTab" class="tab-content">
            <div class="data-query-content">
                <!-- ÈÖçÁΩÆÂàÜÁ±ªÊ®™Ê†èÂØºËà™ -->
                <div style="background: var(--bg-secondary); border-radius: 8px; padding: 16px 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
                    <nav class="config-nav-menu">
                        <button class="config-nav-item active" onclick="switchConfigSection('system')" data-section="system">
                            <span>üîß Á≥ªÁªüÈÖçÁΩÆ</span>
                        </button>
                        <button class="config-nav-item" onclick="switchConfigSection('notification')" data-section="notification">
                            <span>üì¢ ÈÄöÁü•ÈÖçÁΩÆ</span>
                        </button>
                        <button class="config-nav-item" onclick="switchConfigSection('backup')" data-section="backup">
                            <span>üíæ Â§á‰ªΩÈÖçÁΩÆ</span>
                        </button>
                        <button class="config-nav-item" onclick="switchConfigSection('report')" data-section="report">
                            <span>üìä Êä•Ë°®ÈÖçÁΩÆ</span>
                        </button>
                        <button class="config-nav-item" onclick="switchConfigSection('log')" data-section="log">
                            <span>üìù Êó•ÂøóÈÖçÁΩÆ</span>
                        </button>
                    </nav>
                </div>
                
                <!-- ÈÖçÁΩÆÂÜÖÂÆπÂå∫Âüü -->
                <div class="config-content-area" style="width: 100%;">
                <div id="configError" class="error" style="display: none;"></div>
                <div id="configSuccess" class="success" style="display: none;"></div>
                
                <div id="configLoading" class="loading-container" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div>Âä†ËΩΩÈÖçÁΩÆ‰∏≠...</div>
                        </div>
                        
                        <!-- Á≥ªÁªüÈÖçÁΩÆÂå∫Âüü -->
                        <div id="configSection-system" class="config-section active" style="display: block;">
                            <div style="margin-bottom: 20px;">
                                <h2 style="margin-bottom: 10px;">Á≥ªÁªüÈÖçÁΩÆ</h2>
                                <p style="color: var(--text-secondary); margin-bottom: 20px;">ÁÆ°ÁêÜOpenWrtËÆæÂ§áËøûÊé•„ÄÅAPIÊúçÂä°ÂíåÊï∞ÊçÆÊî∂ÈõÜÊúçÂä°ÁöÑÈÖçÁΩÆ</p>
                </div>
                
                <form id="configForm" style="display: none;">
                    <!-- OpenWrtËÆæÂ§áÈÖçÁΩÆ -->
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: var(--text-primary);">OpenWrtËÆæÂ§áÈÖçÁΩÆ</h3>
                        <div class="form-group">
                            <label for="bandixUrl">ËÆæÂ§áURL</label>
                            <input type="text" id="bandixUrl" name="bandix.url" placeholder="http://10.0.0.1/ubus" required>
                        </div>
                        <div class="form-group">
                            <label for="bandixUsername">Áî®Êà∑Âêç</label>
                            <input type="text" id="bandixUsername" name="bandix.username" placeholder="root" required>
                        </div>
                        <div class="form-group">
                            <label for="bandixPassword">ÂØÜÁ†Å</label>
                            <input type="password" id="bandixPassword" name="bandix.password" placeholder="ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπ">
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπÂΩìÂâçÂØÜÁ†Å</small>
                        </div>
                    </div>
                    
                    <!-- APIÊúçÂä°ÈÖçÁΩÆ -->
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: var(--text-primary);">APIÊúçÂä°ÈÖçÁΩÆ</h3>
                        <div class="form-group">
                            <label for="apiHost">ÁõëÂê¨Âú∞ÂùÄ</label>
                            <input type="text" id="apiHost" name="api.host" placeholder="0.0.0.0" required>
                        </div>
                        <div class="form-group">
                            <label for="apiPort">Á´ØÂè£</label>
                            <input type="number" id="apiPort" name="api.port" min="1" max="65535" placeholder="5000" required>
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px; color: var(--error-text);">‚ö†Ô∏è ‰øÆÊîπÁ´ØÂè£ÈúÄË¶ÅÈáçÂêØÊúçÂä°</small>
                        </div>
                        <div class="form-group">
                            <label for="apiDebug">Ë∞ÉËØïÊ®°Âºè</label>
                            <select id="apiDebug" name="api.debug" required>
                                <option value="false">ÂÖ≥Èó≠</option>
                                <option value="true">ÂºÄÂêØ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="apiAuthEnabled">ÂêØÁî®APIÈâ¥ÊùÉ</label>
                            <select id="apiAuthEnabled" name="api.auth_enabled" required>
                                <option value="true">ÂêØÁî®</option>
                                <option value="false">Á¶ÅÁî®</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="apiKey">APIÂØÜÈí•</label>
                            <input type="text" id="apiKey" name="api.api_key" placeholder="ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπ">
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπÂΩìÂâçÂØÜÈí•</small>
                        </div>
                        <div class="form-group">
                            <label for="healthCheckRequireAuth">ÂÅ•Â∫∑Ê£ÄÊü•ÈúÄË¶ÅÈâ¥ÊùÉ</label>
                            <select id="healthCheckRequireAuth" name="api.health_check_require_auth" required>
                                <option value="false">‰∏çÈúÄË¶Å</option>
                                <option value="true">ÈúÄË¶Å</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Êï∞ÊçÆÊî∂ÈõÜÊúçÂä°ÈÖçÁΩÆ -->
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: var(--text-primary);">Êï∞ÊçÆÊî∂ÈõÜÊúçÂä°ÈÖçÁΩÆ</h3>
                        <div class="form-group">
                            <label for="collectInterval">Êî∂ÈõÜÈó¥ÈöîÔºàÁßíÔºâ</label>
                            <input type="number" id="collectInterval" name="collector.collect_interval" min="0.1" step="0.1" placeholder="1.0" required>
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Êï∞ÊçÆÊî∂ÈõÜÁöÑÊó∂Èó¥Èó¥ÈöîÔºåÂª∫ËÆÆ‰∏çÂ∞è‰∫é0.1Áßí</small>
                        </div>
                        <div id="collectorStatus" style="margin-top: 10px; padding: 10px; background: var(--card-info-bg); border-radius: 6px;">
                            <strong>ÊúçÂä°Áä∂ÊÄÅÔºö</strong><span id="collectorStatusText">-</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn-query" style="flex: 1; padding: 12px 20px; font-size: 14px;">üíæ ‰øùÂ≠òÁ≥ªÁªüÈÖçÁΩÆ</button>
                        <button type="button" onclick="loadConfig()" class="btn-secondary" style="flex: 1; padding: 12px 20px; font-size: 14px;">üîÑ ÈáçÊñ∞Âä†ËΩΩ</button>
                    </div>
                </form>
            </div>
            
            <!-- ÈÄöÁü•ÈÖçÁΩÆÂå∫Âüü -->
            <div id="configSection-notification" class="config-section" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <h2 style="margin-bottom: 10px;">ÈÄöÁü•ÈÖçÁΩÆ</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">ÈÖçÁΩÆÂëäË≠¶ÈÄöÁü•Ê∏†ÈÅìÔºåÊîØÊåÅWebhook„ÄÅTelegramÁ≠âÂ§öÁßçÈÄöÁü•ÊñπÂºè</p>
                    <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 12px;">Ê≥®ÊÑèÔºöÈÇÆ‰ª∂ÈÄöÁü•ÈÖçÁΩÆÂ∑≤ÁßªËá≥"ÂëäË≠¶ÁÆ°ÁêÜ"È°µÈù¢</p>
        </div>
                
                <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: var(--text-primary);">ÈÄöÁü•ÈÖçÁΩÆ</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">ÈÖçÁΩÆÂëäË≠¶ÈÄöÁü•Ê∏†ÈÅìÔºåÊîØÊåÅWebhook„ÄÅTelegramÁ≠âÂ§öÁßçÈÄöÁü•ÊñπÂºè</p>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 12px;">Ê≥®ÊÑèÔºöÈÇÆ‰ª∂ÈÄöÁü•ÈÖçÁΩÆÂ∑≤ÁßªËá≥"ÂëäË≠¶ÁÆ°ÁêÜ"È°µÈù¢</p>
                        
                        <!-- WebhookÈÄöÁü•ÈÖçÁΩÆ -->
                        <div style="border: 1px solid var(--border-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: var(--text-primary);">Webhook ÈÄöÁü•</h4>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="webhookEnabled" name="notifications.webhook_enabled">
                                    <span>ÂêØÁî®</span>
                                </label>
            </div>
                            <div class="form-group">
                                <label for="webhookUrls">Webhook URL</label>
                                <input type="text" id="webhookUrls" name="notifications.webhook_urls" placeholder="https://example.com/webhook (Â§ö‰∏™Áî®ÂàÜÂè∑ÂàÜÈöî)">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Â§ö‰∏™URLÁî®ÂàÜÂè∑ÊàñÈÄóÂè∑ÂàÜÈöî</small>
                            </div>
                            <div class="form-group">
                                <label for="webhookHeaders">ËØ∑Ê±ÇÂ§¥ÔºàJSONÊ†ºÂºèÔºâ</label>
                                <textarea id="webhookHeaders" name="notifications.webhook_headers" rows="3" placeholder='{"Authorization": "Bearer token"}' style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; font-family: monospace;"></textarea>
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">ÂèØÈÄâÔºåJSONÊ†ºÂºèÁöÑHTTPËØ∑Ê±ÇÂ§¥</small>
                            </div>
                            <button type="button" onclick="testNotification('webhook')" class="btn-secondary" style="margin-top: 10px;">üîó ÊµãËØïWebhookÈÄöÁü•</button>
                        </div>
                        
                        <!-- TelegramÈÄöÁü•ÈÖçÁΩÆ -->
                        <div style="border: 1px solid var(--border-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: var(--text-primary);">Telegram ÈÄöÁü•</h4>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="telegramEnabled" name="notifications.telegram_enabled">
                                    <span>ÂêØÁî®</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="telegramBotToken">Bot Token</label>
                                <input type="text" id="telegramBotToken" name="notifications.telegram_bot_token" placeholder="ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπ">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">‰ªé @BotFather Ëé∑ÂèñBot Token</small>
                            </div>
                            <div class="form-group">
                                <label for="telegramChatIds">Chat ID</label>
                                <input type="text" id="telegramChatIds" name="notifications.telegram_chat_ids" placeholder="123456789 (Â§ö‰∏™Áî®ÂàÜÂè∑ÂàÜÈöî)">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Â§ö‰∏™Chat IDÁî®ÂàÜÂè∑ÊàñÈÄóÂè∑ÂàÜÈöîÔºåÂèØÈÄöËøá @userinfobot Ëé∑ÂèñÊÇ®ÁöÑChat ID</small>
                            </div>
                            <button type="button" onclick="testNotification('telegram')" class="btn-secondary" style="margin-top: 10px;">‚úàÔ∏è ÊµãËØïTelegramÈÄöÁü•</button>
                        </div>
                        
                        <!-- ‰ºÅ‰∏öÂæÆ‰ø°ÈÄöÁü•ÈÖçÁΩÆ -->
                        <div style="border: 1px solid var(--border-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: var(--text-primary);">‰ºÅ‰∏öÂæÆ‰ø°ÈÄöÁü•</h4>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="wecomEnabled" name="notifications.wecom_enabled">
                                    <span>ÂêØÁî®</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="wecomWebhookUrls">Webhook URL</label>
                                <input type="text" id="wecomWebhookUrls" name="notifications.wecom_webhook_urls" placeholder="https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx (Â§ö‰∏™Áî®ÂàÜÂè∑ÂàÜÈöî)">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Â§ö‰∏™URLÁî®ÂàÜÂè∑ÊàñÈÄóÂè∑ÂàÜÈöîÔºåÂú®‰ºÅ‰∏öÂæÆ‰ø°Áæ§‰∏≠Ê∑ªÂä†Áæ§Êú∫Âô®‰∫∫Ëé∑ÂèñWebhook URL</small>
                            </div>
                            <button type="button" onclick="testNotification('wecom')" class="btn-secondary" style="margin-top: 10px;">üí¨ ÊµãËØï‰ºÅ‰∏öÂæÆ‰ø°ÈÄöÁü•</button>
                        </div>
                        
                        <!-- ÈíâÈíâÈÄöÁü•ÈÖçÁΩÆ -->
                        <div style="border: 1px solid var(--border-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: var(--text-primary);">ÈíâÈíâÈÄöÁü•</h4>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="dingtalkEnabled" name="notifications.dingtalk_enabled">
                                    <span>ÂêØÁî®</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="dingtalkWebhookUrls">Webhook URL</label>
                                <input type="text" id="dingtalkWebhookUrls" name="notifications.dingtalk_webhook_urls" placeholder="https://oapi.dingtalk.com/robot/send?access_token=xxx (Â§ö‰∏™Áî®ÂàÜÂè∑ÂàÜÈöî)">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Â§ö‰∏™URLÁî®ÂàÜÂè∑ÊàñÈÄóÂè∑ÂàÜÈöîÔºåÂú®ÈíâÈíâÁæ§‰∏≠Ê∑ªÂä†Ëá™ÂÆö‰πâÊú∫Âô®‰∫∫Ëé∑ÂèñWebhook URL</small>
                            </div>
                            <button type="button" onclick="testNotification('dingtalk')" class="btn-secondary" style="margin-top: 10px;">üîî ÊµãËØïÈíâÈíâÈÄöÁü•</button>
                        </div>
                    </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" onclick="saveConfigSection('notification')" class="btn-query" style="flex: 1; padding: 12px 20px; font-size: 14px;">üíæ ‰øùÂ≠òÈÄöÁü•ÈÖçÁΩÆ</button>
                    <button type="button" onclick="loadConfig()" class="btn-secondary" style="flex: 1; padding: 12px 20px; font-size: 14px;">üîÑ ÈáçÊñ∞Âä†ËΩΩ</button>
                </div>
            </div>
            
            <!-- Â§á‰ªΩÈÖçÁΩÆÂå∫Âüü -->
            <div id="configSection-backup" class="config-section" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <h2 style="margin-bottom: 10px;">Â§á‰ªΩÈÖçÁΩÆ</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">ÈÖçÁΩÆÊï∞ÊçÆÂ∫ìËá™Âä®Â§á‰ªΩÁ≠ñÁï•ÔºåÊîØÊåÅÊú¨Âú∞Â§á‰ªΩÂíå‰∫ëÂ≠òÂÇ®</p>
                </div>
                
                <form id="backupConfigForm">
                <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: var(--text-primary);">ÂÆöÊó∂Â§á‰ªΩÈÖçÁΩÆ</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">ÈÖçÁΩÆÊï∞ÊçÆÂ∫ìËá™Âä®Â§á‰ªΩÁ≠ñÁï•ÔºåÊîØÊåÅÊú¨Âú∞Â§á‰ªΩÂíå‰∫ëÂ≠òÂÇ®</p>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="backupEnabled" name="backup.backup_enabled">
                                <span>ÂêØÁî®ÂÆöÊó∂Â§á‰ªΩ</span>
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label for="backupFrequency">Â§á‰ªΩÈ¢ëÁéá</label>
                            <select id="backupFrequency" name="backup.frequency">
                                <option value="daily">ÊØèÂ§©</option>
                                <option value="weekly">ÊØèÂë®</option>
                                <option value="monthly">ÊØèÊúà</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="backupTime">Â§á‰ªΩÊó∂Èó¥</label>
                            <input type="time" id="backupTime" name="backup.backup_time" placeholder="02:00">
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">24Â∞èÊó∂Âà∂Ôºå‰æãÂ¶ÇÔºö02:00 Ë°®Á§∫ÂáåÊô®2ÁÇπ</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="backupDir">Â§á‰ªΩÁõÆÂΩï</label>
                            <input type="text" id="backupDir" name="backup.backup_dir" placeholder="./backups">
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Â§á‰ªΩÊñá‰ª∂‰øùÂ≠òÁöÑÊú¨Âú∞ÁõÆÂΩïË∑ØÂæÑ</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="backupDatabases">Ë¶ÅÂ§á‰ªΩÁöÑÊï∞ÊçÆÂ∫ì</label>
                            <input type="text" id="backupDatabases" name="backup.databases" placeholder="users,traffic">
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Êï∞ÊçÆÂ∫ìÂêçÁß∞ÔºåÁî®ÈÄóÂè∑ÂàÜÈöîÔºà‰æãÂ¶ÇÔºöusers,trafficÔºâ</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="backupKeepCount">‰øùÁïôÂ§á‰ªΩÊï∞Èáè</label>
                            <input type="number" id="backupKeepCount" name="backup.keep_count" min="1" placeholder="30">
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">‰øùÁïôÊúÄËøëN‰∏™Â§á‰ªΩÊñá‰ª∂ÔºåË∂ÖÂá∫Êï∞ÈáèÁöÑÊóßÂ§á‰ªΩÂ∞ÜË¢´Ëá™Âä®Âà†Èô§</small>
                        </div>
                        
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="backupCompress" name="backup.compress" checked>
                                <span>ÂéãÁº©Â§á‰ªΩÊñá‰ª∂</span>
                            </label>
                        </div>
                        
                        <div style="border-top: 1px solid var(--border-color); padding-top: 15px; margin-top: 15px;">
                            <h4 style="margin-bottom: 10px; color: var(--text-primary);">‰∫ëÂ≠òÂÇ®ÈÖçÁΩÆÔºàÂèØÈÄâÔºâ</h4>
                            
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="cloudEnabled" name="backup.cloud_enabled">
                                    <span>ÂêØÁî®‰∫ëÂ≠òÂÇ®</span>
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label for="cloudType">‰∫ëÂ≠òÂÇ®Á±ªÂûã</label>
                                <select id="cloudType" name="backup.cloud_type">
                                    <option value="s3">AWS S3</option>
                                    <option value="oss">ÈòøÈáå‰∫ë OSS</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="cloudBucket">Â≠òÂÇ®Ê°∂ÂêçÁß∞</label>
                                <input type="text" id="cloudBucket" name="backup.cloud_bucket" placeholder="your-bucket-name">
                            </div>
                            
                            <div class="form-group">
                                <label for="cloudRegion">Âå∫Âüü</label>
                                <input type="text" id="cloudRegion" name="backup.cloud_region" placeholder="us-east-1">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">AWS S3 Âå∫ÂüüÔºà‰æãÂ¶ÇÔºöus-east-1ÔºâÊàñÈòøÈáå‰∫ë OSS Âå∫Âüü</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="cloudAccessKey">ËÆøÈóÆÂØÜÈí•</label>
                                <input type="text" id="cloudAccessKey" name="backup.cloud_access_key" placeholder="ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπ">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπÂΩìÂâçÂØÜÈí•</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="cloudSecretKey">ÂØÜÈí•</label>
                                <input type="password" id="cloudSecretKey" name="backup.cloud_secret_key" placeholder="ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπ">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπÂΩìÂâçÂØÜÈí•</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="cloudEndpoint">Á´ØÁÇπÔºàOSS‰∏ìÁî®Ôºâ</label>
                                <input type="text" id="cloudEndpoint" name="backup.cloud_endpoint" placeholder="oss-cn-hangzhou.aliyuncs.com">
                                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">‰ªÖÂú®‰ΩøÁî®ÈòøÈáå‰∫ë OSS Êó∂ÈúÄË¶ÅÂ°´ÂÜô</small>
                            </div>
                            
                            <button type="button" onclick="testBackupConfig()" class="btn-secondary" style="margin-top: 10px;">üîß ÊµãËØïÂ§á‰ªΩÈÖçÁΩÆ</button>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" onclick="saveConfigSection('backup')" class="btn-query" style="flex: 1; padding: 12px 20px; font-size: 14px;">üíæ ‰øùÂ≠òÂ§á‰ªΩÈÖçÁΩÆ</button>
                    <button type="button" onclick="loadConfig()" class="btn-secondary" style="flex: 1; padding: 12px 20px; font-size: 14px;">üîÑ ÈáçÊñ∞Âä†ËΩΩ</button>
                </div>
                </form>
            </div>
            
            <!-- Êä•Ë°®ÈÖçÁΩÆÂå∫Âüü -->
            <div id="configSection-report" class="config-section" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <h2 style="margin-bottom: 10px;">Êä•Ë°®ÈÖçÁΩÆ</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">ÈÖçÁΩÆÂÆöÊó∂Êä•Ë°®ÁîüÊàêÁ≠ñÁï•ÂíåÊ†ºÂºè</p>
                </div>
                
                <form id="reportConfigForm">
                <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: var(--text-primary);">ÂÆöÊó∂Êä•Ë°®ÈÖçÁΩÆ</h3>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="reportEnabled" name="report.report_enabled">
                                <span>ÂêØÁî®Êä•Ë°®ÁîüÊàê</span>
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label for="dailyEnabled" class="checkbox-label">
                                <input type="checkbox" id="dailyEnabled" name="report.daily_enabled" checked>
                                <span>ÂêØÁî®Êó•Êä•</span>
                            </label>
                            <input type="time" id="dailyTime" name="report.daily_time" value="02:00" style="margin-top: 8px; width: 150px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="weeklyEnabled" class="checkbox-label">
                                <input type="checkbox" id="weeklyEnabled" name="report.weekly_enabled" checked>
                                <span>ÂêØÁî®Âë®Êä•</span>
                            </label>
                            <div style="margin-top: 8px; display: flex; gap: 10px; align-items: center;">
                                <input type="time" id="weeklyTime" name="report.weekly_time" value="02:00" style="width: 150px;">
                                <select id="weeklyDay" name="report.weekly_day" style="width: 120px;">
                                    <option value="monday">Âë®‰∏Ä</option>
                                    <option value="tuesday">Âë®‰∫å</option>
                                    <option value="wednesday">Âë®‰∏â</option>
                                    <option value="thursday">Âë®Âõõ</option>
                                    <option value="friday">Âë®‰∫î</option>
                                    <option value="saturday">Âë®ÂÖ≠</option>
                                    <option value="sunday">Âë®Êó•</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="monthlyEnabled" class="checkbox-label">
                                <input type="checkbox" id="monthlyEnabled" name="report.monthly_enabled" checked>
                                <span>ÂêØÁî®ÊúàÊä•</span>
                            </label>
                            <div style="margin-top: 8px; display: flex; gap: 10px; align-items: center;">
                                <input type="time" id="monthlyTime" name="report.monthly_time" value="02:00" style="width: 150px;">
                                <input type="number" id="monthlyDay" name="report.monthly_day" value="1" min="1" max="28" style="width: 80px;" placeholder="Êó•Êúü">
                                <span style="color: var(--text-secondary);">Âè∑</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="reportDir">Êä•Ë°®Â≠òÂÇ®ÁõÆÂΩï</label>
                            <input type="text" id="reportDir" name="report.report_dir" value="./reports" placeholder="./reports">
                        </div>
                        
                        <div class="form-group">
                            <label for="reportKeepCount">‰øùÁïôÊä•Ë°®Êï∞Èáè</label>
                            <input type="number" id="reportKeepCount" name="report.keep_count" value="30" min="1" placeholder="30">
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">‰øùÁïôÊúÄËøëN‰∏™Êä•Ë°®</small>
                        </div>
                        
                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px;">Êä•Ë°®Ê†ºÂºè</label>
                            <div style="display: flex; gap: 15px;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="generatePdf" name="report.generate_pdf" checked>
                                    <span>PDF</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="generateHtml" name="report.generate_html" checked>
                                    <span>HTML</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="generateExcel" name="report.generate_excel" checked>
                                    <span>Excel</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="pdfLibrary">PDFÁîüÊàêÂ∫ì</label>
                            <select id="pdfLibrary" name="report.pdf_library">
                                <option value="reportlab">ReportLab</option>
                                <option value="weasyprint">WeasyPrint</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="reportEmailEnabled" name="report.email_enabled">
                                <span>ÂêØÁî®ÈÇÆ‰ª∂ÂèëÈÄÅ</span>
                            </label>
                            <input type="text" id="reportEmailRecipients" name="report.email_recipients" placeholder="admin@example.com" style="margin-top: 8px; width: 100%;">
                            <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Â§ö‰∏™Êî∂‰ª∂‰∫∫Áî®ÈÄóÂè∑ÂàÜÈöî</small>
                        </div>
                        
                        <button type="button" onclick="testReportConfig()" class="btn-secondary" style="margin-top: 10px;">üîß ÊµãËØïÊä•Ë°®ÈÖçÁΩÆ</button>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" onclick="saveConfigSection('report')" class="btn-query" style="flex: 1; padding: 12px 20px; font-size: 14px;">üíæ ‰øùÂ≠òÊä•Ë°®ÈÖçÁΩÆ</button>
                    <button type="button" onclick="loadConfig()" class="btn-secondary" style="flex: 1; padding: 12px 20px; font-size: 14px;">üîÑ ÈáçÊñ∞Âä†ËΩΩ</button>
                </div>
                </form>
            </div>
            
            <!-- Êó•ÂøóÈÖçÁΩÆÂå∫Âüü -->
            <div id="configSection-log" class="config-section" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <h2 style="margin-bottom: 10px;">Êó•ÂøóÁÆ°ÁêÜ</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">ÈÖçÁΩÆÊó•ÂøóÁ≥ªÁªüÂíåÊü•ÁúãÊó•ÂøóÊñá‰ª∂</p>
                </div>
                
                <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h2 style="margin-bottom: 15px; color: var(--text-primary);">Êó•ÂøóÁÆ°ÁêÜ</h2>
                        <form id="logConfigForm">
                            <div id="logConfigError" class="error" style="display: none; margin-bottom: 15px;"></div>
                            <div id="logConfigSuccess" class="success" style="display: none; margin-bottom: 15px;"></div>
                            
                            <h3 style="margin-bottom: 15px; color: var(--text-primary);">Êó•ÂøóÁ≥ªÁªüÈÖçÁΩÆ</h3>
                        <div class="form-group">
                            <label for="logLevel">Êó•ÂøóÁ∫ßÂà´</label>
                            <select id="logLevel" name="logging.log_level">
                                <option value="DEBUG">DEBUG</option>
                                <option value="INFO" selected>INFO</option>
                                <option value="WARNING">WARNING</option>
                                <option value="ERROR">ERROR</option>
                                <option value="CRITICAL">CRITICAL</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="logFormat">Êó•ÂøóÊ†ºÂºè</label>
                            <select id="logFormat" name="logging.log_format">
                                <option value="text">ÊñáÊú¨Ê†ºÂºè</option>
                                <option value="json">JSONÊ†ºÂºè</option>
                                <option value="both" selected>‰∏§ËÄÖ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="logDir">Êó•ÂøóÂ≠òÂÇ®ÁõÆÂΩï</label>
                            <input type="text" id="logDir" name="logging.log_dir" value="./logs" placeholder="./logs">
                        </div>
                        <div class="form-group">
                            <label for="logMaxBytes">Êó•ÂøóÊñá‰ª∂Â§ßÂ∞èÈôêÂà∂ÔºàMBÔºâ</label>
                            <input type="number" id="logMaxBytes" name="logging.log_max_bytes" value="10" min="1" placeholder="10">
                        </div>
                        <div class="form-group">
                            <label for="logBackupCount">Êó•ÂøóÊñá‰ª∂Â§á‰ªΩÊï∞Èáè</label>
                            <input type="number" id="logBackupCount" name="logging.log_backup_count" value="30" min="1" placeholder="30">
                        </div>
                        <div class="form-group">
                            <label for="logRotation">Êó•ÂøóÊªöÂä®Á≠ñÁï•</label>
                            <select id="logRotation" name="logging.log_rotation">
                                <option value="size">ÊåâÂ§ßÂ∞è</option>
                                <option value="time">ÊåâÊó∂Èó¥</option>
                                <option value="both" selected>‰∏§ËÄÖ</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="logToConsole" name="logging.log_to_console" checked>
                                <span>ËæìÂá∫Âà∞ÊéßÂà∂Âè∞</span>
                            </label>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="logToFile" name="logging.log_to_file" checked>
                                <span>ËæìÂá∫Âà∞Êñá‰ª∂</span>
                            </label>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px; margin-bottom: 20px;">
                            <button type="button" onclick="saveLogConfig()" class="btn-query" style="flex: 1; padding: 12px 20px; font-size: 14px;">üíæ ‰øùÂ≠òÊó•ÂøóÈÖçÁΩÆ</button>
                            <button type="button" onclick="loadLogConfig()" class="btn-secondary" style="flex: 1; padding: 12px 20px; font-size: 14px;">üîÑ ÈáçÊñ∞Âä†ËΩΩ</button>
                        </div>
                        </form>
                        
                        <!-- Êó•ÂøóÊü•Áúã -->
                        <div style="margin-top: 30px;">
                            <h3 style="margin-bottom: 15px; color: var(--text-primary);">Êó•ÂøóÊü•Áúã</h3>
                        <div style="margin-bottom: 15px;">
                            <label for="logFileSelect" style="margin-right: 10px;">ÈÄâÊã©Êó•ÂøóÊñá‰ª∂Ôºö</label>
                            <select id="logFileSelect" onchange="loadLogFile()" style="width: 300px; padding: 8px;">
                                <option value="">ËØ∑ÈÄâÊã©Êó•ÂøóÊñá‰ª∂</option>
                            </select>
                            <button type="button" onclick="refreshLogFiles()" class="btn-secondary" style="margin-left: 10px;">üîÑ Âà∑Êñ∞ÂàóË°®</button>
                        </div>
                        <div style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <div>
                                <label for="logLevelFilter" style="margin-right: 5px;">Á∫ßÂà´Ôºö</label>
                                <select id="logLevelFilter" onchange="filterLogs()" style="width: 120px; padding: 6px;">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="DEBUG">DEBUG</option>
                                    <option value="INFO">INFO</option>
                                    <option value="WARNING">WARNING</option>
                                    <option value="ERROR">ERROR</option>
                                    <option value="CRITICAL">CRITICAL</option>
                                </select>
                            </div>
                            <div>
                                <label for="logSearch" style="margin-right: 5px;">ÊêúÁ¥¢Ôºö</label>
                                <input type="text" id="logSearch" placeholder="ÂÖ≥ÈîÆÂ≠óÊêúÁ¥¢" onkeyup="filterLogs()" style="width: 200px; padding: 6px;">
                            </div>
                            <div>
                                <label for="logPageSize" style="margin-right: 5px;">ÊØèÈ°µÔºö</label>
                                <select id="logPageSize" onchange="filterLogs()" style="width: 80px; padding: 6px;">
                                    <option value="50">50</option>
                                    <option value="100" selected>100</option>
                                    <option value="200">200</option>
                                    <option value="500">500</option>
                                </select>
                            </div>
                            <button type="button" onclick="downloadLogFile()" class="btn-secondary">üì• ‰∏ãËΩΩÊó•Âøó</button>
                        </div>
                        <div id="logViewer" style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 6px; padding: 15px; max-height: 600px; overflow-y: auto; font-family: monospace; font-size: 12px; line-height: 1.6;">
                            <div style="text-align: center; color: var(--text-secondary); padding: 40px;">
                                ËØ∑ÈÄâÊã©Êó•ÂøóÊñá‰ª∂Êü•Áúã
                            </div>
                        </div>
                        <div id="logPagination" style="margin-top: 15px; display: flex; justify-content: center; align-items: center; gap: 10px; display: none;">
                            <button type="button" onclick="changeLogPage(-1)" class="btn-secondary">‰∏ä‰∏ÄÈ°µ</button>
                            <span id="logPageInfo" style="color: var(--text-secondary);"></span>
                            <button type="button" onclick="changeLogPage(1)" class="btn-secondary">‰∏ã‰∏ÄÈ°µ</button>
                        </div>
                    </div>
                </div>
            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = '/api/user';
        
        // ‰∏ªÈ¢òÂàáÊç¢ÂäüËÉΩ
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
            localStorage.setItem('theme', newTheme);
        }
        
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
                themeToggle.title = theme === 'light' ? 'ÂàáÊç¢Âà∞ÊöóËâ≤‰∏ªÈ¢ò' : 'ÂàáÊç¢Âà∞‰∫ÆËâ≤‰∏ªÈ¢ò';
            }
            
            // Êõ¥Êñ∞ÊâÄÊúâÂõæË°®‰∏ªÈ¢òÔºàÂ¶ÇÊûúÂõæË°®Â∑≤ÂàõÂª∫Ôºâ
            updateChartsTheme(theme);
        }
        
        // Ëé∑ÂèñÂõæË°®‰∏ªÈ¢òÈÖçÁΩÆ
        function getChartThemeConfig() {
            const theme = document.documentElement.getAttribute('data-theme') || 'light';
            const isDark = theme === 'dark';
            
            return {
                backgroundColor: isDark ? '#2d2d2d' : '#ffffff',
                textColor: isDark ? '#b0b0b0' : '#333333',
                gridColor: isDark ? '#404040' : '#e0e0e0',
                borderColor: isDark ? '#404040' : '#e0e0e0'
            };
        }
        
        // Êõ¥Êñ∞ÂõæË°®‰∏ªÈ¢ò
        function updateChartsTheme(theme) {
            try {
                const config = getChartThemeConfig();
                
                // Êõ¥Êñ∞ÊµÅÈáèË∂ãÂäøÂõæÔºà‰ΩøÁî®windowÂØπË±°ËÆøÈóÆÔºåÈÅøÂÖçÂàùÂßãÂåñÈîôËØØÔºâ
                if (window.trafficTrendChart) {
                    if (window.trafficTrendChart.options && window.trafficTrendChart.options.plugins) {
                        if (window.trafficTrendChart.options.plugins.legend) {
                            window.trafficTrendChart.options.plugins.legend.labels.color = config.textColor;
                        }
                        if (window.trafficTrendChart.options.plugins.title) {
                            window.trafficTrendChart.options.plugins.title.color = config.textColor;
                        }
                    }
                    if (window.trafficTrendChart.options && window.trafficTrendChart.options.scales) {
                        if (window.trafficTrendChart.options.scales.x) {
                            window.trafficTrendChart.options.scales.x.ticks.color = config.textColor;
                            window.trafficTrendChart.options.scales.x.grid.color = config.gridColor;
                        }
                        if (window.trafficTrendChart.options.scales.y) {
                            window.trafficTrendChart.options.scales.y.ticks.color = config.textColor;
                            window.trafficTrendChart.options.scales.y.grid.color = config.gridColor;
                            if (window.trafficTrendChart.options.scales.y.title) {
                                window.trafficTrendChart.options.scales.y.title.color = config.textColor;
                            }
                        }
                    }
                    if (typeof window.trafficTrendChart.update === 'function') {
                    window.trafficTrendChart.update();
                    }
                }
                
                // Êõ¥Êñ∞ËÆæÂ§áÂØπÊØîÂõæ
                if (window.deviceComparisonChart) {
                    if (window.deviceComparisonChart.options && window.deviceComparisonChart.options.plugins) {
                        if (window.deviceComparisonChart.options.plugins.legend) {
                            window.deviceComparisonChart.options.plugins.legend.labels.color = config.textColor;
                        }
                        if (window.deviceComparisonChart.options.plugins.title) {
                            window.deviceComparisonChart.options.plugins.title.color = config.textColor;
                        }
                    }
                    if (window.deviceComparisonChart.options && window.deviceComparisonChart.options.scales) {
                        if (window.deviceComparisonChart.options.scales.x) {
                            window.deviceComparisonChart.options.scales.x.ticks.color = config.textColor;
                            window.deviceComparisonChart.options.scales.x.grid.color = config.gridColor;
                        }
                        if (window.deviceComparisonChart.options.scales.y) {
                            window.deviceComparisonChart.options.scales.y.ticks.color = config.textColor;
                            window.deviceComparisonChart.options.scales.y.grid.color = config.gridColor;
                            if (window.deviceComparisonChart.options.scales.y.title) {
                                window.deviceComparisonChart.options.scales.y.title.color = config.textColor;
                            }
                        }
                    }
                    if (typeof window.deviceComparisonChart.update === 'function') {
                    window.deviceComparisonChart.update();
                    }
                }
                
                // Êõ¥Êñ∞ÊµÅÈáèÂàÜÂ∏ÉÂõæ
                if (window.trafficDistributionChart) {
                    if (window.trafficDistributionChart.options && window.trafficDistributionChart.options.plugins && window.trafficDistributionChart.options.plugins.legend) {
                        window.trafficDistributionChart.options.plugins.legend.labels.color = config.textColor;
                    }
                    if (typeof window.trafficDistributionChart.update === 'function') {
                    window.trafficDistributionChart.update();
                    }
                }
                
                // Êõ¥Êñ∞Êó∂Èó¥ÊÆµÂØπÊØîÂõæ
                if (window.periodComparisonChart) {
                    if (window.periodComparisonChart.options && window.periodComparisonChart.options.plugins) {
                        if (window.periodComparisonChart.options.plugins.legend) {
                            window.periodComparisonChart.options.plugins.legend.labels.color = config.textColor;
                        }
                    }
                    if (window.periodComparisonChart.options && window.periodComparisonChart.options.scales) {
                        if (window.periodComparisonChart.options.scales.x) {
                            window.periodComparisonChart.options.scales.x.ticks.color = config.textColor;
                            window.periodComparisonChart.options.scales.x.grid.color = config.gridColor;
                        }
                        if (window.periodComparisonChart.options.scales.y) {
                            window.periodComparisonChart.options.scales.y.ticks.color = config.textColor;
                            window.periodComparisonChart.options.scales.y.grid.color = config.gridColor;
                        }
                    }
                    if (typeof window.periodComparisonChart.update === 'function') {
                    window.periodComparisonChart.update();
                    }
                }
            } catch (error) {
                // ÈùôÈªòÂ§ÑÁêÜÈîôËØØÔºåÂõæË°®ÂèØËÉΩËøòÊú™ÂàùÂßãÂåñ
                console.debug('Êõ¥Êñ∞ÂõæË°®‰∏ªÈ¢òÊó∂Âá∫ÈîôÔºàÂõæË°®ÂèØËÉΩÂ∞öÊú™ÂàõÂª∫Ôºâ:', error);
            }
        }
        
        // ÂàùÂßãÂåñ‰∏ªÈ¢ò
        initTheme();
        
        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩïÔºàÈ°µÈù¢Âä†ËΩΩÊó∂ÈùôÈªòÊ£ÄÊü•Ôºå‰∏çÊòæÁ§∫ÈîôËØØÔºâ
        checkLoginStatus();
        
        function showMessage(containerId, message, isError = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="${isError ? 'error' : 'success'}">${message}</div>`;
        }
        
        function showLogin() {
            document.getElementById('authContainer').style.display = 'block';
            document.getElementById('userCenter').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('message').innerHTML = '';
            document.body.classList.remove('user-center-active');
        }
        
        function showRegister() {
            document.getElementById('authContainer').style.display = 'block';
            document.getElementById('userCenter').style.display = 'none';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('register-message').innerHTML = '';
            document.body.classList.remove('user-center-active');
        }
        
        function showUserCenter() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('userCenter').style.display = 'block';
            document.body.classList.add('user-center-active');
            loadUserInfo();
            // ÂºÄÂßãÂä†ËΩΩÊ¥ªË∑ÉÂëäË≠¶
            updateActiveAlerts();
            // ÂÆöÊúüÊõ¥Êñ∞Ê¥ªË∑ÉÂëäË≠¶ÔºàÊØè30ÁßíÔºâ
            if (!window.activeAlertsInterval) {
                window.activeAlertsInterval = setInterval(updateActiveAlerts, 30000);
            }
        }
        
        // Ê†áÁ≠æÈ°µÂàáÊç¢
        function switchTab(tabName) {
            // Êõ¥Êñ∞Ê†áÁ≠æÊ†∑Âºè
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            // ÊâæÂà∞ÂØπÂ∫îÁöÑÊåâÈíÆÂπ∂ËÆæÁΩÆ‰∏∫active
            const buttons = document.querySelectorAll('.tab');
            buttons.forEach(btn => {
                if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(`'${tabName}'`)) {
                    btn.classList.add('active');
                }
            });
            
            // Êõ¥Êñ∞ÂÜÖÂÆπÊòæÁ§∫
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            if (tabName === 'userInfo') {
                document.getElementById('userInfoTab').classList.add('active');
            } else if (tabName === 'dashboard') {
                document.getElementById('dashboardTab').classList.add('active');
                // ÂàùÂßãÂåñ‰ª™Ë°®Áõò
                initDashboard();
            } else if (tabName === 'charts') {
                document.getElementById('chartsTab').classList.add('active');
                // ÂàùÂßãÂåñÂõæË°®È°µÈù¢
                initChartsPage();
            } else if (tabName === 'statistics') {
                document.getElementById('statisticsTab').classList.add('active');
                // ÂàùÂßãÂåñÁªüËÆ°ÂàÜÊûêÈ°µÈù¢
                initStatisticsPage();
            } else if (tabName === 'dataManagement') {
                document.getElementById('dataManagementTab').classList.add('active');
                // ÂàùÂßãÂåñÊï∞ÊçÆÁÆ°ÁêÜÈ°µÈù¢
                initDataManagementPage();
            } else if (tabName === 'reportManagement') {
                document.getElementById('reportManagementTab').classList.add('active');
                // ÂàùÂßãÂåñÊä•Ë°®ÁÆ°ÁêÜÈ°µÈù¢
                initReportPage();
            } else if (tabName === 'alerts') {
                document.getElementById('alertsTab').classList.add('active');
                // ÂàùÂßãÂåñÂëäË≠¶ÁÆ°ÁêÜÈ°µÈù¢
                initAlertsPage();
            } else if (tabName === 'dataQuery') {
                document.getElementById('dataQueryTab').classList.add('active');
            } else if (tabName === 'config') {
                document.getElementById('configTab').classList.add('active');
                // ÂàùÂßãÂåñÈÖçÁΩÆÁÆ°ÁêÜÈ°µÈù¢ÔºöÂÖàÈöêËóèÊâÄÊúâsectionÔºåÁÑ∂ÂêéÂä†ËΩΩÈÖçÁΩÆ
                document.querySelectorAll('.config-section').forEach(sec => {
                    sec.style.display = 'none';
                    sec.classList.remove('active');
                });
                // Á°Æ‰øùÁ≥ªÁªüÈÖçÁΩÆsectionÊòæÁ§∫
                switchConfigSection('system');
                // Âä†ËΩΩÈÖçÁΩÆ
                if (typeof initConfigPage === 'function') {
                initConfigPage();
                } else {
                    loadConfig();
                }
            } else if (tabName === 'userManagement') {
                document.getElementById('userManagementTab').classList.add('active');
                // ÂàùÂßãÂåñÁî®Êà∑ÁÆ°ÁêÜÈ°µÈù¢
                initUserManagementPage();
            } else if (tabName === 'apiStats') {
                document.getElementById('apiStatsTab').classList.add('active');
                // ÂàùÂßãÂåñAPIÁªüËÆ°È°µÈù¢Ôºà‰ºöËá™Âä®ÂêØÂä®Âà∑Êñ∞Ôºâ
                initApiStatsPage();
            } else if (tabName === 'mysqlManagement') {
                document.getElementById('mysqlManagementTab').classList.add('active');
                initMysqlManagementPage();
            }
        }
        
        // ÁôªÂΩïË°®ÂçïÊèê‰∫§
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('message', 'ÁôªÂΩïÊàêÂäüÔºÅ', false);
                    setTimeout(() => {
                        showUserCenter();
                    }, 500);
                } else {
                    showMessage('message', data.message || 'ÁôªÂΩïÂ§±Ë¥•', true);
                }
            } catch (error) {
                showMessage('message', 'ÁΩëÁªúÈîôËØØÔºö' + error.message, true);
            }
        });
        
        // Ê≥®ÂÜåË°®ÂçïÊèê‰∫§
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            
            try {
                const response = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('register-message', `Ê≥®ÂÜåÊàêÂäüÔºÅÊÇ®ÁöÑ Token: ${data.data.token}`, false);
                    setTimeout(() => {
                        showLogin();
                    }, 2000);
                } else {
                    showMessage('register-message', data.message || 'Ê≥®ÂÜåÂ§±Ë¥•', true);
                }
            } catch (error) {
                showMessage('register-message', 'ÁΩëÁªúÈîôËØØÔºö' + error.message, true);
            }
        });
        
        // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
        async function checkLoginStatus() {
            try {
                const response = await fetch(`${API_BASE}/info`, {
                    // Ê∑ªÂä†credentials‰ª•ÊîØÊåÅsession
                    credentials: 'same-origin'
                });
                
                // 401ÊòØÈ¢ÑÊúüÁöÑÔºàÊú™ÁôªÂΩïÔºâÔºå‰∏çËßÜ‰∏∫ÈîôËØØ
                if (response.status === 401) {
                    // Êú™ÁôªÂΩïÔºåÊ≠£Â∏∏ÊÉÖÂÜµÔºå‰∏çÊòæÁ§∫ÈîôËØØ
                    return;
                }
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        showUserCenter();
                    }
                }
            } catch (error) {
                // ÁΩëÁªúÈîôËØØÁ≠âÔºåÈùôÈªòÂ§ÑÁêÜÔºàÊú™ÁôªÂΩïÊòØÊ≠£Â∏∏ÊÉÖÂÜµÔºâ
                console.debug('Login check (expected if not logged in):', error.message);
            }
        }
        
        // ÂÖ®Â±ÄÂèòÈáèÂ≠òÂÇ®ÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ
        let currentUserRole = 'user';
        
        // ÊùÉÈôêÁÆ°ÁêÜÂáΩÊï∞ÔºàÈúÄË¶ÅÂú®loadUserInfo‰πãÂâçÂÆö‰πâÔºâ
        function updateUIByRole(role) {
            // Ê†πÊçÆÁî®Êà∑ËßíËâ≤ÊòæÁ§∫/ÈöêËóèÁÆ°ÁêÜÂäüËÉΩÊ†áÁ≠æ
            const configTabBtn = document.getElementById('configTabBtn');
            const userManagementTabBtn = document.getElementById('userManagementTabBtn');
            const apiStatsTabBtn = document.getElementById('apiStatsTabBtn');
            const mysqlManagementTabBtn = document.getElementById('mysqlManagementTabBtn');
            
            if (role === 'admin') {
                if (configTabBtn) configTabBtn.style.display = 'inline-block';
                if (userManagementTabBtn) userManagementTabBtn.style.display = 'inline-block';
                if (apiStatsTabBtn) apiStatsTabBtn.style.display = 'inline-block';
                if (mysqlManagementTabBtn) mysqlManagementTabBtn.style.display = 'inline-block';
            } else {
                if (configTabBtn) configTabBtn.style.display = 'none';
                if (userManagementTabBtn) userManagementTabBtn.style.display = 'none';
                if (apiStatsTabBtn) apiStatsTabBtn.style.display = 'none';
                if (mysqlManagementTabBtn) mysqlManagementTabBtn.style.display = 'none';
            }
        }
        
        // Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ
        async function loadUserInfo() {
            try {
                const response = await fetch(`${API_BASE}/info`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    throw new Error('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•');
                }
                
                const data = await response.json();
                
                if (data.success) {
                    const user = data.data;
                    currentUserRole = user.role || 'user';  // Â≠òÂÇ®Áî®Êà∑ËßíËâ≤
                    
                    // Ê†πÊçÆÁî®Êà∑ËßíËâ≤ÊòæÁ§∫/ÈöêËóèÂäüËÉΩÊ†áÁ≠æ
                    updateUIByRole(currentUserRole);
                    
                    // ËÆæÁΩÆÈ°∂ÈÉ®Áî®Êà∑ÂêçÂíåÈÄÄÂá∫ÊåâÈíÆ
                    document.getElementById('user-info-header').innerHTML = `
                        <span class="username-display">üë§ ${user.username}</span>
                        <button class="btn-secondary logout-btn" onclick="logout()">ÈÄÄÂá∫ÁôªÂΩï</button>
                    `;
                    
                    document.getElementById('user-info').innerHTML = `
                        <h2>Áî®Êà∑‰ø°ÊÅØ</h2>
                        <div class="info-item">
                            <label>Áî®Êà∑Âêç</label>
                            <div>${user.username}</div>
                        </div>
                        <div class="info-item">
                            <label>ËßíËâ≤</label>
                            <div>${user.role === 'admin' ? 'ÁÆ°ÁêÜÂëò' : 'ÊôÆÈÄöÁî®Êà∑'}</div>
                        </div>
                        <div class="info-item">
                            <label>API Token</label>
                            <div class="token-box" id="token-box">${user.token}</div>
                            <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
                                <button class="copy-btn" onclick="copyToken()" style="padding: 8px 16px !important; font-size: 13px !important; width: auto;">Â§çÂà∂ Token</button>
                            </div>
                        </div>
                        <div class="info-item">
                            <label>ÂàõÂª∫Êó∂Èó¥</label>
                            <div>${new Date(user.created_at).toLocaleString('zh-CN')}</div>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: var(--card-info-bg); border-radius: 6px;">
                            <strong>‰ΩøÁî®ËØ¥ÊòéÔºö</strong><br>
                            ‰ΩøÁî®‰ª•‰∏ãÊñπÂºèÂú® API ËØ∑Ê±Ç‰∏≠ÂåÖÂê´ TokenÔºö<br>
                            <code style="display: block; margin-top: 10px; padding: 8px; background: var(--bg-primary); border-radius: 4px;">
                                curl -H "X-API-Key: ${user.token}" http://localhost:5000/api/monitor
                            </code>
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                                <a href="/api/docs" target="_blank" style="color: var(--accent-color); text-decoration: none; font-weight: 500; display: inline-flex; align-items: center; gap: 6px;">
                                    <span>üìö</span>
                                    <span>Êü•ÁúãÂÆåÊï¥ÁöÑ‰∫§‰∫íÂºèAPIÊñáÊ°£</span>
                                    <span style="font-size: 12px; margin-left: 4px;">‚Üó</span>
                                </a>
                            </div>
                        </div>
                    `;
                } else {
                    showMessage('user-message', data.message || 'Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•', true);
                }
            } catch (error) {
                showMessage('user-message', 'ÁΩëÁªúÈîôËØØÔºö' + error.message, true);
            }
        }
        
        // Â§çÂà∂Token
        function copyToken() {
            const tokenBox = document.getElementById('token-box');
            const token = tokenBox.textContent;
            navigator.clipboard.writeText(token).then(() => {
                alert('Token Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
            }).catch(() => {
                // Â§áÁî®ÊñπÊ°à
                const textarea = document.createElement('textarea');
                textarea.value = token;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Token Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
            });
        }
        
        // Âà∑Êñ∞Token
        async function refreshToken() {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà∑Êñ∞ Token ÂêóÔºüÊóßÁöÑ Token Â∞ÜÁ´ãÂç≥Â§±ÊïàÔºÅ')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/token/refresh`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    alert('Token Âà∑Êñ∞ÊàêÂäüÔºÅ');
                    loadUserInfo();
                } else {
                    alert('Âà∑Êñ∞Â§±Ë¥•Ôºö' + (data.message || 'Êú™Áü•ÈîôËØØ'));
                }
            } catch (error) {
                alert('ÁΩëÁªúÈîôËØØÔºö' + error.message);
            }
        }
        
        // ÈÄÄÂá∫ÁôªÂΩï
        async function logout() {
            try {
                const response = await fetch(`${API_BASE}/logout`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    showLogin();
                }
            } catch (error) {
                console.error('Logout error:', error);
                showLogin();
            }
        }
        
        // ============ Êï∞ÊçÆÊü•ËØ¢ÂäüËÉΩ ============
        let currentPage = 1;
        let currentTable = '';
        let currentDeviceId = '';
        
        // Ë°®ÈÄâÊã©ÂèòÂåñÊó∂
        document.getElementById('tableSelect').addEventListener('change', function() {
            const table = this.value;
            currentTable = table;
            currentPage = 1;
            currentDeviceId = '';
            
            const deviceSelect = document.getElementById('deviceSelect');
            
            if (table === 'device_traffic') {
                deviceSelect.disabled = false;
                loadDevices();
            } else {
                deviceSelect.disabled = true;
                deviceSelect.innerHTML = '<option value="">-- ‰∏çÈÄÇÁî® --</option>';
            }
            
            // Ê∏ÖÁ©∫ÊòæÁ§∫
            document.getElementById('tableContainer').style.display = 'none';
            document.getElementById('statsContainer').style.display = 'none';
            document.getElementById('pagination').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('empty').style.display = 'none';
        });
        
        // Âä†ËΩΩËÆæÂ§áÂàóË°®
        async function loadDevices() {
            try {
                const response = await fetch('/api/database/devices');
                const result = await response.json();
                
                const deviceSelect = document.getElementById('deviceSelect');
                deviceSelect.innerHTML = '<option value="">-- ÂÖ®ÈÉ®ËÆæÂ§á --</option>';
                
                if (result.success && result.data) {
                    result.data.forEach(device => {
                        const option = document.createElement('option');
                        option.value = device.id;
                        option.textContent = `${device.hostname || 'Êú™Áü•'} (${device.mac})`;
                        deviceSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Âä†ËΩΩËÆæÂ§áÂàóË°®Â§±Ë¥•:', error);
            }
        }
        
        // Âä†ËΩΩÊï∞ÊçÆ
        async function loadData() {
            const table = document.getElementById('tableSelect').value;
            if (!table) {
                alert('ËØ∑ÂÖàÈÄâÊã©Ë°®');
                return;
            }
            
            const deviceSelect = document.getElementById('deviceSelect');
            const deviceId = deviceSelect.value;
            
            currentTable = table;
            currentDeviceId = deviceId;
            currentPage = 1;
            
            await fetchData();
        }
        
        // Ëé∑ÂèñÊï∞ÊçÆ
        async function fetchData() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const tableContainer = document.getElementById('tableContainer');
            const statsContainer = document.getElementById('statsContainer');
            const pagination = document.getElementById('pagination');
            const empty = document.getElementById('empty');
            
            // ÊòæÁ§∫Âä†ËΩΩ
            loading.style.display = 'block';
            error.style.display = 'none';
            tableContainer.style.display = 'none';
            statsContainer.style.display = 'none';
            pagination.style.display = 'none';
            empty.style.display = 'none';
            
            try {
                let url = '';
                
                if (currentTable === 'total_traffic') {
                    url = `/api/database/total-traffic?page=${currentPage}&per_page=100`;
                } else if (currentTable === 'device_traffic') {
                    if (!currentDeviceId) {
                        throw new Error('ËØ∑ÈÄâÊã©ËÆæÂ§á');
                    }
                    url = `/api/database/device-traffic/${currentDeviceId}?page=${currentPage}&per_page=100`;
                } else if (currentTable === 'devices') {
                    url = `/api/database/devices`;
                }
                
                const response = await fetch(url);
                const result = await response.json();
                
                loading.style.display = 'none';
                
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•');
                }
                
                // ÊòæÁ§∫ÁªüËÆ°Êï∞ÊçÆ
                if (result.pagination) {
                    showStats(result.pagination);
                } else if (result.count !== undefined) {
                    showStats({ total: result.count });
                }
                
                // ÊòæÁ§∫Ë°®Ê†º
                if (currentTable === 'devices') {
                    displayDevicesTable(result.data || []);
                } else {
                    displayTrafficTable(result.data || []);
                }
                
                // ÁºìÂ≠òÊï∞ÊçÆÁî®‰∫éÂØºÂá∫
                cacheQueryDataForExport(result.data || [], currentTable);
                
                // ÊòæÁ§∫ÂàÜÈ°µ
                if (result.pagination) {
                    displayPagination(result.pagination);
                }
                
            } catch (err) {
                loading.style.display = 'none';
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
            }
        }
        
        // ÊòæÁ§∫ÁªüËÆ°‰ø°ÊÅØ
        function showStats(pagination) {
            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="value">${pagination.total || 0}</div>
                    <div class="label">ÊÄªËÆ∞ÂΩïÊï∞</div>
                </div>
                <div class="stat-card">
                    <div class="value">${pagination.page || 1}</div>
                    <div class="label">ÂΩìÂâçÈ°µÁ†Å</div>
                </div>
                <div class="stat-card">
                    <div class="value">${pagination.pages || 1}</div>
                    <div class="label">ÊÄªÈ°µÊï∞</div>
                </div>
                <div class="stat-card">
                    <div class="value">${pagination.per_page || 100}</div>
                    <div class="label">ÊØèÈ°µËÆ∞ÂΩïÊï∞</div>
                </div>
            `;
            statsContainer.style.display = 'grid';
        }
        
        // ÊòæÁ§∫ËÆæÂ§áË°®
        function displayDevicesTable(data) {
            const tableHead = document.getElementById('tableHead');
            const tableBody = document.getElementById('tableBody');
            const tableContainer = document.getElementById('tableContainer');
            const empty = document.getElementById('empty');
            
            if (data.length === 0) {
                empty.style.display = 'block';
                tableContainer.style.display = 'none';
                return;
            }
            
            tableHead.innerHTML = `
                <tr>
                    <th>ID</th>
                    <th>MACÂú∞ÂùÄ</th>
                    <th>‰∏ªÊú∫Âêç</th>
                    <th>IPÂú∞ÂùÄ</th>
                    <th>ÂàõÂª∫Êó∂Èó¥</th>
                    <th>Êõ¥Êñ∞Êó∂Èó¥</th>
                </tr>
            `;
            
            tableBody.innerHTML = data.map(device => `
                <tr>
                    <td>${device.id}</td>
                    <td>${device.mac || '-'}</td>
                    <td>${device.hostname || 'Êú™Áü•'}</td>
                    <td>${device.ip || '-'}</td>
                    <td>${device.created_at ? new Date(device.created_at).toLocaleString('zh-CN') : '-'}</td>
                    <td>${device.updated_at ? new Date(device.updated_at).toLocaleString('zh-CN') : '-'}</td>
                </tr>
            `).join('');
            
            tableContainer.style.display = 'block';
            empty.style.display = 'none';
        }
        
        // ÊòæÁ§∫ÊµÅÈáèË°®
        function displayTrafficTable(data) {
            const tableHead = document.getElementById('tableHead');
            const tableBody = document.getElementById('tableBody');
            const tableContainer = document.getElementById('tableContainer');
            const empty = document.getElementById('empty');
            
            if (data.length === 0) {
                empty.style.display = 'block';
                tableContainer.style.display = 'none';
                return;
            }
            
            tableHead.innerHTML = `
                <tr>
                    <th>ID</th>
                    ${currentTable === 'device_traffic' ? '<th>ËÆæÂ§áID</th>' : ''}
                    <th>Êó∂Èó¥Êà≥</th>
                    <th>‰∏ãË°åÈÄüÁéá</th>
                    <th>‰∏äË°åÈÄüÁéá</th>
                    <th>Á¥ØËÆ°‰∏ãËΩΩ</th>
                    <th>Á¥ØËÆ°‰∏ä‰º†</th>
                </tr>
            `;
            
            tableBody.innerHTML = data.map(item => `
                <tr>
                    <td>${item.id}</td>
                    ${currentTable === 'device_traffic' ? `<td>${item.device_id}</td>` : ''}
                    <td>${item.timestamp ? new Date(item.timestamp).toLocaleString('zh-CN') : '-'}</td>
                    <td>${item.down_speed?.formatted || item.down_speed?.bytes || '-'}</td>
                    <td>${item.up_speed?.formatted || item.up_speed?.bytes || '-'}</td>
                    <td>${item.total_download?.formatted || item.total_download?.bytes || '-'}</td>
                    <td>${item.total_upload?.formatted || item.total_upload?.bytes || '-'}</td>
                </tr>
            `).join('');
            
            tableContainer.style.display = 'block';
            empty.style.display = 'none';
        }
        
        // ÊòæÁ§∫ÂàÜÈ°µ
        function displayPagination(pagination) {
            const paginationDiv = document.getElementById('pagination');
            
            if (!pagination || pagination.pages <= 1) {
                paginationDiv.style.display = 'none';
                return;
            }
            
            paginationDiv.innerHTML = `
                <button onclick="goToPage(1)" ${!pagination.has_prev ? 'disabled' : ''}>È¶ñÈ°µ</button>
                <button onclick="goToPage(${currentPage - 1})" ${!pagination.has_prev ? 'disabled' : ''}>‰∏ä‰∏ÄÈ°µ</button>
                <span class="page-info">Á¨¨ ${pagination.page} / ${pagination.pages} È°µ (ÂÖ± ${pagination.total} Êù°)</span>
                <button onclick="goToPage(${currentPage + 1})" ${!pagination.has_next ? 'disabled' : ''}>‰∏ã‰∏ÄÈ°µ</button>
                <button onclick="goToPage(${pagination.pages})" ${!pagination.has_next ? 'disabled' : ''}>Êú´È°µ</button>
            `;
            
            paginationDiv.style.display = 'flex';
        }
        
        // Ë∑≥ËΩ¨È°µÈù¢
        function goToPage(page) {
            currentPage = page;
            fetchData();
        }
        
        // ============ Êï∞ÊçÆÂØºÂá∫ÂäüËÉΩ ============
        // ÁºìÂ≠òÂΩìÂâçÊü•ËØ¢ÁªìÊûúÊï∞ÊçÆÔºàÁî®‰∫éÂØºÂá∫Ôºâ
        let currentQueryData = [];
        let currentQueryHeaders = [];
        let currentQueryTableType = '';
        
        // ÁºìÂ≠òÊü•ËØ¢Êï∞ÊçÆÁî®‰∫éÂØºÂá∫
        function cacheQueryDataForExport(data, tableType) {
            currentQueryData = [];
            currentQueryTableType = tableType;
            
            if (!data || data.length === 0) {
                currentQueryHeaders = [];
                return;
            }
            
            if (tableType === 'devices') {
                // ËÆæÂ§áË°®
                currentQueryHeaders = ['ID', 'MACÂú∞ÂùÄ', 'ËÆæÂ§áÂêçÁß∞', 'IPÂú∞ÂùÄ', 'ÂàõÂª∫Êó∂Èó¥', 'Êõ¥Êñ∞Êó∂Èó¥'];
                currentQueryData = data.map(device => [
                    device.id || '',
                    device.mac || '',
                    device.hostname || 'Êú™Áü•',
                    device.ip || '-',
                    device.created_at ? new Date(device.created_at).toLocaleString('zh-CN') : '-',
                    device.updated_at ? new Date(device.updated_at).toLocaleString('zh-CN') : '-'
                ]);
            } else if (tableType === 'total_traffic') {
                // ÂÖ®ÁΩëÊµÅÈáèË°®
                currentQueryHeaders = ['ID', 'Êó∂Èó¥Êà≥', '‰∏ãË°åÈÄüÁéá', '‰∏äË°åÈÄüÁéá', 'ÊÄª‰∏ãËΩΩ', 'ÊÄª‰∏ä‰º†'];
                currentQueryData = data.map(record => {
                    const downSpeed = record.down_speed?.formatted || record.down_speed?.bytes + ' bytes' || '-';
                    const upSpeed = record.up_speed?.formatted || record.up_speed?.bytes + ' bytes' || '-';
                    const totalDownload = record.total_download?.formatted || record.total_download?.bytes + ' bytes' || '-';
                    const totalUpload = record.total_upload?.formatted || record.total_upload?.bytes + ' bytes' || '-';
                    
                    return [
                        record.id || '',
                        record.timestamp ? new Date(record.timestamp).toLocaleString('zh-CN') : '-',
                        downSpeed,
                        upSpeed,
                        totalDownload,
                        totalUpload
                    ];
                });
            } else if (tableType === 'device_traffic') {
                // ËÆæÂ§áÊµÅÈáèË°®
                currentQueryHeaders = ['ID', 'ËÆæÂ§áID', 'Êó∂Èó¥Êà≥', '‰∏ãË°åÈÄüÁéá', '‰∏äË°åÈÄüÁéá', 'ÊÄª‰∏ãËΩΩ', 'ÊÄª‰∏ä‰º†'];
                currentQueryData = data.map(record => {
                    const downSpeed = record.down_speed?.formatted || record.down_speed?.bytes + ' bytes' || '-';
                    const upSpeed = record.up_speed?.formatted || record.up_speed?.bytes + ' bytes' || '-';
                    const totalDownload = record.total_download?.formatted || record.total_download?.bytes + ' bytes' || '-';
                    const totalUpload = record.total_upload?.formatted || record.total_upload?.bytes + ' bytes' || '-';
                    
                    return [
                        record.id || '',
                        record.device_id || '',
                        record.timestamp ? new Date(record.timestamp).toLocaleString('zh-CN') : '-',
                        downSpeed,
                        upSpeed,
                        totalDownload,
                        totalUpload
                    ];
                });
            }
        }
        
        // ÂØºÂá∫CSV
        function exportToCSV() {
            if (!currentTable || currentQueryData.length === 0) {
                alert('ËØ∑ÂÖàÊü•ËØ¢Êï∞ÊçÆ');
                return;
            }
            
            try {
                // ÂáÜÂ§áCSVÂÜÖÂÆπ
                let csvContent = '\uFEFF'; // UTF-8 BOMÔºåÊîØÊåÅExcelÊ≠£Á°ÆÊòæÁ§∫‰∏≠Êñá
                
                // Ê∑ªÂä†Ë°®Â§¥
                csvContent += currentQueryHeaders.join(',') + '\n';
                
                // Ê∑ªÂä†Êï∞ÊçÆË°å
                currentQueryData.forEach(row => {
                    const csvRow = row.map(cell => {
                        // Â§ÑÁêÜÂåÖÂê´ÈÄóÂè∑„ÄÅÂºïÂè∑ÊàñÊç¢Ë°åÁ¨¶ÁöÑÂ≠óÊÆµ
                        if (typeof cell === 'string' && (cell.includes(',') || cell.includes('"') || cell.includes('\n'))) {
                            return '"' + cell.replace(/"/g, '""') + '"';
                        }
                        return cell || '';
                    });
                    csvContent += csvRow.join(',') + '\n';
                });
                
                // ÂàõÂª∫BlobÂπ∂‰∏ãËΩΩ
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `bandix_data_${currentTable}_${new Date().toISOString().slice(0, 10)}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                URL.revokeObjectURL(url);
            } catch (err) {
                alert('ÂØºÂá∫CSVÂ§±Ë¥•: ' + err.message);
                console.error('CSVÂØºÂá∫ÈîôËØØ:', err);
            }
        }
        
        // ÂØºÂá∫Excel
        function exportToExcel() {
            if (!currentTable || currentQueryData.length === 0) {
                alert('ËØ∑ÂÖàÊü•ËØ¢Êï∞ÊçÆ');
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Âä†ËΩΩxlsxÂ∫ì
            if (typeof XLSX === 'undefined') {
                alert('ExcelÂØºÂá∫ÂäüËÉΩÈúÄË¶ÅÂä†ËΩΩxlsxÂ∫ìÔºåËØ∑Á®çÂÄôÈáçËØï');
                return;
            }
            
            try {
                // ÂàõÂª∫Â∑•‰ΩúÁ∞ø
                const wb = XLSX.utils.book_new();
                
                // ÂáÜÂ§áÊï∞ÊçÆÔºàÂåÖÂê´Ë°®Â§¥Ôºâ
                const wsData = [currentQueryHeaders, ...currentQueryData];
                
                // ÂàõÂª∫Â∑•‰ΩúË°®
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                
                // ËÆæÁΩÆÂàóÂÆΩÔºàÂèØÈÄâÔºâ
                const colWidths = currentQueryHeaders.map(() => ({ wch: 15 }));
                ws['!cols'] = colWidths;
                
                // Â∞ÜÂ∑•‰ΩúË°®Ê∑ªÂä†Âà∞Â∑•‰ΩúÁ∞ø
                const sheetName = currentTable.length > 31 ? currentTable.substring(0, 31) : currentTable; // ExcelÂ∑•‰ΩúË°®ÂêçÁß∞ÊúÄÂ§ö31‰∏™Â≠óÁ¨¶
                XLSX.utils.book_append_sheet(wb, ws, sheetName);
                
                // ÁîüÊàêÊñá‰ª∂Âêç
                const fileName = `bandix_data_${currentTable}_${new Date().toISOString().slice(0, 10)}.xlsx`;
                
                // ‰∏ãËΩΩÊñá‰ª∂
                XLSX.writeFile(wb, fileName);
            } catch (err) {
                alert('ÂØºÂá∫ExcelÂ§±Ë¥•: ' + err.message);
                console.error('ExcelÂØºÂá∫ÈîôËØØ:', err);
            }
        }
        
        // ============ ÁªüËÆ°ÂàÜÊûêÂäüËÉΩ ============
        window.trafficDistributionChart = null;
        window.periodComparisonChart = null;
        
        // ÂàùÂßãÂåñÁªüËÆ°ÂàÜÊûêÈ°µÈù¢
        async function initStatisticsPage() {
            await loadStatisticsData();
        }
        
        // Âä†ËΩΩÁªüËÆ°Êï∞ÊçÆ
        async function loadStatisticsData() {
            const error = document.getElementById('statisticsError');
            error.style.display = 'none';
            
            try {
                const response = await fetch('/api/database/stats');
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•');
                }
                
                const data = result.data;
                
                // Ê∏≤ÊüìÊµÅÈáèÁªüËÆ°Ê±áÊÄª
                if (data.traffic_summary) {
                    renderTrafficSummary(data.traffic_summary);
                }
                
                // Ê∏≤ÊüìÈÄüÁéáÁªüËÆ°
                if (data.speed_stats) {
                    renderSpeedStats(data.speed_stats);
                }
                
                // Ê∏≤ÊüìËÆæÂ§áÊéíÂêç
                if (data.device_stats && data.device_stats.ranking) {
                    renderDeviceRanking(data.device_stats.ranking);
                }
                
                // Ê∏≤ÊüìËÆæÂ§áÊµÅÈáèÂç†ÊØî
                if (data.device_stats && data.device_stats.traffic_distribution) {
                    renderTrafficDistribution(data.device_stats.traffic_distribution);
                }
                
                // Ê∏≤ÊüìÊó∂Èó¥ÊÆµÂØπÊØî
                if (data.comparison) {
                    renderPeriodComparison(data.comparison);
                }
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
                console.error('Âä†ËΩΩÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•:', err);
            }
        }
        
        // Ê∏≤ÊüìÊµÅÈáèÁªüËÆ°Ê±áÊÄª
        function renderTrafficSummary(summary) {
            // ‰ªäÊó•
            if (summary.today) {
                document.getElementById('todayDownload').textContent = summary.today.total_download_formatted || '0 B';
                document.getElementById('todayDownloadFormatted').textContent = '';
                
                document.getElementById('todayUpload').textContent = summary.today.total_upload_formatted || '0 B';
                document.getElementById('todayUploadFormatted').textContent = '';
            }
            
            // Êú¨Âë®
            if (summary.this_week) {
                document.getElementById('weekDownload').textContent = summary.this_week.total_download_formatted || '0 B';
                document.getElementById('weekDownloadFormatted').textContent = '';
                
                document.getElementById('weekUpload').textContent = summary.this_week.total_upload_formatted || '0 B';
                document.getElementById('weekUploadFormatted').textContent = '';
            }
            
            // Êú¨Êúà
            if (summary.this_month) {
                document.getElementById('monthDownload').textContent = summary.this_month.total_download_formatted || '0 B';
                document.getElementById('monthDownloadFormatted').textContent = '';
                
                document.getElementById('monthUpload').textContent = summary.this_month.total_upload_formatted || '0 B';
                document.getElementById('monthUploadFormatted').textContent = '';
            }
        }
        
        // Ê∏≤ÊüìÈÄüÁéáÁªüËÆ°
        function renderSpeedStats(stats) {
            // Âπ≥Âùá‰∏ãË°åÈÄüÁéá
            document.getElementById('avgDownSpeed').textContent = stats.avg_down_speed_formatted || '0 B/s';
            document.getElementById('avgDownSpeedFormatted').textContent = '';
            
            // Âπ≥Âùá‰∏äË°åÈÄüÁéá
            document.getElementById('avgUpSpeed').textContent = stats.avg_up_speed_formatted || '0 B/s';
            document.getElementById('avgUpSpeedFormatted').textContent = '';
            
            // Â≥∞ÂÄº‰∏ãË°åÈÄüÁéá
            document.getElementById('peakDownSpeed').textContent = stats.peak_down_speed_formatted || '0 B/s';
            document.getElementById('peakDownSpeedFormatted').textContent = '';
            
            // Â≥∞ÂÄº‰∏äË°åÈÄüÁéá
            document.getElementById('peakUpSpeed').textContent = stats.peak_up_speed_formatted || '0 B/s';
            document.getElementById('peakUpSpeedFormatted').textContent = '';
        }
        
        // Ê∏≤ÊüìËÆæÂ§áÊéíÂêçË°®Ê†º
        function renderDeviceRanking(ranking) {
            const tableBody = document.getElementById('statisticsDeviceRankingTableBody');
            
            if (!ranking || ranking.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">ÊöÇÊó†Êï∞ÊçÆ</td></tr>';
                return;
            }
            
            tableBody.innerHTML = ranking.map((device, index) => {
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${device.device_name || 'Êú™Áü•'}</td>
                        <td>${device.mac || '-'}</td>
                        <td>${device.ip || '-'}</td>
                        <td>${device.total_download_formatted || '-'}</td>
                        <td>${device.total_upload_formatted || '-'}</td>
                        <td>${device.total_traffic_formatted || '-'}</td>
                    </tr>
                `;
            }).join('');
        }
        
        // Ê∏≤ÊüìËÆæÂ§áÊµÅÈáèÂç†ÊØîÈ•ºÂõæ
        function renderTrafficDistribution(distribution) {
            const ctx = document.getElementById('trafficDistributionChart');
            if (!ctx) return;
            
            // ÈîÄÊØÅÁé∞ÊúâÂõæË°®
            if (window.trafficDistributionChart) {
                window.trafficDistributionChart.destroy();
            }
            
            if (!distribution || distribution.length === 0) {
                return;
            }
            
            // ÂáÜÂ§áÊï∞ÊçÆ
            const labels = distribution.map(d => d.device_name || d.mac);
            const data = distribution.map(d => d.total_traffic_bytes);
            const colors = generateColors(distribution.length);
            
            const chartTheme = getChartThemeConfig();
            window.trafficDistributionChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 12
                                },
                                color: chartTheme.textColor
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const item = distribution[context.dataIndex];
                                    const percentage = item.percentage || 0;
                                    return `${label}: ${item.total_traffic_formatted} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Ê∏≤ÊüìÊó∂Èó¥ÊÆµÂØπÊØîÂõæË°®
        function renderPeriodComparison(comparison) {
            const ctx = document.getElementById('periodComparisonChart');
            if (!ctx) return;
            
            // ÈîÄÊØÅÁé∞ÊúâÂõæË°®
            if (window.periodComparisonChart) {
                window.periodComparisonChart.destroy();
            }
            
            // ÂáÜÂ§áÊï∞ÊçÆ
            const labels = [];
            const currentData = [];
            const previousData = [];
            const growthRates = [];
            
            if (comparison.day_over_day) {
                labels.push('Êó•ÂØπÊØî');
                currentData.push(comparison.day_over_day.current.total_traffic_bytes);
                previousData.push(comparison.day_over_day.previous.total_traffic_bytes);
                growthRates.push(comparison.day_over_day.growth_formatted);
            }
            
            if (comparison.week_over_week) {
                labels.push('Âë®ÂØπÊØî');
                currentData.push(comparison.week_over_week.current.total_traffic_bytes);
                previousData.push(comparison.week_over_week.previous.total_traffic_bytes);
                growthRates.push(comparison.week_over_week.growth_formatted);
            }
            
            if (comparison.month_over_month) {
                labels.push('ÊúàÂØπÊØî');
                currentData.push(comparison.month_over_month.current.total_traffic_bytes);
                previousData.push(comparison.month_over_month.previous.total_traffic_bytes);
                growthRates.push(comparison.month_over_month.growth_formatted);
            }
            
            if (labels.length === 0) {
                return;
            }
            
            const chartTheme2 = getChartThemeConfig();
            window.periodComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ÂΩìÂâç',
                            data: currentData,
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '‰∏ä‰∏ÄÊúü',
                            data: previousData,
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: chartTheme2.textColor
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.y || 0;
                                    return `${label}: ${formatBytes(value)}`;
                                },
                                afterLabel: function(context) {
                                    if (context.datasetIndex === 0) {
                                        const index = context.dataIndex;
                                        return `Â¢ûÈïøÁéá: ${growthRates[index]}`;
                                    }
                                    return '';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: chartTheme2.textColor
                            },
                            grid: {
                                color: chartTheme2.gridColor
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatBytes(value);
                                },
                                color: chartTheme2.textColor
                            },
                            grid: {
                                color: chartTheme2.gridColor
                            }
                        }
                    }
                }
            });
        }
        
        // ÁîüÊàêÈ¢úËâ≤Êï∞ÁªÑ
        function generateColors(count) {
            const colors = [
                'rgba(255, 99, 132, 0.8)',
                'rgba(54, 162, 235, 0.8)',
                'rgba(255, 206, 86, 0.8)',
                'rgba(75, 192, 192, 0.8)',
                'rgba(153, 102, 255, 0.8)',
                'rgba(255, 159, 64, 0.8)',
                'rgba(199, 199, 199, 0.8)',
                'rgba(83, 102, 255, 0.8)',
                'rgba(255, 99, 255, 0.8)',
                'rgba(99, 255, 132, 0.8)'
            ];
            
            const result = [];
            for (let i = 0; i < count; i++) {
                result.push(colors[i % colors.length]);
            }
            return result;
        }
        
        // Ê†ºÂºèÂåñÂ≠óËäÇÊï∞ÔºàÁî®‰∫éÂõæË°®Ôºâ
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // ============ Áî®Êà∑ÁÆ°ÁêÜÂäüËÉΩ ============
        
        let userManagementPage = 1;
        let userManagementPerPage = 20;
        
        async function initUserManagementPage() {
            await loadUserList();
        }
        
        async function loadUserList(page = 1) {
            const loading = document.getElementById('userManagementLoading');
            const error = document.getElementById('userManagementError');
            const content = document.getElementById('userManagementContent');
            const tableBody = document.getElementById('userListTableBody');
            
            loading.style.display = 'flex';
            error.style.display = 'none';
            content.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/list?page=${page}&per_page=${userManagementPerPage}`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('ÈúÄË¶ÅÁÆ°ÁêÜÂëòÊùÉÈôê');
                    }
                    throw new Error('Âä†ËΩΩÁî®Êà∑ÂàóË°®Â§±Ë¥•');
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message || 'Âä†ËΩΩÁî®Êà∑ÂàóË°®Â§±Ë¥•');
                }
                
                const data = result.data;
                userManagementPage = data.page;
                
                // Ê∏≤ÊüìÁî®Êà∑ÂàóË°®
                tableBody.innerHTML = '';
                data.users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${escapeHtml(user.username)}</td>
                                <td>${user.role === 'admin' ? 'ÁÆ°ÁêÜÂëò' : 'ÊôÆÈÄöÁî®Êà∑'}</td>
                                <td>${user.is_active ? '<span style="color: var(--success-color);">ÂêØÁî®</span>' : '<span style="color: var(--error-text);">Á¶ÅÁî®</span>'}</td>
                                <td>${user.created_at ? new Date(user.created_at).toLocaleString('zh-CN') : '-'}</td>
                                <td style="white-space: nowrap; text-align: left;">
                                    <button class="btn-secondary" onclick="editUser(${user.id})" style="padding: 5px 8px; margin-right: 4px; font-size: 12px; min-width: auto;">ÁºñËæë</button>
                                    <button class="btn-secondary" onclick="toggleUser(${user.id}, ${user.is_active})" style="padding: 5px 8px; margin-right: 4px; font-size: 12px; min-width: auto;">${user.is_active ? 'Á¶ÅÁî®' : 'ÂêØÁî®'}</button>
                                    <button class="btn-secondary" onclick="deleteUser(${user.id})" style="padding: 5px 8px; background: var(--error-text); color: white; font-size: 12px; min-width: auto;">Âà†Èô§</button>
                                </td>
                    `;
                    tableBody.appendChild(row);
                });
                
                // Ê∏≤ÊüìÂàÜÈ°µ
                renderUserManagementPagination(data.page, data.pages, data.total);
                
                content.style.display = 'block';
                
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
                console.error('Âä†ËΩΩÁî®Êà∑ÂàóË°®Â§±Ë¥•:', err);
            } finally {
                loading.style.display = 'none';
            }
        }
        
        function renderUserManagementPagination(currentPage, totalPages, total) {
            const pagination = document.getElementById('userManagementPagination');
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = `<div style="display: flex; justify-content: space-between; align-items: center;">`;
            html += `<div>ÂÖ± ${total} ‰∏™Áî®Êà∑ÔºåÁ¨¨ ${currentPage}/${totalPages} È°µ</div>`;
            html += `<div style="display: flex; gap: 10px;">`;
            
            if (currentPage > 1) {
                html += `<button class="btn-secondary" onclick="loadUserList(${currentPage - 1})">‰∏ä‰∏ÄÈ°µ</button>`;
            }
            
            // ÊòæÁ§∫È°µÁ†Å
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            if (startPage > 1) {
                html += `<button class="btn-secondary" onclick="loadUserList(1)">1</button>`;
                if (startPage > 2) html += `<span>...</span>`;
            }
            
            for (let i = startPage; i <= endPage; i++) {
                if (i === currentPage) {
                    html += `<button class="btn-query" style="cursor: default;">${i}</button>`;
                } else {
                    html += `<button class="btn-secondary" onclick="loadUserList(${i})">${i}</button>`;
                }
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span>...</span>`;
                html += `<button class="btn-secondary" onclick="loadUserList(${totalPages})">${totalPages}</button>`;
            }
            
            if (currentPage < totalPages) {
                html += `<button class="btn-secondary" onclick="loadUserList(${currentPage + 1})">‰∏ã‰∏ÄÈ°µ</button>`;
            }
            
            html += `</div></div>`;
            pagination.innerHTML = html;
        }
        
        async function editUser(userId) {
            try {
                const response = await fetch(`${API_BASE}/${userId}`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    throw new Error('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•');
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message || 'Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•');
                }
                
                const user = result.data;
                
                // Â°´ÂÖÖË°®Âçï
                document.getElementById('editUserId').value = user.id;
                document.getElementById('editUsername').value = user.username;
                document.getElementById('editUsername').disabled = true;  // Áî®Êà∑Âêç‰∏çÂèØ‰øÆÊîπ
                document.getElementById('editPasswordGroup').style.display = 'block';
                document.getElementById('editPassword').required = false;
                document.getElementById('editRole').value = user.role;
                document.getElementById('editIsActive').checked = user.is_active;
                document.getElementById('userEditModalTitle').textContent = 'ÁºñËæëÁî®Êà∑';
                
                // ÊòæÁ§∫ÂØπËØùÊ°Ü
                document.getElementById('userEditModal').style.display = 'flex';
                
            } catch (err) {
                document.getElementById('userManagementError').style.display = 'block';
                document.getElementById('userManagementError').textContent = 'ÈîôËØØ: ' + err.message;
                console.error('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', err);
            }
        }
        
        function showCreateUserDialog() {
            // Ê∏ÖÁ©∫Ë°®Âçï
            document.getElementById('editUserId').value = '';
            document.getElementById('editUsername').value = '';
            document.getElementById('editUsername').disabled = false;
            document.getElementById('editPasswordGroup').style.display = 'block';
            document.getElementById('editPassword').value = '';
            document.getElementById('editPassword').required = true;
            document.getElementById('editRole').value = 'user';
            document.getElementById('editIsActive').checked = true;
            document.getElementById('userEditModalTitle').textContent = 'ÂàõÂª∫Êñ∞Áî®Êà∑';
            
            // ÊòæÁ§∫ÂØπËØùÊ°Ü
            document.getElementById('userEditModal').style.display = 'flex';
        }
        
        function closeUserEditModal() {
            document.getElementById('userEditModal').style.display = 'none';
            document.getElementById('userEditForm').reset();
        }
        
        async function saveUser(event) {
            event.preventDefault();
            
            const userId = document.getElementById('editUserId').value;
            const username = document.getElementById('editUsername').value.trim();
            const password = document.getElementById('editPassword').value;
            const role = document.getElementById('editRole').value;
            const isActive = document.getElementById('editIsActive').checked;
            
            // È™åËØÅ
            if (!username) {
                alert('Áî®Êà∑Âêç‰∏çËÉΩ‰∏∫Á©∫');
                return;
            }
            
            if (!userId && !password) {
                alert('ÂàõÂª∫Áî®Êà∑Êó∂ÂØÜÁ†Å‰∏çËÉΩ‰∏∫Á©∫');
                return;
            }
            
            try {
                let response;
                let url;
                let method;
                let body = {
                    role: role,
                    is_active: isActive
                };
                
                if (userId) {
                    // Êõ¥Êñ∞Áî®Êà∑
                    url = `${API_BASE}/${userId}`;
                    method = 'PUT';
                    if (password) {
                        body.password = password;
                    }
                } else {
                    // ÂàõÂª∫Áî®Êà∑
                    url = `${API_BASE}/register`;
                    method = 'POST';
                    body.username = username;
                    body.password = password;
                }
                
                response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify(body)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('userManagementSuccess').style.display = 'block';
                    document.getElementById('userManagementSuccess').textContent = userId ? 'Áî®Êà∑‰ø°ÊÅØÊõ¥Êñ∞ÊàêÂäü' : 'Áî®Êà∑ÂàõÂª∫ÊàêÂäü';
                    closeUserEditModal();
                    await loadUserList(userManagementPage);
                    
                    // 3ÁßíÂêéÈöêËóèÊàêÂäüÊ∂àÊÅØ
                    setTimeout(() => {
                        document.getElementById('userManagementSuccess').style.display = 'none';
                    }, 3000);
                } else {
                    throw new Error(result.message || (userId ? 'Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÂ§±Ë¥•' : 'ÂàõÂª∫Áî®Êà∑Â§±Ë¥•'));
                }
                
            } catch (err) {
                document.getElementById('userManagementError').style.display = 'block';
                document.getElementById('userManagementError').textContent = 'ÈîôËØØ: ' + err.message;
                console.error('‰øùÂ≠òÁî®Êà∑Â§±Ë¥•:', err);
            }
        }
        
        async function deleteUser(userId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËØ•Áî®Êà∑ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/${userId}`, {
                    method: 'DELETE',
                    credentials: 'same-origin'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('userManagementSuccess').style.display = 'block';
                    document.getElementById('userManagementSuccess').textContent = 'Áî®Êà∑Â∑≤Âà†Èô§';
                    await loadUserList(userManagementPage);
                    
                    // 3ÁßíÂêéÈöêËóèÊàêÂäüÊ∂àÊÅØ
                    setTimeout(() => {
                        document.getElementById('userManagementSuccess').style.display = 'none';
                    }, 3000);
                } else {
                    throw new Error(result.message || 'Âà†Èô§Áî®Êà∑Â§±Ë¥•');
                }
                
            } catch (err) {
                document.getElementById('userManagementError').style.display = 'block';
                document.getElementById('userManagementError').textContent = 'ÈîôËØØ: ' + err.message;
                console.error('Âà†Èô§Áî®Êà∑Â§±Ë¥•:', err);
            }
        }
        
        async function toggleUser(userId, currentStatus) {
            if (!confirm(`Á°ÆÂÆöË¶Å${currentStatus ? 'Á¶ÅÁî®' : 'ÂêØÁî®'}ËØ•Áî®Êà∑ÂêóÔºü`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/${userId}/toggle`, {
                    method: 'POST',
                    credentials: 'same-origin'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('userManagementSuccess').style.display = 'block';
                    document.getElementById('userManagementSuccess').textContent = result.message || 'Êìç‰ΩúÊàêÂäü';
                    await loadUserList(userManagementPage);
                } else {
                    throw new Error(result.message || 'Êìç‰ΩúÂ§±Ë¥•');
                }
                
            } catch (err) {
                document.getElementById('userManagementError').style.display = 'block';
                document.getElementById('userManagementError').textContent = 'ÈîôËØØ: ' + err.message;
                console.error('ÂàáÊç¢Áî®Êà∑Áä∂ÊÄÅÂ§±Ë¥•:', err);
            }
        }
        
        // ============ ÈÖçÁΩÆÁÆ°ÁêÜÂäüËÉΩ ============
        
        // ÂàùÂßãÂåñÈÖçÁΩÆÁÆ°ÁêÜÈ°µÈù¢
        async function initConfigPage() {
            await loadConfig();
            await loadCollectorStatus();
            await loadLogConfig();
            await refreshLogFiles();
        }
        
        // ============ Êó•ÂøóÁÆ°ÁêÜÂäüËÉΩ ============
        
        let currentLogPage = 1;
        let currentLogFile = '';
        let currentLogTotalPages = 1;
        
        // Âà∑Êñ∞Êó•ÂøóÊñá‰ª∂ÂàóË°®
        async function refreshLogFiles() {
            try {
                const response = await fetch('/api/logs/list', {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    throw new Error('Ëé∑ÂèñÊó•ÂøóÊñá‰ª∂ÂàóË°®Â§±Ë¥•');
                }
                
                const result = await response.json();
                
                if (result.success) {
                    const select = document.getElementById('logFileSelect');
                    select.innerHTML = '<option value="">ËØ∑ÈÄâÊã©Êó•ÂøóÊñá‰ª∂</option>';
                    
                    result.data.forEach(file => {
                        const option = document.createElement('option');
                        option.value = file.name;
                        option.textContent = `${file.name} (${file.size_formatted})`;
                        select.appendChild(option);
                    });
                } else {
                    throw new Error(result.error || 'Ëé∑ÂèñÊó•ÂøóÊñá‰ª∂ÂàóË°®Â§±Ë¥•');
                }
            } catch (err) {
                console.error('Âà∑Êñ∞Êó•ÂøóÊñá‰ª∂ÂàóË°®Â§±Ë¥•:', err);
            }
        }
        
        // Âä†ËΩΩÊó•ÂøóÊñá‰ª∂
        async function loadLogFile() {
            const filename = document.getElementById('logFileSelect').value;
            if (!filename) {
                document.getElementById('logViewer').innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 40px;">ËØ∑ÈÄâÊã©Êó•ÂøóÊñá‰ª∂Êü•Áúã</div>';
                document.getElementById('logPagination').style.display = 'none';
                return;
            }
            
            currentLogFile = filename;
            currentLogPage = 1;
            await filterLogs();
        }
        
        // ËøáÊª§Êó•Âøó
        async function filterLogs() {
            if (!currentLogFile) {
                return;
            }
            
            try {
                const level = document.getElementById('logLevelFilter').value;
                const search = document.getElementById('logSearch').value;
                const pageSize = parseInt(document.getElementById('logPageSize').value);
                
                const params = new URLSearchParams({
                    file: currentLogFile,
                    page: currentLogPage,
                    per_page: pageSize
                });
                
                if (level) params.append('level', level);
                if (search) params.append('search', search);
                
                const response = await fetch(`/api/logs/view?${params.toString()}`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    throw new Error('Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•');
                }
                
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    currentLogTotalPages = data.total_pages;
                    
                    // ÊòæÁ§∫Êó•ÂøóÂÜÖÂÆπ
                    const viewer = document.getElementById('logViewer');
                    if (data.lines.length === 0) {
                        viewer.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 40px;">Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÊó•Âøó</div>';
                    } else {
                        const searchKeyword = search.toLowerCase();
                        let html = '';
                        data.lines.forEach(line => {
                            // È´ò‰∫ÆÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠ó
                            let displayLine = line;
                            if (searchKeyword) {
                                const regex = new RegExp(`(${searchKeyword})`, 'gi');
                                displayLine = displayLine.replace(regex, '<mark style="background: yellow; color: black;">$1</mark>');
                            }
                            
                            // Ê†πÊçÆÊó•ÂøóÁ∫ßÂà´Ê∑ªÂä†È¢úËâ≤
                            let className = 'log-line';
                            if (line.includes('[ERROR]') || line.includes('[CRITICAL]')) {
                                className += ' log-error';
                            } else if (line.includes('[WARNING]')) {
                                className += ' log-warning';
                            } else if (line.includes('[INFO]')) {
                                className += ' log-info';
                            } else if (line.includes('[DEBUG]')) {
                                className += ' log-debug';
                            }
                            
                            html += `<div class="${className}" style="margin-bottom: 2px; padding: 2px 5px; border-radius: 3px;">${displayLine}</div>`;
                        });
                        viewer.innerHTML = html;
                    }
                    
                    // Êõ¥Êñ∞ÂàÜÈ°µ‰ø°ÊÅØ
                    document.getElementById('logPageInfo').textContent = `Á¨¨ ${data.page} È°µ / ÂÖ± ${data.total_pages} È°µ (ÊÄªËÆ° ${data.total} Ë°å)`;
                    document.getElementById('logPagination').style.display = 'flex';
                } else {
                    throw new Error(result.error || 'Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•');
                }
            } catch (err) {
                console.error('Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•:', err);
                document.getElementById('logViewer').innerHTML = `<div style="text-align: center; color: var(--error-text); padding: 40px;">Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•: ${err.message}</div>`;
            }
        }
        
        // ÂàáÊç¢Êó•ÂøóÈ°µÈù¢
        function changeLogPage(delta) {
            const newPage = currentLogPage + delta;
            if (newPage >= 1 && newPage <= currentLogTotalPages) {
                currentLogPage = newPage;
                filterLogs();
            }
        }
        
        // Âä†ËΩΩÊó•ÂøóÈÖçÁΩÆ
        async function loadLogConfig() {
            try {
                const response = await fetch('/api/logs/config', {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    throw new Error('Âä†ËΩΩÊó•ÂøóÈÖçÁΩÆÂ§±Ë¥•');
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    const config = result.data;
                    const logLevelEl = document.getElementById('logLevel');
                    if (logLevelEl) logLevelEl.value = config.log_level || 'INFO';
                    const logFormatEl = document.getElementById('logFormat');
                    if (logFormatEl) logFormatEl.value = config.log_format || 'both';
                    const logDirEl = document.getElementById('logDir');
                    if (logDirEl) logDirEl.value = config.log_dir || './logs';
                    const logMaxBytesEl = document.getElementById('logMaxBytes');
                    if (logMaxBytesEl) logMaxBytesEl.value = config.log_max_bytes || '10';
                    const logBackupCountEl = document.getElementById('logBackupCount');
                    if (logBackupCountEl) logBackupCountEl.value = config.log_backup_count || '30';
                    const logRotationEl = document.getElementById('logRotation');
                    if (logRotationEl) logRotationEl.value = config.log_rotation || 'both';
                    const logToConsoleEl = document.getElementById('logToConsole');
                    if (logToConsoleEl) logToConsoleEl.checked = (config.log_to_console || 'true').toLowerCase() === 'true';
                    const logToFileEl = document.getElementById('logToFile');
                    if (logToFileEl) logToFileEl.checked = (config.log_to_file || 'true').toLowerCase() === 'true';
                }
            } catch (err) {
                console.error('Âä†ËΩΩÊó•ÂøóÈÖçÁΩÆÂ§±Ë¥•:', err);
                const errorEl = document.getElementById('logConfigError');
                if (errorEl) {
                    errorEl.style.display = 'block';
                    errorEl.textContent = 'Âä†ËΩΩÊó•ÂøóÈÖçÁΩÆÂ§±Ë¥•: ' + err.message;
                }
            }
        }
        
        // ‰øùÂ≠òÊó•ÂøóÈÖçÁΩÆ
        async function saveLogConfig() {
            try {
                document.getElementById('logConfigError').style.display = 'none';
                document.getElementById('logConfigSuccess').style.display = 'none';
                
                const formData = {
                    log_level: document.getElementById('logLevel').value,
                    log_format: document.getElementById('logFormat').value,
                    log_dir: document.getElementById('logDir').value.trim(),
                    log_max_bytes: parseInt(document.getElementById('logMaxBytes').value),
                    log_backup_count: parseInt(document.getElementById('logBackupCount').value),
                    log_rotation: document.getElementById('logRotation').value,
                    log_to_console: document.getElementById('logToConsole').checked ? 'true' : 'false',
                    log_to_file: document.getElementById('logToFile').checked ? 'true' : 'false'
                };
                
                const response = await fetch('/api/logs/config', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('logConfigSuccess').style.display = 'block';
                    document.getElementById('logConfigSuccess').textContent = result.message || 'Êó•ÂøóÈÖçÁΩÆÂ∑≤‰øùÂ≠ò';
                    
                    setTimeout(() => {
                        document.getElementById('logConfigSuccess').style.display = 'none';
                    }, 3000);
                } else {
                    throw new Error(result.error || '‰øùÂ≠òÂ§±Ë¥•');
                }
            } catch (err) {
                document.getElementById('logConfigError').style.display = 'block';
                document.getElementById('logConfigError').textContent = '‰øùÂ≠òÂ§±Ë¥•: ' + err.message;
                console.error('‰øùÂ≠òÊó•ÂøóÈÖçÁΩÆÂ§±Ë¥•:', err);
            }
        }
        
        // ‰∏ãËΩΩÊó•ÂøóÊñá‰ª∂
        async function downloadLogFile() {
            const filename = document.getElementById('logFileSelect').value;
            if (!filename) {
                alert('ËØ∑ÂÖàÈÄâÊã©Ë¶Å‰∏ãËΩΩÁöÑÊó•ÂøóÊñá‰ª∂');
                return;
            }
            
            try {
                const response = await fetch(`/api/logs/download/${encodeURIComponent(filename)}`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    throw new Error('‰∏ãËΩΩÊó•ÂøóÊñá‰ª∂Â§±Ë¥•');
                }
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            } catch (err) {
                alert('‰∏ãËΩΩÊó•ÂøóÊñá‰ª∂Â§±Ë¥•: ' + err.message);
                console.error('‰∏ãËΩΩÊó•ÂøóÊñá‰ª∂Â§±Ë¥•:', err);
            }
        }
        
        // ÊµãËØïÂ§á‰ªΩÈÖçÁΩÆ
        // ÊµãËØïÊä•Ë°®ÈÖçÁΩÆ
        async function testReportConfig() {
            try {
                const response = await fetch('/api/report/config/test', {
                    method: 'POST',
                    credentials: 'same-origin'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    let message = 'ÈÖçÁΩÆÊµãËØïÂÆåÊàêÔºö\n';
                    for (const [key, value] of Object.entries(result.results || {})) {
                        message += `\n${key}: ${value.message} ${value.success ? '‚úì' : '‚úó'}`;
                    }
                    alert(message);
                } else {
                    alert('ÈÖçÁΩÆÊµãËØïÂ§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'));
                }
            } catch (err) {
                alert('ÊµãËØïÂ§±Ë¥•: ' + err.message);
            }
        }
        
        async function testBackupConfig() {
            try {
                const response = await fetch('/api/backup/config/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    let message = 'ÊµãËØïÊàêÂäüÔºÅ\n\n';
                    if (result.results) {
                        for (const [key, value] of Object.entries(result.results)) {
                            message += `${key}: ${value.message}\n`;
                        }
                    }
                    alert(message);
                } else {
                    alert('ÊµãËØïÂ§±Ë¥•Ôºö' + (result.error || 'Êú™Áü•ÈîôËØØ'));
                }
            } catch (error) {
                alert('ÊµãËØïÂ§±Ë¥•Ôºö' + error.message);
            }
        }
        
        // ÊµãËØïÈÄöÁü•
        async function testNotification(channel) {
            try {
                const channels = [channel];
                const response = await fetch('/api/config/notifications/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify({ channels: channels })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`ÊµãËØïÊàêÂäüÔºÅ\n\n${result.message}\n\nËØ¶ÁªÜÁªìÊûúÔºö\n${JSON.stringify(result.data.results, null, 2)}`);
                } else {
                    alert('ÊµãËØïÂ§±Ë¥•Ôºö' + (result.error || 'Êú™Áü•ÈîôËØØ'));
                }
            } catch (error) {
                alert('ÊµãËØïÂ§±Ë¥•Ôºö' + error.message);
            }
        }
        
        // ÂàáÊç¢ÈÖçÁΩÆsection
        function switchConfigSection(section) {
            // ÈöêËóèÊâÄÊúâsectionÂπ∂ÁßªÈô§activeÁ±ªÔºàÂº∫Âà∂‰ΩøÁî®ÂÜÖËÅîÊ†∑ÂºèÔºâ
            const allSections = document.querySelectorAll('.config-section');
            allSections.forEach(sec => {
                sec.setAttribute('style', 'display: none !important;');
                sec.classList.remove('active');
            });
            
            // ÁßªÈô§ÊâÄÊúâÂØºËà™È°πÁöÑactiveÁä∂ÊÄÅ
            document.querySelectorAll('.config-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑsectionÂπ∂Ê∑ªÂä†activeÁ±ªÔºàÂº∫Âà∂‰ΩøÁî®ÂÜÖËÅîÊ†∑ÂºèÔºâ
            const selectedSection = document.getElementById(`configSection-${section}`);
            if (selectedSection) {
                selectedSection.setAttribute('style', 'display: block !important;');
                selectedSection.classList.add('active');
            } else {
                console.warn(`ÈÖçÁΩÆsectionÊú™ÊâæÂà∞: configSection-${section}`);
            }
            
            // ÊøÄÊ¥ªÂØπÂ∫îÁöÑÂØºËà™È°π
            const selectedNav = document.querySelector(`.config-nav-item[data-section="${section}"]`);
            if (selectedNav) {
                selectedNav.classList.add('active');
            }
        }
        
        // ‰øùÂ≠òÈÖçÁΩÆsectionÔºàÁî®‰∫éÂ§á‰ªΩ„ÄÅÊä•Ë°®„ÄÅÈÄöÁü•Á≠âÁã¨Á´ãsectionÔºâ
        async function saveConfigSection(section) {
            // ÂØπ‰∫éÈÄöÁü•ÈÖçÁΩÆÂíåÁ≥ªÁªüÈÖçÁΩÆÔºåÈÄöËøáconfigFormÊù•‰øùÂ≠òÔºàsaveConfigÂáΩÊï∞‰ºöÊî∂ÈõÜÊâÄÊúâÈÖçÁΩÆÂåÖÊã¨ÈÄöÁü•Ôºâ
            if (section === 'notification' || section === 'system') {
                const form = document.getElementById('configForm');
                if (form) {
                    form.dispatchEvent(new Event('submit', { cancelable: true }));
                }
            } else if (section === 'backup') {
                const form = document.getElementById('backupConfigForm');
                if (form) form.dispatchEvent(new Event('submit', { cancelable: true }));
            } else if (section === 'report') {
                const form = document.getElementById('reportConfigForm');
                if (form) form.dispatchEvent(new Event('submit', { cancelable: true }));
            } else if (section === 'log') {
                // Êó•ÂøóÈÖçÁΩÆ‰ΩøÁî®Áã¨Á´ãÁöÑsaveLogConfigÂáΩÊï∞
                await saveLogConfig();
            }
        }
        
        // Âä†ËΩΩÈÖçÁΩÆ
        async function loadConfig() {
            try {
                document.getElementById('configLoading').style.display = 'flex';
                // ÊâÄÊúâsectionÂú®Âä†ËΩΩÊó∂ÂÖàÈöêËóè
                document.querySelectorAll('.config-section').forEach(sec => {
                    sec.style.display = 'none';
                });
                document.getElementById('configError').style.display = 'none';
                document.getElementById('configSuccess').style.display = 'none';
                
                const response = await fetch('/api/config', {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    throw new Error('Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•');
                }
                
                const result = await response.json();
                
                if (result.success) {
                    const config = result.data;
                    
                    // Â°´ÂÖÖË°®Âçï
                    if (config.bandix) {
                        document.getElementById('bandixUrl').value = config.bandix.url || '';
                        document.getElementById('bandixUsername').value = config.bandix.username || '';
                        // ÂØÜÁ†ÅÂ≠óÊÆµ‰∏çÂ°´ÂÖÖÔºåÊòæÁ§∫Âç†‰ΩçÁ¨¶
                    }
                    
                    if (config.api) {
                        document.getElementById('apiHost').value = config.api.host || '';
                        document.getElementById('apiPort').value = config.api.port || '';
                        document.getElementById('apiDebug').value = (config.api.debug || 'false').toLowerCase();
                        document.getElementById('apiAuthEnabled').value = (config.api.auth_enabled || 'true').toLowerCase();
                        document.getElementById('apiKey').value = '';
                        document.getElementById('healthCheckRequireAuth').value = (config.api.health_check_require_auth || 'false').toLowerCase();
                    }
                    
                    if (config.collector) {
                        document.getElementById('collectInterval').value = config.collector.collect_interval || '1.0';
                    }
                    
                    // Âä†ËΩΩÂ§á‰ªΩÈÖçÁΩÆ
                    if (config.backup) {
                        const backup = config.backup;
                        const backupEnabledEl = document.getElementById('backupEnabled');
                        if (backupEnabledEl) {
                            backupEnabledEl.checked = backup.backup_enabled === 'true' || backup.backup_enabled === true;
                        }
                        const backupFrequencyEl = document.getElementById('backupFrequency');
                        if (backupFrequencyEl) backupFrequencyEl.value = backup.frequency || 'daily';
                        const backupTimeEl = document.getElementById('backupTime');
                        if (backupTimeEl) backupTimeEl.value = backup.backup_time || '02:00';
                        const backupDirEl = document.getElementById('backupDir');
                        if (backupDirEl) backupDirEl.value = backup.backup_dir || './backups';
                        const backupDatabasesEl = document.getElementById('backupDatabases');
                        if (backupDatabasesEl) backupDatabasesEl.value = backup.databases || 'users,traffic';
                        const backupKeepCountEl = document.getElementById('backupKeepCount');
                        if (backupKeepCountEl) backupKeepCountEl.value = backup.keep_count || '30';
                        const backupCompressEl = document.getElementById('backupCompress');
                        if (backupCompressEl) {
                            backupCompressEl.checked = (backup.compress || 'true').toLowerCase() === 'true';
                        }
                        const cloudEnabledEl = document.getElementById('cloudEnabled');
                        if (cloudEnabledEl) {
                            cloudEnabledEl.checked = backup.cloud_enabled === 'true' || backup.cloud_enabled === true;
                        }
                        const cloudTypeEl = document.getElementById('cloudType');
                        if (cloudTypeEl) cloudTypeEl.value = backup.cloud_type || 's3';
                        const cloudBucketEl = document.getElementById('cloudBucket');
                        if (cloudBucketEl) cloudBucketEl.value = backup.cloud_bucket || '';
                        const cloudRegionEl = document.getElementById('cloudRegion');
                        if (cloudRegionEl) cloudRegionEl.value = backup.cloud_region || '';
                        const cloudEndpointEl = document.getElementById('cloudEndpoint');
                        if (cloudEndpointEl) cloudEndpointEl.value = backup.cloud_endpoint || '';
                        // ÊïèÊÑüÂ≠óÊÆµ‰∏çÂ°´ÂÖÖ
                        const cloudAccessKeyEl = document.getElementById('cloudAccessKey');
                        if (cloudAccessKeyEl) cloudAccessKeyEl.value = '';
                        const cloudSecretKeyEl = document.getElementById('cloudSecretKey');
                        if (cloudSecretKeyEl) cloudSecretKeyEl.value = '';
                    }
                    
                    // Âä†ËΩΩÈÄöÁü•ÈÖçÁΩÆÔºà‰∏çÂåÖÊã¨ÈÇÆ‰ª∂ÈÖçÁΩÆÔºåÈÇÆ‰ª∂ÈÖçÁΩÆÂú®ÂëäË≠¶ÁÆ°ÁêÜÈ°µÈù¢Ôºâ
                    if (config.notifications) {
                        const notif = config.notifications;
                        
                        document.getElementById('webhookEnabled').checked = notif.webhook_enabled === 'true' || notif.webhook_enabled === true;
                        document.getElementById('webhookUrls').value = notif.webhook_urls || '';
                        document.getElementById('webhookHeaders').value = notif.webhook_headers || '{}';
                        
                        if (document.getElementById('telegramEnabled')) {
                            document.getElementById('telegramEnabled').checked = notif.telegram_enabled === 'true' || notif.telegram_enabled === true;
                            document.getElementById('telegramChatIds').value = notif.telegram_chat_ids || '';
                        }
                        
                        if (document.getElementById('wecomEnabled')) {
                            document.getElementById('wecomEnabled').checked = notif.wecom_enabled === 'true' || notif.wecom_enabled === true;
                            document.getElementById('wecomWebhookUrls').value = notif.wecom_webhook_urls || '';
                        }
                        
                        if (document.getElementById('dingtalkEnabled')) {
                            document.getElementById('dingtalkEnabled').checked = notif.dingtalk_enabled === 'true' || notif.dingtalk_enabled === true;
                            document.getElementById('dingtalkWebhookUrls').value = notif.dingtalk_webhook_urls || '';
                        }
                    }
                    
                    // Âä†ËΩΩÊä•Ë°®ÈÖçÁΩÆ
                    if (config.report) {
                        const report = config.report;
                        const reportEnabledEl = document.getElementById('reportEnabled');
                        if (reportEnabledEl) reportEnabledEl.checked = report.report_enabled === 'true' || report.report_enabled === true;
                        const dailyEnabledEl = document.getElementById('dailyEnabled');
                        if (dailyEnabledEl) dailyEnabledEl.checked = (report.daily_enabled || 'true').toLowerCase() === 'true';
                        const dailyTimeEl = document.getElementById('dailyTime');
                        if (dailyTimeEl) dailyTimeEl.value = report.daily_time || '02:00';
                        const weeklyEnabledEl = document.getElementById('weeklyEnabled');
                        if (weeklyEnabledEl) weeklyEnabledEl.checked = (report.weekly_enabled || 'true').toLowerCase() === 'true';
                        const weeklyTimeEl = document.getElementById('weeklyTime');
                        if (weeklyTimeEl) weeklyTimeEl.value = report.weekly_time || '02:00';
                        const weeklyDayEl = document.getElementById('weeklyDay');
                        if (weeklyDayEl) weeklyDayEl.value = report.weekly_day || 'monday';
                        const monthlyEnabledEl = document.getElementById('monthlyEnabled');
                        if (monthlyEnabledEl) monthlyEnabledEl.checked = (report.monthly_enabled || 'true').toLowerCase() === 'true';
                        const monthlyTimeEl = document.getElementById('monthlyTime');
                        if (monthlyTimeEl) monthlyTimeEl.value = report.monthly_time || '02:00';
                        const monthlyDayEl = document.getElementById('monthlyDay');
                        if (monthlyDayEl) monthlyDayEl.value = report.monthly_day || '1';
                        const reportDirEl = document.getElementById('reportDir');
                        if (reportDirEl) reportDirEl.value = report.report_dir || './reports';
                        const reportKeepCountEl = document.getElementById('reportKeepCount');
                        if (reportKeepCountEl) reportKeepCountEl.value = report.keep_count || '30';
                        const generatePdfEl = document.getElementById('generatePdf');
                        if (generatePdfEl) generatePdfEl.checked = (report.generate_pdf || 'true').toLowerCase() === 'true';
                        const generateHtmlEl = document.getElementById('generateHtml');
                        if (generateHtmlEl) generateHtmlEl.checked = (report.generate_html || 'true').toLowerCase() === 'true';
                        const generateExcelEl = document.getElementById('generateExcel');
                        if (generateExcelEl) generateExcelEl.checked = (report.generate_excel || 'true').toLowerCase() === 'true';
                        const pdfLibraryEl = document.getElementById('pdfLibrary');
                        if (pdfLibraryEl) pdfLibraryEl.value = report.pdf_library || 'reportlab';
                        const reportEmailEnabledEl = document.getElementById('reportEmailEnabled');
                        if (reportEmailEnabledEl) reportEmailEnabledEl.checked = report.email_enabled === 'true' || report.email_enabled === true;
                        const reportEmailRecipientsEl = document.getElementById('reportEmailRecipients');
                        if (reportEmailRecipientsEl) reportEmailRecipientsEl.value = report.email_recipients || '';
                    }
                    
                    document.getElementById('configLoading').style.display = 'none';
                // Á°Æ‰øùÊâÄÊúâsectionÂàùÂßãÁä∂ÊÄÅÊ≠£Á°ÆÔºàÂÖàÈöêËóèÊâÄÊúâÔºâ
                document.querySelectorAll('.config-section').forEach(sec => {
                    sec.style.display = 'none';
                    sec.classList.remove('active');
                });
                // ÊòæÁ§∫ÂΩìÂâçÈÄâ‰∏≠ÁöÑsectionÔºàÈªòËÆ§systemÔºâÂπ∂ÊòæÁ§∫Ë°®Âçï
                const activeNav = document.querySelector('.config-nav-item.active');
                let targetSection = 'system';
                if (activeNav) {
                    const section = activeNav.getAttribute('data-section');
                    if (section) {
                        targetSection = section;
                    }
                }
                switchConfigSection(targetSection);
                // ÊòæÁ§∫configFormÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                const configForm = document.getElementById('configForm');
                if (configForm) {
                    configForm.style.display = 'block';
                }
                } else {
                    throw new Error(result.error || 'Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•');
                }
            } catch (error) {
                document.getElementById('configLoading').style.display = 'none';
                document.getElementById('configError').style.display = 'block';
                document.getElementById('configError').textContent = 'Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•: ' + error.message;
            }
        }
        
        // Âä†ËΩΩÊï∞ÊçÆÊî∂ÈõÜÊúçÂä°Áä∂ÊÄÅ
        async function loadCollectorStatus() {
            try {
                const response = await fetch('/api/config/collector', {
                    credentials: 'same-origin'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        const statusText = result.data.is_running ? 'ËøêË°å‰∏≠' : 'Â∑≤ÂÅúÊ≠¢';
                        document.getElementById('collectorStatusText').textContent = statusText + ` (Èó¥Èöî: ${result.data.collect_interval}Áßí)`;
                    }
                }
            } catch (error) {
                console.debug('Âä†ËΩΩÊî∂ÈõÜÊúçÂä°Áä∂ÊÄÅÂ§±Ë¥•:', error);
            }
        }
        
        // ‰øùÂ≠òÈÖçÁΩÆ
        document.getElementById('configForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                // Êî∂ÈõÜË°®ÂçïÊï∞ÊçÆ
                const formData = {
                    bandix: {},
                    api: {},
                    collector: {},
                    notifications: {},
                    backup: {},
                    report: {}
                };
                
                // Êî∂ÈõÜbandixÈÖçÁΩÆ
                const bandixUrl = document.getElementById('bandixUrl').value.trim();
                const bandixUsername = document.getElementById('bandixUsername').value.trim();
                const bandixPassword = document.getElementById('bandixPassword').value.trim();
                
                if (bandixUrl) formData.bandix.url = bandixUrl;
                if (bandixUsername) formData.bandix.username = bandixUsername;
                if (bandixPassword) formData.bandix.password = bandixPassword;
                
                // Êî∂ÈõÜapiÈÖçÁΩÆ
                const apiHost = document.getElementById('apiHost').value.trim();
                const apiPort = document.getElementById('apiPort').value.trim();
                const apiDebug = document.getElementById('apiDebug').value;
                const apiAuthEnabled = document.getElementById('apiAuthEnabled').value;
                const apiKey = document.getElementById('apiKey').value.trim();
                const healthCheckRequireAuth = document.getElementById('healthCheckRequireAuth').value;
                
                if (apiHost) formData.api.host = apiHost;
                if (apiPort) formData.api.port = parseInt(apiPort);
                if (apiDebug) formData.api.debug = apiDebug;
                if (apiAuthEnabled) formData.api.auth_enabled = apiAuthEnabled;
                if (apiKey) formData.api.api_key = apiKey;
                if (healthCheckRequireAuth) formData.api.health_check_require_auth = healthCheckRequireAuth;
                
                // Êî∂ÈõÜcollectorÈÖçÁΩÆ
                const collectInterval = document.getElementById('collectInterval').value.trim();
                if (collectInterval) formData.collector.collect_interval = parseFloat(collectInterval);
                
                // Êî∂ÈõÜÈÄöÁü•ÈÖçÁΩÆÔºà‰∏çÂåÖÊã¨ÈÇÆ‰ª∂ÈÖçÁΩÆÔºåÈÇÆ‰ª∂ÈÖçÁΩÆÂú®ÂëäË≠¶ÁÆ°ÁêÜÈ°µÈù¢Ôºâ
                formData.notifications.webhook_enabled = document.getElementById('webhookEnabled').checked ? 'true' : 'false';
                const webhookUrls = document.getElementById('webhookUrls').value.trim();
                if (webhookUrls) formData.notifications.webhook_urls = webhookUrls;
                const webhookHeaders = document.getElementById('webhookHeaders').value.trim();
                if (webhookHeaders) formData.notifications.webhook_headers = webhookHeaders;
                
                const telegramEnabledEl = document.getElementById('telegramEnabled');
                if (telegramEnabledEl) {
                    formData.notifications.telegram_enabled = telegramEnabledEl.checked ? 'true' : 'false';
                    const telegramBotToken = document.getElementById('telegramBotToken');
                    if (telegramBotToken && telegramBotToken.value.trim()) formData.notifications.telegram_bot_token = telegramBotToken.value.trim();
                    const telegramChatIds = document.getElementById('telegramChatIds');
                    if (telegramChatIds && telegramChatIds.value.trim()) formData.notifications.telegram_chat_ids = telegramChatIds.value.trim();
                }
                
                const wecomEnabledEl = document.getElementById('wecomEnabled');
                if (wecomEnabledEl) {
                    formData.notifications.wecom_enabled = wecomEnabledEl.checked ? 'true' : 'false';
                    const wecomWebhookUrls = document.getElementById('wecomWebhookUrls');
                    if (wecomWebhookUrls && wecomWebhookUrls.value.trim()) formData.notifications.wecom_webhook_urls = wecomWebhookUrls.value.trim();
                }
                
                const dingtalkEnabledEl = document.getElementById('dingtalkEnabled');
                if (dingtalkEnabledEl) {
                    formData.notifications.dingtalk_enabled = dingtalkEnabledEl.checked ? 'true' : 'false';
                    const dingtalkWebhookUrls = document.getElementById('dingtalkWebhookUrls');
                    if (dingtalkWebhookUrls && dingtalkWebhookUrls.value.trim()) formData.notifications.dingtalk_webhook_urls = dingtalkWebhookUrls.value.trim();
                }
                
                // Êî∂ÈõÜÂ§á‰ªΩÈÖçÁΩÆ
                const backupEnabledEl = document.getElementById('backupEnabled');
                if (backupEnabledEl) {
                    formData.backup.backup_enabled = backupEnabledEl.checked ? 'true' : 'false';
                }
                const backupFrequencyEl = document.getElementById('backupFrequency');
                if (backupFrequencyEl) formData.backup.frequency = backupFrequencyEl.value;
                const backupTimeEl = document.getElementById('backupTime');
                if (backupTimeEl && backupTimeEl.value) formData.backup.backup_time = backupTimeEl.value;
                const backupDirEl = document.getElementById('backupDir');
                if (backupDirEl && backupDirEl.value.trim()) formData.backup.backup_dir = backupDirEl.value.trim();
                const backupDatabasesEl = document.getElementById('backupDatabases');
                if (backupDatabasesEl && backupDatabasesEl.value.trim()) formData.backup.databases = backupDatabasesEl.value.trim();
                const backupKeepCountEl = document.getElementById('backupKeepCount');
                if (backupKeepCountEl && backupKeepCountEl.value) formData.backup.keep_count = parseInt(backupKeepCountEl.value);
                const backupCompressEl = document.getElementById('backupCompress');
                if (backupCompressEl) {
                    formData.backup.compress = backupCompressEl.checked ? 'true' : 'false';
                }
                const cloudEnabledEl = document.getElementById('cloudEnabled');
                if (cloudEnabledEl) {
                    formData.backup.cloud_enabled = cloudEnabledEl.checked ? 'true' : 'false';
                }
                const cloudTypeEl = document.getElementById('cloudType');
                if (cloudTypeEl) formData.backup.cloud_type = cloudTypeEl.value;
                const cloudBucketEl = document.getElementById('cloudBucket');
                if (cloudBucketEl && cloudBucketEl.value.trim()) formData.backup.cloud_bucket = cloudBucketEl.value.trim();
                const cloudRegionEl = document.getElementById('cloudRegion');
                if (cloudRegionEl && cloudRegionEl.value.trim()) formData.backup.cloud_region = cloudRegionEl.value.trim();
                const cloudEndpointEl = document.getElementById('cloudEndpoint');
                if (cloudEndpointEl && cloudEndpointEl.value.trim()) formData.backup.cloud_endpoint = cloudEndpointEl.value.trim();
                const cloudAccessKeyEl = document.getElementById('cloudAccessKey');
                if (cloudAccessKeyEl && cloudAccessKeyEl.value.trim()) formData.backup.cloud_access_key = cloudAccessKeyEl.value.trim();
                const cloudSecretKeyEl = document.getElementById('cloudSecretKey');
                if (cloudSecretKeyEl && cloudSecretKeyEl.value.trim()) formData.backup.cloud_secret_key = cloudSecretKeyEl.value.trim();
                
                // Êî∂ÈõÜÊä•Ë°®ÈÖçÁΩÆ
                const reportEnabledEl = document.getElementById('reportEnabled');
                if (reportEnabledEl) formData.report.report_enabled = reportEnabledEl.checked ? 'true' : 'false';
                const dailyEnabledEl = document.getElementById('dailyEnabled');
                if (dailyEnabledEl) formData.report.daily_enabled = dailyEnabledEl.checked ? 'true' : 'false';
                const dailyTimeEl = document.getElementById('dailyTime');
                if (dailyTimeEl && dailyTimeEl.value) formData.report.daily_time = dailyTimeEl.value;
                const weeklyEnabledEl = document.getElementById('weeklyEnabled');
                if (weeklyEnabledEl) formData.report.weekly_enabled = weeklyEnabledEl.checked ? 'true' : 'false';
                const weeklyTimeEl = document.getElementById('weeklyTime');
                if (weeklyTimeEl && weeklyTimeEl.value) formData.report.weekly_time = weeklyTimeEl.value;
                const weeklyDayEl = document.getElementById('weeklyDay');
                if (weeklyDayEl) formData.report.weekly_day = weeklyDayEl.value;
                const monthlyEnabledEl = document.getElementById('monthlyEnabled');
                if (monthlyEnabledEl) formData.report.monthly_enabled = monthlyEnabledEl.checked ? 'true' : 'false';
                const monthlyTimeEl = document.getElementById('monthlyTime');
                if (monthlyTimeEl && monthlyTimeEl.value) formData.report.monthly_time = monthlyTimeEl.value;
                const monthlyDayEl = document.getElementById('monthlyDay');
                if (monthlyDayEl && monthlyDayEl.value) formData.report.monthly_day = parseInt(monthlyDayEl.value);
                const reportDirEl = document.getElementById('reportDir');
                if (reportDirEl && reportDirEl.value.trim()) formData.report.report_dir = reportDirEl.value.trim();
                const reportKeepCountEl = document.getElementById('reportKeepCount');
                if (reportKeepCountEl && reportKeepCountEl.value) formData.report.keep_count = parseInt(reportKeepCountEl.value);
                const generatePdfEl = document.getElementById('generatePdf');
                if (generatePdfEl) formData.report.generate_pdf = generatePdfEl.checked ? 'true' : 'false';
                const generateHtmlEl = document.getElementById('generateHtml');
                if (generateHtmlEl) formData.report.generate_html = generateHtmlEl.checked ? 'true' : 'false';
                const generateExcelEl = document.getElementById('generateExcel');
                if (generateExcelEl) formData.report.generate_excel = generateExcelEl.checked ? 'true' : 'false';
                const pdfLibraryEl = document.getElementById('pdfLibrary');
                if (pdfLibraryEl) formData.report.pdf_library = pdfLibraryEl.value;
                const reportEmailEnabledEl = document.getElementById('reportEmailEnabled');
                if (reportEmailEnabledEl) formData.report.email_enabled = reportEmailEnabledEl.checked ? 'true' : 'false';
                const reportEmailRecipientsEl = document.getElementById('reportEmailRecipients');
                if (reportEmailRecipientsEl && reportEmailRecipientsEl.value.trim()) formData.report.email_recipients = reportEmailRecipientsEl.value.trim();
                
                // Êó•ÂøóÈÖçÁΩÆÁé∞Âú®ÈÄöËøáÁã¨Á´ãÁöÑsaveLogConfigÂáΩÊï∞‰øùÂ≠ò
                
                // Á°ÆËÆ§‰øùÂ≠ò
                const confirmMsg = 'Á°ÆÂÆöË¶Å‰øùÂ≠òÈÖçÁΩÆÂêóÔºü\n\nÊ≥®ÊÑèÔºö‰øÆÊîπÁ´ØÂè£Êàñ‰∏ªÊú∫Âú∞ÂùÄÈúÄË¶ÅÈáçÂêØÊúçÂä°ÊâçËÉΩÁîüÊïà„ÄÇ';
                if (!confirm(confirmMsg)) {
                    return;
                }
                
                // ÂèëÈÄÅËØ∑Ê±Ç
                document.getElementById('configError').style.display = 'none';
                document.getElementById('configSuccess').style.display = 'none';
                
                const response = await fetch('/api/config', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('configSuccess').style.display = 'block';
                    document.getElementById('configSuccess').textContent = result.message || 'ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò';
                    
                    // ÈáçÊñ∞Âä†ËΩΩÈÖçÁΩÆÂíåÁä∂ÊÄÅ
                    await loadConfig();
                    await loadCollectorStatus();
                    
                    // Ê∏ÖÁ©∫ÂØÜÁ†ÅÂíåAPIÂØÜÈí•Â≠óÊÆµ
                    document.getElementById('bandixPassword').value = '';
                    document.getElementById('apiKey').value = '';
                    const cloudAccessKeyEl = document.getElementById('cloudAccessKey');
                    if (cloudAccessKeyEl) cloudAccessKeyEl.value = '';
                    const cloudSecretKeyEl = document.getElementById('cloudSecretKey');
                    if (cloudSecretKeyEl) cloudSecretKeyEl.value = '';
                    
                    // Â¶ÇÊûúÊèêÁ§∫ÈúÄË¶ÅÈáçÂêØÔºåÊòæÁ§∫Ë≠¶Âëä
                    if (result.requires_restart) {
                        setTimeout(() => {
                            alert('‚ö†Ô∏è ÈÖçÁΩÆÂ∑≤‰øùÂ≠òÔºå‰ΩÜ‰øÆÊîπ‰∫ÜÁ´ØÂè£Êàñ‰∏ªÊú∫Âú∞ÂùÄÔºåÈúÄË¶ÅÈáçÂêØÊúçÂä°ÊâçËÉΩÁîüÊïàÔºÅ');
                        }, 500);
                    }
                } else {
                    document.getElementById('configError').style.display = 'block';
                    document.getElementById('configError').textContent = '‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ');
                }
            } catch (error) {
                document.getElementById('configError').style.display = 'block';
                document.getElementById('configError').textContent = '‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•: ' + error.message;
            }
        });
        
        // ============ ÂëäË≠¶ÁÆ°ÁêÜÂäüËÉΩ ============
        
        let alertHistoryPage = 1;
        let alertHistoryPerPage = 20;
        
        // ÂàùÂßãÂåñÂëäË≠¶ÁÆ°ÁêÜÈ°µÈù¢
        async function initAlertsPage() {
            await loadAlertRules();
            await loadAlertHistory();
            await loadDevicesForRules();
            await loadAlertsNotificationConfig();
        }
        
        // Âä†ËΩΩËÆæÂ§áÂàóË°®ÔºàÁî®‰∫éËßÑÂàôË°®ÂçïÔºâ
        async function loadDevicesForRules() {
            try {
                const response = await fetch('/api/database/devices');
                const result = await response.json();
                
                if (result.success) {
                    const select = document.getElementById('ruleDeviceId');
                    // ‰øùÁïô"ÊâÄÊúâËÆæÂ§á"ÈÄâÈ°πÔºåÁÑ∂ÂêéÊ∑ªÂä†ËÆæÂ§áÂàóË°®
                    select.innerHTML = '<option value="">ÊâÄÊúâËÆæÂ§áÔºàÂÖ®ÁΩëÊµÅÈáèÔºâ</option>';
                    result.data.forEach(device => {
                        const option = document.createElement('option');
                        option.value = device.id;
                        option.textContent = device.hostname || device.mac || `ËÆæÂ§á ${device.id}`;
                        select.appendChild(option);
                    });
                }
            } catch (err) {
                console.error('Âä†ËΩΩËÆæÂ§áÂàóË°®Â§±Ë¥•:', err);
            }
        }
        
        // Âä†ËΩΩÂëäË≠¶ËßÑÂàôÂàóË°®
        async function loadAlertRules() {
            const error = document.getElementById('alertsError');
            error.style.display = 'none';
            
            try {
                const response = await fetch('/api/alerts/rules', {
                    credentials: 'same-origin'
                });
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩËßÑÂàôÂ§±Ë¥•');
                }
                
                const tbody = document.getElementById('rulesTableBody');
                if (!result.data || result.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="padding: 20px; text-align: center; color: #999;">ÊöÇÊó†ÂëäË≠¶ËßÑÂàôÔºåÁÇπÂáª"Êñ∞Âª∫ËßÑÂàô"ÂàõÂª∫</td></tr>';
                    return;
                }
                
                tbody.innerHTML = result.data.map(rule => {
                    let thresholdText = '-';
                    if (rule.type === 'traffic_threshold') {
                        thresholdText = formatBytes(rule.threshold_bytes) + '/s';
                        if (rule.device_id) {
                            thresholdText += ' (ÊåáÂÆöËÆæÂ§á)';
                        } else {
                            thresholdText += ' (ÂÖ®ÁΩë)';
                        }
                    } else if (rule.type === 'device_offline') {
                        thresholdText = rule.offline_threshold_minutes + ' ÂàÜÈíü';
                    }
                    
                    const typeText = rule.type === 'traffic_threshold' ? 'ÊµÅÈáèÈòàÂÄº' : 'ËÆæÂ§áÁ¶ªÁ∫ø';
                    const severityColors = {
                        'critical': '#dc3545',
                        'warning': '#ffc107',
                        'info': '#17a2b8'
                    };
                    const severityTexts = {
                        'critical': '‰∏•Èáç',
                        'warning': 'Ë≠¶Âëä',
                        'info': '‰ø°ÊÅØ'
                    };
                    
                    return `
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">${escapeHtml(rule.name)}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">${typeText}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">${thresholdText}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">
                                <span style="color: ${severityColors[rule.severity] || '#666'}; font-weight: 500;">
                                    ${severityTexts[rule.severity] || rule.severity}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;">
                                <span style="padding: 4px 8px; border-radius: 4px; background: ${rule.enabled ? '#d4edda' : '#f8d7da'}; color: ${rule.enabled ? '#155724' : '#721c24'};">
                                    ${rule.enabled ? 'ÂêØÁî®' : 'Á¶ÅÁî®'}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;">
                                <button onclick="editRule(${rule.id})" style="padding: 5px 10px; margin-right: 5px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer;">ÁºñËæë</button>
                                <button onclick="deleteRule(${rule.id})" style="padding: 5px 10px; border: 1px solid #ddd; background: white; color: #dc3545; border-radius: 4px; cursor: pointer;">Âà†Èô§</button>
                            </td>
                        </tr>
                    `;
                }).join('');
                
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
                console.error('Âä†ËΩΩÂëäË≠¶ËßÑÂàôÂ§±Ë¥•:', err);
            }
        }
        
        // Âä†ËΩΩÂëäË≠¶ÁÆ°ÁêÜÈ°µÈù¢ÁöÑÈÄöÁü•ÈÖçÁΩÆ
        async function loadAlertsNotificationConfig() {
            try {
                const response = await fetch('/api/config/notifications', {
                    credentials: 'same-origin'
                });
                const result = await response.json();
                
                if (result.success && result.data) {
                    const config = result.data;
                    
                    const emailEnabledEl = document.getElementById('alertsEmailEnabled');
                    if (emailEnabledEl) emailEnabledEl.checked = config.email_enabled === 'true' || config.email_enabled === true;
                    const emailSmtpHostEl = document.getElementById('alertsEmailSmtpHost');
                    if (emailSmtpHostEl) emailSmtpHostEl.value = config.email_smtp_host || '';
                    const emailSmtpPortEl = document.getElementById('alertsEmailSmtpPort');
                    if (emailSmtpPortEl) emailSmtpPortEl.value = config.email_smtp_port || '587';
                    const emailUseTlsEl = document.getElementById('alertsEmailUseTls');
                    if (emailUseTlsEl) emailUseTlsEl.checked = (config.email_use_tls || 'true').toLowerCase() === 'true';
                    const emailUsernameEl = document.getElementById('alertsEmailUsername');
                    if (emailUsernameEl) emailUsernameEl.value = config.email_username || '';
                    const emailFromEl = document.getElementById('alertsEmailFrom');
                    if (emailFromEl) emailFromEl.value = config.email_from || '';
                    const emailToEl = document.getElementById('alertsEmailTo');
                    if (emailToEl) emailToEl.value = config.email_to || '';
                }
            } catch (err) {
                console.error('Âä†ËΩΩÈÄöÁü•ÈÖçÁΩÆÂ§±Ë¥•:', err);
                const errorEl = document.getElementById('notificationConfigError');
                if (errorEl) {
                    errorEl.style.display = 'block';
                    errorEl.textContent = 'Âä†ËΩΩÈÄöÁü•ÈÖçÁΩÆÂ§±Ë¥•: ' + err.message;
                }
            }
        }
        
        // ‰øùÂ≠òÂëäË≠¶ÁÆ°ÁêÜÈ°µÈù¢ÁöÑÈÄöÁü•ÈÖçÁΩÆ
        async function saveAlertsNotificationConfig() {
            try {
                document.getElementById('notificationConfigError').style.display = 'none';
                document.getElementById('notificationConfigSuccess').style.display = 'none';
                
                const formData = {
                    email_enabled: document.getElementById('alertsEmailEnabled').checked ? 'true' : 'false',
                    email_smtp_host: document.getElementById('alertsEmailSmtpHost').value.trim(),
                    email_smtp_port: document.getElementById('alertsEmailSmtpPort').value.trim(),
                    email_use_tls: document.getElementById('alertsEmailUseTls').checked ? 'true' : 'false',
                    email_username: document.getElementById('alertsEmailUsername').value.trim(),
                    email_from: document.getElementById('alertsEmailFrom').value.trim(),
                    email_to: document.getElementById('alertsEmailTo').value.trim()
                };
                
                const emailPassword = document.getElementById('alertsEmailPassword').value.trim();
                if (emailPassword) {
                    formData.email_password = emailPassword;
                }
                
                const response = await fetch('/api/config/notifications', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('notificationConfigSuccess').style.display = 'block';
                    document.getElementById('notificationConfigSuccess').textContent = result.message || 'ÈÄöÁü•ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò';
                    
                    // ÈáçÊñ∞Âä†ËΩΩÈÄöÁü•ÈÖçÁΩÆ‰ª•Êõ¥Êñ∞ÂèØÁî®Ê∏†ÈÅì
                    await loadNotificationConfig();
                    
                    setTimeout(() => {
                        document.getElementById('notificationConfigSuccess').style.display = 'none';
                    }, 3000);
                } else {
                    throw new Error(result.error || '‰øùÂ≠òÂ§±Ë¥•');
                }
            } catch (err) {
                document.getElementById('notificationConfigError').style.display = 'block';
                document.getElementById('notificationConfigError').textContent = '‰øùÂ≠òÂ§±Ë¥•: ' + err.message;
                console.error('‰øùÂ≠òÈÄöÁü•ÈÖçÁΩÆÂ§±Ë¥•:', err);
            }
        }
        
        // Âä†ËΩΩÈÄöÁü•ÈÖçÁΩÆÔºàÁî®‰∫éÊòæÁ§∫ÂèØÁî®ÁöÑÈÄöÁü•Ê∏†ÈÅìÔºâ
        async function loadNotificationConfig() {
            try {
                const response = await fetch('/api/config/notifications', {
                    credentials: 'same-origin'
                });
                const result = await response.json();
                
                if (result.success && result.data) {
                    const config = result.data;
                    
                    // Êõ¥Êñ∞ÈÇÆ‰ª∂ÈÄöÁü•ÈÄâÈ°π
                    const emailEnabled = config.email_enabled === 'true' || config.email_enabled === true;
                    const emailCheckbox = document.getElementById('notificationMethodEmail');
                    const emailLabel = document.getElementById('notificationMethodEmailLabel');
                    emailCheckbox.disabled = !emailEnabled;
                    emailLabel.style.opacity = emailEnabled ? '1' : '0.5';
                    emailLabel.querySelector('span').textContent = emailEnabled ? 'ÈÇÆ‰ª∂ÈÄöÁü•' : 'ÈÇÆ‰ª∂ÈÄöÁü•ÔºàÊú™ÈÖçÁΩÆÔºâ';
                    
                    // Êõ¥Êñ∞WebhookÈÄöÁü•ÈÄâÈ°π
                    const webhookEnabled = config.webhook_enabled === 'true' || config.webhook_enabled === true;
                    const webhookCheckbox = document.getElementById('notificationMethodWebhook');
                    const webhookLabel = document.getElementById('notificationMethodWebhookLabel');
                    webhookCheckbox.disabled = !webhookEnabled;
                    webhookLabel.style.opacity = webhookEnabled ? '1' : '0.5';
                    webhookLabel.querySelector('span').textContent = webhookEnabled ? 'Webhook ÈÄöÁü•' : 'Webhook ÈÄöÁü•ÔºàÊú™ÈÖçÁΩÆÔºâ';
                    
                    // Êõ¥Êñ∞TelegramÈÄöÁü•ÈÄâÈ°π
                    const telegramEnabled = config.telegram_enabled === 'true' || config.telegram_enabled === true;
                    const telegramCheckbox = document.getElementById('notificationMethodTelegram');
                    const telegramLabel = document.getElementById('notificationMethodTelegramLabel');
                    telegramCheckbox.disabled = !telegramEnabled;
                    telegramLabel.style.opacity = telegramEnabled ? '1' : '0.5';
                    telegramLabel.querySelector('span').textContent = telegramEnabled ? 'Telegram ÈÄöÁü•' : 'Telegram ÈÄöÁü•ÔºàÊú™ÈÖçÁΩÆÔºâ';
                }
            } catch (err) {
                console.error('Âä†ËΩΩÈÄöÁü•ÈÖçÁΩÆÂ§±Ë¥•:', err);
            }
        }
        
        // ÊòæÁ§∫Êñ∞Âª∫ËßÑÂàôË°®Âçï
        async function showCreateRuleForm() {
            document.getElementById('ruleId').value = '';
            document.getElementById('ruleFormTitle').textContent = 'Êñ∞Âª∫ÂëäË≠¶ËßÑÂàô';
            document.getElementById('ruleForm').reset();
            document.getElementById('ruleEnabled').checked = true;
            document.getElementById('notificationMethodPage').checked = true;
            document.getElementById('notificationMethodEmail').checked = false;
            document.getElementById('notificationMethodWebhook').checked = false;
            document.getElementById('notificationMethodTelegram').checked = false;
            document.getElementById('notificationMethodWecom').checked = false;
            document.getElementById('notificationMethodDingtalk').checked = false;
            await loadNotificationConfig();
            updateRuleForm();
            document.getElementById('ruleFormModal').style.display = 'flex';
        }
        
        // ÁºñËæëËßÑÂàô
        async function editRule(ruleId) {
            try {
                const response = await fetch(`/api/alerts/rules/${ruleId}`, {
                    credentials: 'same-origin'
                });
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩËßÑÂàôÂ§±Ë¥•');
                }
                
                const rule = result.data;
                document.getElementById('ruleId').value = rule.id;
                document.getElementById('ruleFormTitle').textContent = 'ÁºñËæëÂëäË≠¶ËßÑÂàô';
                document.getElementById('ruleName').value = rule.name;
                document.getElementById('ruleType').value = rule.type;
                document.getElementById('ruleSeverity').value = rule.severity;
                document.getElementById('ruleEnabled').checked = rule.enabled;
                
                // ËÆæÁΩÆÈÄöÁü•ÊñπÂºè
                const notificationMethods = rule.notification_methods || ['page'];
                document.getElementById('notificationMethodPage').checked = notificationMethods.includes('page');
                document.getElementById('notificationMethodEmail').checked = notificationMethods.includes('email');
                document.getElementById('notificationMethodWebhook').checked = notificationMethods.includes('webhook');
                document.getElementById('notificationMethodTelegram').checked = notificationMethods.includes('telegram');
                
                if (rule.type === 'traffic_threshold') {
                    document.getElementById('thresholdBytes').value = rule.threshold_bytes || '';
                    document.getElementById('ruleDeviceId').value = rule.device_id || '';
                } else if (rule.type === 'device_offline') {
                    document.getElementById('offlineThresholdMinutes').value = rule.offline_threshold_minutes || '';
                }
                
                await loadDevicesForRules();
                await loadNotificationConfig();
                if (rule.device_id) {
                    setTimeout(() => {
                        document.getElementById('ruleDeviceId').value = rule.device_id;
                    }, 100);
                }
                
                updateRuleForm();
                document.getElementById('ruleFormModal').style.display = 'flex';
                
            } catch (err) {
                alert('Âä†ËΩΩËßÑÂàôÂ§±Ë¥•: ' + err.message);
                console.error('Âä†ËΩΩËßÑÂàôÂ§±Ë¥•:', err);
            }
        }
        
        // Êõ¥Êñ∞ËßÑÂàôË°®ÂçïÊòæÁ§∫
        function updateRuleForm() {
            const ruleType = document.getElementById('ruleType').value;
            const trafficFields = document.getElementById('trafficThresholdFields');
            const offlineFields = document.getElementById('offlineThresholdFields');
            
            if (ruleType === 'traffic_threshold') {
                trafficFields.style.display = 'block';
                offlineFields.style.display = 'none';
                document.getElementById('thresholdBytes').required = true;
                document.getElementById('offlineThresholdMinutes').required = false;
            } else if (ruleType === 'device_offline') {
                trafficFields.style.display = 'none';
                offlineFields.style.display = 'block';
                document.getElementById('thresholdBytes').required = false;
                document.getElementById('offlineThresholdMinutes').required = true;
            } else {
                trafficFields.style.display = 'none';
                offlineFields.style.display = 'none';
                document.getElementById('thresholdBytes').required = false;
                document.getElementById('offlineThresholdMinutes').required = false;
            }
        }
        
        // ‰øùÂ≠òËßÑÂàô
        async function saveRule(event) {
            event.preventDefault();
            
            const ruleId = document.getElementById('ruleId').value;
            const ruleType = document.getElementById('ruleType').value;
            const error = document.getElementById('alertsError');
            const success = document.getElementById('alertsSuccess');
            
            error.style.display = 'none';
            success.style.display = 'none';
            
            // Êî∂ÈõÜÈÄâ‰∏≠ÁöÑÈÄöÁü•ÊñπÂºè
            const notificationMethods = [];
            if (document.getElementById('notificationMethodPage').checked) {
                notificationMethods.push('page');
            }
            if (document.getElementById('notificationMethodEmail').checked && !document.getElementById('notificationMethodEmail').disabled) {
                notificationMethods.push('email');
            }
            if (document.getElementById('notificationMethodWebhook').checked && !document.getElementById('notificationMethodWebhook').disabled) {
                notificationMethods.push('webhook');
            }
            if (document.getElementById('notificationMethodTelegram').checked && !document.getElementById('notificationMethodTelegram').disabled) {
                notificationMethods.push('telegram');
            }
            if (document.getElementById('notificationMethodWecom').checked && !document.getElementById('notificationMethodWecom').disabled) {
                notificationMethods.push('wecom');
            }
            if (document.getElementById('notificationMethodDingtalk').checked && !document.getElementById('notificationMethodDingtalk').disabled) {
                notificationMethods.push('dingtalk');
            }
            
            // Ëá≥Â∞ëÈúÄË¶ÅÈÄâÊã©‰∏Ä‰∏™ÈÄöÁü•ÊñπÂºè
            if (notificationMethods.length === 0) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: Ëá≥Â∞ëÈúÄË¶ÅÈÄâÊã©‰∏Ä‰∏™ÈÄöÁü•ÊñπÂºè';
                return;
            }
            
            const data = {
                name: document.getElementById('ruleName').value,
                type: ruleType,
                enabled: document.getElementById('ruleEnabled').checked,
                severity: document.getElementById('ruleSeverity').value,
                notification_methods: notificationMethods
            };
            
            if (ruleType === 'traffic_threshold') {
                data.threshold_bytes = parseInt(document.getElementById('thresholdBytes').value);
                const deviceId = document.getElementById('ruleDeviceId').value;
                if (deviceId) {
                    data.device_id = parseInt(deviceId);
                }
            } else if (ruleType === 'device_offline') {
                data.offline_threshold_minutes = parseInt(document.getElementById('offlineThresholdMinutes').value);
            }
            
            try {
                const url = ruleId ? `/api/alerts/rules/${ruleId}` : '/api/alerts/rules';
                const method = ruleId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || '‰øùÂ≠òÂ§±Ë¥•');
                }
                
                success.style.display = 'block';
                success.textContent = 'ËßÑÂàô‰øùÂ≠òÊàêÂäü';
                closeRuleForm();
                await loadAlertRules();
                
                setTimeout(() => {
                    success.style.display = 'none';
                }, 3000);
                
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
                console.error('‰øùÂ≠òËßÑÂàôÂ§±Ë¥•:', err);
            }
        }
        
        // ÂÖ≥Èó≠ËßÑÂàôË°®Âçï
        function closeRuleForm() {
            document.getElementById('ruleFormModal').style.display = 'none';
        }
        
        // Âà†Èô§ËßÑÂàô
        async function deleteRule(ruleId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ê≠§ÂëäË≠¶ËßÑÂàôÂêóÔºü')) {
                return;
            }
            
            const error = document.getElementById('alertsError');
            error.style.display = 'none';
            
            try {
                const response = await fetch(`/api/alerts/rules/${ruleId}`, {
                    method: 'DELETE',
                    credentials: 'same-origin'
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Âà†Èô§Â§±Ë¥•');
                }
                
                await loadAlertRules();
                
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
                console.error('Âà†Èô§ËßÑÂàôÂ§±Ë¥•:', err);
            }
        }
        
        // Âä†ËΩΩÂëäË≠¶ÂéÜÂè≤
        async function loadAlertHistory(page = 1) {
            alertHistoryPage = page;
            const error = document.getElementById('alertsError');
            error.style.display = 'none';
            
            try {
                const params = new URLSearchParams({
                    page: page,
                    per_page: alertHistoryPerPage
                });
                
                const status = document.getElementById('historyStatusFilter').value;
                if (status) params.append('status', status);
                
                const alertType = document.getElementById('historyTypeFilter').value;
                if (alertType) params.append('alert_type', alertType);
                
                const severity = document.getElementById('historySeverityFilter').value;
                if (severity) params.append('severity', severity);
                
                const response = await fetch(`/api/alerts/history?${params}`, {
                    credentials: 'same-origin'
                });
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩÂéÜÂè≤Â§±Ë¥•');
                }
                
                const tbody = document.getElementById('alertHistoryTableBody');
                if (!result.data || result.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="padding: 20px; text-align: center; color: #999;">ÊöÇÊó†ÂëäË≠¶ÂéÜÂè≤</td></tr>';
                    document.getElementById('alertHistoryPagination').innerHTML = '';
                    return;
                }
                
                const severityColors = {
                    'critical': '#dc3545',
                    'warning': '#ffc107',
                    'info': '#17a2b8'
                };
                const severityTexts = {
                    'critical': '‰∏•Èáç',
                    'warning': 'Ë≠¶Âëä',
                    'info': '‰ø°ÊÅØ'
                };
                const typeTexts = {
                    'traffic_threshold': 'ÊµÅÈáèÈòàÂÄº',
                    'device_offline': 'ËÆæÂ§áÁ¶ªÁ∫ø'
                };
                const statusTexts = {
                    'triggered': 'Â∑≤Ëß¶Âèë',
                    'acknowledged': 'Â∑≤Á°ÆËÆ§',
                    'resolved': 'Â∑≤Ëß£ÂÜ≥'
                };
                const statusColors = {
                    'triggered': '#dc3545',
                    'acknowledged': '#ffc107',
                    'resolved': '#28a745'
                };
                
                tbody.innerHTML = result.data.map(alert => {
                    const triggeredTime = new Date(alert.triggered_at);
                    return `
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">${triggeredTime.toLocaleString('zh-CN')}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">${typeTexts[alert.alert_type] || alert.alert_type}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">${escapeHtml(alert.message)}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">
                                <span style="color: ${severityColors[alert.severity] || '#666'}; font-weight: 500;">
                                    ${severityTexts[alert.severity] || alert.severity}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;">
                                <span style="color: ${statusColors[alert.status] || '#666'}; font-weight: 500;">
                                    ${statusTexts[alert.status] || alert.status}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;">
                                ${alert.status === 'triggered' ? `<button onclick="acknowledgeAlert(${alert.id})" style="padding: 5px 10px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer;">Á°ÆËÆ§</button>` : '-'}
                            </td>
                        </tr>
                    `;
                }).join('');
                
                // ÂàÜÈ°µ
                const pagination = result.pagination;
                if (pagination && pagination.pages > 1) {
                    let paginationHtml = '';
                    if (pagination.page > 1) {
                        paginationHtml += `<button onclick="loadAlertHistory(${pagination.page - 1})" style="padding: 8px 15px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer;">‰∏ä‰∏ÄÈ°µ</button>`;
                    }
                    paginationHtml += `<span style="padding: 0 15px;">Á¨¨ ${pagination.page} / ${pagination.pages} È°µ (ÂÖ± ${pagination.total} Êù°)</span>`;
                    if (pagination.page < pagination.pages) {
                        paginationHtml += `<button onclick="loadAlertHistory(${pagination.page + 1})" style="padding: 8px 15px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer;">‰∏ã‰∏ÄÈ°µ</button>`;
                    }
                    document.getElementById('alertHistoryPagination').innerHTML = paginationHtml;
                } else {
                    document.getElementById('alertHistoryPagination').innerHTML = '';
                }
                
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
                console.error('Âä†ËΩΩÂëäË≠¶ÂéÜÂè≤Â§±Ë¥•:', err);
            }
        }
        
        // Á°ÆËÆ§ÂëäË≠¶
        async function acknowledgeAlert(alertId) {
            try {
                const response = await fetch(`/api/alerts/history/${alertId}/acknowledge`, {
                    method: 'POST',
                    credentials: 'same-origin'
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Á°ÆËÆ§Â§±Ë¥•');
                }
                
                // Â¶ÇÊûúÂú®ÂëäË≠¶ÁÆ°ÁêÜÈ°µÈù¢ÔºåÂà∑Êñ∞ÂéÜÂè≤ÂàóË°®
                if (document.getElementById('alertsTab').classList.contains('active')) {
                    await loadAlertHistory(alertHistoryPage);
                }
                // Êõ¥Êñ∞Ê¥ªË∑ÉÂëäË≠¶ÈÄöÁü•
                updateActiveAlerts();
                
            } catch (err) {
                alert('Á°ÆËÆ§ÂëäË≠¶Â§±Ë¥•: ' + err.message);
                console.error('Á°ÆËÆ§ÂëäË≠¶Â§±Ë¥•:', err);
            }
        }
        
        // ËΩ¨‰πâHTMLÔºà‰æõÂ§ö‰∏™ÂáΩÊï∞‰ΩøÁî®Ôºâ
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ============ ÂëäË≠¶ÈÄöÁü•ÂäüËÉΩ ============
        
        // Êõ¥Êñ∞Ê¥ªË∑ÉÂëäË≠¶ÈÄöÁü•
        async function updateActiveAlerts() {
            try {
                const response = await fetch('/api/alerts/active', {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    return;
                }
                
                const result = await response.json();
                
                const activeAlertsBar = document.getElementById('activeAlertsBar');
                if (!activeAlertsBar) {
                    return; // ÂÖÉÁ¥†‰∏çÂ≠òÂú®ÔºåÁõ¥Êé•ËøîÂõû
                }
                
                if (!result.success || !result.data || result.data.length === 0) {
                    activeAlertsBar.style.display = 'none';
                    return;
                }
                
                const alerts = result.data;
                const alertsList = document.getElementById('activeAlertsList');
                if (!alertsList) {
                    return; // ÂÖÉÁ¥†‰∏çÂ≠òÂú®ÔºåÁõ¥Êé•ËøîÂõû
                }
                
                const severityColors = {
                    'critical': '#dc3545',
                    'warning': '#ffc107',
                    'info': '#17a2b8'
                };
                const severityTexts = {
                    'critical': '‰∏•Èáç',
                    'warning': 'Ë≠¶Âëä',
                    'info': '‰ø°ÊÅØ'
                };
                
                alertsList.innerHTML = alerts.slice(0, 5).map(alert => {
                    const triggeredTime = new Date(alert.triggered_at);
                    return `
                        <div style="margin-bottom: 8px; padding: 8px; background: white; border-radius: 4px; border-left: 3px solid ${severityColors[alert.severity] || '#666'};">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <span style="color: ${severityColors[alert.severity] || '#666'}; font-weight: 500; margin-right: 10px;">
                                        [${severityTexts[alert.severity] || alert.severity}]
                                    </span>
                                    <span>${escapeHtml(alert.message)}</span>
                                    <small style="color: #666; margin-left: 10px;">${triggeredTime.toLocaleString('zh-CN')}</small>
                                </div>
                                <button onclick="acknowledgeAlert(${alert.id}); updateActiveAlerts();" style="padding: 4px 12px; margin-left: 10px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer; font-size: 12px;">Á°ÆËÆ§</button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                if (alerts.length > 5) {
                    alertsList.innerHTML += `<div style="margin-top: 8px; color: #666; text-align: center;">ËøòÊúâ ${alerts.length - 5} Êù°ÂëäË≠¶Êú™ÊòæÁ§∫Ôºå<a href="#" onclick="switchTab('alerts'); event.target.closest('button')?.click(); return false;" style="color: #007bff;">Êü•ÁúãÂÖ®ÈÉ®</a></div>`;
                }
                
                // Ê†πÊçÆÊúÄÈ´ò‰∏•ÈáçÁ®ãÂ∫¶ËÆæÁΩÆÈÄöÁü•Êù°È¢úËâ≤
                const hasCritical = alerts.some(a => a.severity === 'critical');
                const hasWarning = alerts.some(a => a.severity === 'warning');
                
                if (hasCritical) {
                    activeAlertsBar.style.background = '#f8d7da';
                    activeAlertsBar.style.borderLeftColor = '#dc3545';
                } else if (hasWarning) {
                    activeAlertsBar.style.background = '#fff3cd';
                    activeAlertsBar.style.borderLeftColor = '#ffc107';
                } else {
                    activeAlertsBar.style.background = '#d1ecf1';
                    activeAlertsBar.style.borderLeftColor = '#17a2b8';
                }
                
                activeAlertsBar.style.display = 'block';
                
            } catch (err) {
                console.debug('Âä†ËΩΩÊ¥ªË∑ÉÂëäË≠¶Â§±Ë¥•:', err);
            }
        }
        
        // ============ Êï∞ÊçÆÁÆ°ÁêÜÂäüËÉΩ ============
        
        // ÂàùÂßãÂåñÊï∞ÊçÆÁÆ°ÁêÜÈ°µÈù¢
        async function initDataManagementPage() {
            await loadDatabaseStats();
            await loadBackupInfo();
            await loadBackupHistory();
        }
        
        // Âä†ËΩΩÊï∞ÊçÆÂ∫ìÁªüËÆ°‰ø°ÊÅØ
        async function loadDatabaseStats() {
            const error = document.getElementById('dataManagementError');
            error.style.display = 'none';
            
            try {
                const response = await fetch('/api/database/management/stats');
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•');
                }
                
                const data = result.data;
                
                // Êõ¥Êñ∞Êï∞ÊçÆÂ∫ìÂ§ßÂ∞èÔºàÁõ¥Êé•ÊòæÁ§∫Ê†ºÂºèÂåñÂêéÁöÑÂÆåÊï¥Â≠óÁ¨¶‰∏≤Ôºâ
                const databaseSizeEl = document.getElementById('databaseSize');
                const databaseSizeFormattedEl = document.getElementById('databaseSizeFormatted');
                if (databaseSizeEl) {
                    databaseSizeEl.textContent = data.database_size_formatted || '0 B';
                }
                if (databaseSizeFormattedEl) {
                    databaseSizeFormattedEl.textContent = '';
                }
                
                // Êõ¥Êñ∞ËÆ∞ÂΩïÊï∞
                const totalTrafficRecordsEl = document.getElementById('totalTrafficRecords');
                const deviceTrafficRecordsEl = document.getElementById('deviceTrafficRecords');
                const deviceCountEl = document.getElementById('deviceCount');
                
                // ‰ΩøÁî®Êõ¥ÂÖ∑‰ΩìÁöÑIDÔºåÈÅøÂÖç‰∏éÂÖ∂‰ªñÈ°µÈù¢ÂÜ≤Á™Å
                // Ê≥®ÊÑèÔºöÊï∞ÊçÆÁÆ°ÁêÜÈ°µÈù¢ÁöÑIDÈúÄË¶ÅÊ∑ªÂä†ÂâçÁºÄÔºåÊàñËÄÖ‰ΩøÁî®Êõ¥ÂÖ∑‰ΩìÁöÑÈÄâÊã©Âô®
                if (totalTrafficRecordsEl) {
                    totalTrafficRecordsEl.textContent = (data.total_traffic_records || 0).toLocaleString();
                }
                if (deviceTrafficRecordsEl) {
                    deviceTrafficRecordsEl.textContent = (data.device_traffic_records || 0).toLocaleString();
                }
                const managementDeviceCountEl = document.getElementById('managementDeviceCount');
                if (managementDeviceCountEl) {
                    managementDeviceCountEl.textContent = (data.device_count || 0).toLocaleString();
                }
                
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
                console.error('Âä†ËΩΩÊï∞ÊçÆÂ∫ìÁªüËÆ°Â§±Ë¥•:', err);
            }
        }
        
        // Êõ¥Êñ∞Ê∏ÖÁêÜUI
        function updateCleanupUI() {
            const cleanupType = document.querySelector('input[name="cleanupType"]:checked').value;
            const keepDaysGroup = document.getElementById('keepDaysGroup');
            const timeRangeGroup = document.getElementById('timeRangeGroup');
            
            if (cleanupType === 'keep_days') {
                keepDaysGroup.style.display = 'block';
                timeRangeGroup.style.display = 'none';
            } else {
                keepDaysGroup.style.display = 'none';
                timeRangeGroup.style.display = 'block';
            }
            
            // ÈöêËóèÈ¢ÑËßà
            document.getElementById('cleanupPreview').style.display = 'none';
        }
        
        // È¢ÑËßàÊ∏ÖÁêÜÊìç‰Ωú
        async function previewCleanup() {
            const error = document.getElementById('dataManagementError');
            const preview = document.getElementById('cleanupPreview');
            error.style.display = 'none';
            
            try {
                const cleanupType = document.querySelector('input[name="cleanupType"]:checked').value;
                let requestData = { preview: true };
                
                if (cleanupType === 'keep_days') {
                    const keepDays = parseInt(document.getElementById('keepDays').value);
                    if (!keepDays || keepDays < 1) {
                        throw new Error('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑ‰øùÁïôÂ§©Êï∞ÔºàËá≥Â∞ë1Â§©Ôºâ');
                    }
                    requestData.keep_days = keepDays;
                } else {
                    const startTime = document.getElementById('cleanupStartTime').value;
                    const endTime = document.getElementById('cleanupEndTime').value;
                    if (!startTime || !endTime) {
                        throw new Error('ËØ∑ÈÄâÊã©ÂºÄÂßãÊó∂Èó¥ÂíåÁªìÊùüÊó∂Èó¥');
                    }
                    requestData.start_time = startTime;
                    requestData.end_time = endTime;
                }
                
                const response = await fetch('/api/database/management/cleanup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'È¢ÑËßàÂ§±Ë¥•');
                }
                
                const data = result.data;
                document.getElementById('previewDeleteCount').textContent = data.total_will_delete || 0;
                preview.style.display = 'block';
                
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
                preview.style.display = 'none';
            }
        }
        
        // ÊâßË°åÊï∞ÊçÆÊ∏ÖÁêÜ
        async function executeCleanup() {
            const error = document.getElementById('dataManagementError');
            const success = document.getElementById('dataManagementSuccess');
            error.style.display = 'none';
            success.style.display = 'none';
            
            // Á°ÆËÆ§Êìç‰Ωú
            const cleanupType = document.querySelector('input[name="cleanupType"]:checked').value;
            let confirmMessage = '';
            
            if (cleanupType === 'keep_days') {
                const keepDays = document.getElementById('keepDays').value;
                confirmMessage = `Á°ÆÂÆöË¶ÅÂà†Èô§‰øùÁïôÊúÄËøë${keepDays}Â§©‰πãÂ§ñÁöÑÊâÄÊúâÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`;
            } else {
                confirmMessage = 'Á°ÆÂÆöË¶ÅÂà†Èô§ÊåáÂÆöÊó∂Èó¥ËåÉÂõ¥ÂÜÖÁöÑÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ';
            }
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            try {
                let requestData = { preview: false };
                
                if (cleanupType === 'keep_days') {
                    const keepDays = parseInt(document.getElementById('keepDays').value);
                    if (!keepDays || keepDays < 1) {
                        throw new Error('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑ‰øùÁïôÂ§©Êï∞ÔºàËá≥Â∞ë1Â§©Ôºâ');
                    }
                    requestData.keep_days = keepDays;
                } else {
                    const startTime = document.getElementById('cleanupStartTime').value;
                    const endTime = document.getElementById('cleanupEndTime').value;
                    if (!startTime || !endTime) {
                        throw new Error('ËØ∑ÈÄâÊã©ÂºÄÂßãÊó∂Èó¥ÂíåÁªìÊùüÊó∂Èó¥');
                    }
                    requestData.start_time = startTime;
                    requestData.end_time = endTime;
                }
                
                const response = await fetch('/api/database/management/cleanup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Ê∏ÖÁêÜÂ§±Ë¥•');
                }
                
                const data = result.data;
                success.style.display = 'block';
                success.textContent = `Ê∏ÖÁêÜÊàêÂäüÔºÅÂà†Èô§‰∫Ü ${data.total_deleted || 0} Êù°ËÆ∞ÂΩïÔºàÂÖ®ÁΩëÊµÅÈáèÔºö${data.deleted_total_traffic || 0}ÔºåËÆæÂ§áÊµÅÈáèÔºö${data.deleted_device_traffic || 0}Ôºâ`;
                
                // ÈáçÊñ∞Âä†ËΩΩÁªüËÆ°‰ø°ÊÅØ
                await loadDatabaseStats();
                // ÈöêËóèÈ¢ÑËßà
                document.getElementById('cleanupPreview').style.display = 'none';
                
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
            }
        }
        
        // ÊâßË°åÊï∞ÊçÆÂ∫ì‰ºòÂåñ
        async function executeVacuum() {
            const error = document.getElementById('dataManagementError');
            const success = document.getElementById('dataManagementSuccess');
            const vacuumResult = document.getElementById('vacuumResult');
            error.style.display = 'none';
            success.style.display = 'none';
            vacuumResult.style.display = 'none';
            
            if (!confirm('Á°ÆÂÆöË¶ÅÊâßË°åÊï∞ÊçÆÂ∫ì‰ºòÂåñÂêóÔºüÊ≠§Êìç‰ΩúÂèØËÉΩÈúÄË¶Å‰∏Ä‰∫õÊó∂Èó¥„ÄÇ')) {
                return;
            }
            
            try {
                const response = await fetch('/api/database/management/vacuum', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || '‰ºòÂåñÂ§±Ë¥•');
                }
                
                const data = result.data;
                vacuumResult.style.display = 'block';
                vacuumResult.innerHTML = `
                    <div style="background: #d4edda; padding: 10px; border-radius: 4px; color: #155724;">
                        <strong>‰ºòÂåñÂÆåÊàêÔºÅ</strong><br>
                        ‰ºòÂåñÂâçÂ§ßÂ∞èÔºö${data.size_before_formatted}<br>
                        ‰ºòÂåñÂêéÂ§ßÂ∞èÔºö${data.size_after_formatted}<br>
                        ÈáäÊîæÁ©∫Èó¥Ôºö${data.size_reduced_formatted}
                    </div>
                `;
                
                // ÈáçÊñ∞Âä†ËΩΩÁªüËÆ°‰ø°ÊÅØ
                await loadDatabaseStats();
                
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
            }
        }
        
        // Âä†ËΩΩÂ§á‰ªΩ‰ø°ÊÅØ
        async function loadBackupInfo() {
            try {
                const response = await fetch('/api/database/management/backup-info');
                const result = await response.json();
                
                if (result.success && result.data) {
                    const data = result.data;
                    const backupInfo = document.getElementById('backupInfo');
                    document.getElementById('backupDatabaseSize').textContent = data.database_size_formatted || '-';
                    document.getElementById('backupRecordCount').textContent = 
                        `${(data.total_traffic_records || 0).toLocaleString()} Êù°ÂÖ®ÁΩëÊµÅÈáèËÆ∞ÂΩïÔºå${(data.device_traffic_records || 0).toLocaleString()} Êù°ËÆæÂ§áÊµÅÈáèËÆ∞ÂΩï`;
                    backupInfo.style.display = 'block';
                }
            } catch (err) {
                console.error('Âä†ËΩΩÂ§á‰ªΩ‰ø°ÊÅØÂ§±Ë¥•:', err);
            }
        }
        
        // Â§á‰ªΩÂéÜÂè≤ËÆ∞ÂΩï
        let backupHistoryPage = 1;
        const backupHistoryPerPage = 20;
        
        // Âä†ËΩΩÂ§á‰ªΩÂéÜÂè≤ËÆ∞ÂΩï
        async function loadBackupHistory(page = 1) {
            const loading = document.getElementById('backupHistoryLoading');
            const error = document.getElementById('backupHistoryError');
            const table = document.getElementById('backupHistoryTable');
            const empty = document.getElementById('backupHistoryEmpty');
            const tableBody = document.getElementById('backupHistoryTableBody');
            const pagination = document.getElementById('backupHistoryPagination');
            
            loading.style.display = 'flex';
            error.style.display = 'none';
            table.style.display = 'none';
            empty.style.display = 'none';
            
            try {
                const response = await fetch(`/api/backup/history?page=${page}&per_page=${backupHistoryPerPage}`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    throw new Error('Âä†ËΩΩÂ§á‰ªΩÂéÜÂè≤Â§±Ë¥•');
                }
                
                const result = await response.json();
                
                if (result.success) {
                    const backups = result.data || [];
                    const pag = result.pagination || {};
                    
                    backupHistoryPage = pag.page || 1;
                    
                    if (backups.length === 0) {
                        empty.style.display = 'block';
                        table.style.display = 'none';
                    } else {
                        empty.style.display = 'none';
                        table.style.display = 'block';
                        
                        // Ê∏≤ÊüìË°®Ê†º
                        tableBody.innerHTML = backups.map(backup => {
                            const createdDate = new Date(backup.created_at);
                            const sizeFormatted = formatBytes(backup.backup_size || 0);
                            const databases = backup.databases ? (typeof backup.databases === 'string' ? JSON.parse(backup.databases) : backup.databases).join(', ') : '-';
                            const statusClass = backup.status === 'success' ? 'success' : 'error';
                            const statusText = backup.status === 'success' ? 'ÊàêÂäü' : 'Â§±Ë¥•';
                            const cloudIcon = backup.cloud_uploaded ? '‚òÅÔ∏è' : 'üìÅ';
                            
                            return `
                                <tr>
                                    <td>${backup.id}</td>
                                    <td>${escapeHtml(backup.backup_filename || '-')}</td>
                                    <td>${sizeFormatted}</td>
                                    <td>${escapeHtml(databases)}</td>
                                    <td><span class="${statusClass}">${statusText}</span></td>
                                    <td>${cloudIcon}</td>
                                    <td>${createdDate.toLocaleString('zh-CN')}</td>
                                    <td>
                                        ${backup.status === 'success' ? `
                                            <button class="btn-secondary" onclick="downloadBackupById(${backup.id})" style="padding: 4px 8px; font-size: 12px; margin-right: 5px;">‰∏ãËΩΩ</button>
                                            ${currentUserRole === 'admin' ? `<button class="btn-secondary" onclick="deleteBackup(${backup.id})" style="padding: 4px 8px; font-size: 12px; background: var(--error-bg); color: var(--error-text);">Âà†Èô§</button>` : ''}
                                        ` : ''}
                                    </td>
                                </tr>
                            `;
                        }).join('');
                        
                        // Ê∏≤ÊüìÂàÜÈ°µ
                        if (pag.pages > 1) {
                            let paginationHTML = '';
                            if (pag.has_prev) {
                                paginationHTML += `<button class="btn-secondary" onclick="loadBackupHistory(${pag.page - 1})" style="padding: 6px 12px;">‰∏ä‰∏ÄÈ°µ</button>`;
                            }
                            paginationHTML += `<span style="margin: 0 15px;">Á¨¨ ${pag.page} È°µ / ÂÖ± ${pag.pages} È°µ (ÂÖ± ${pag.total} Êù°)</span>`;
                            if (pag.has_next) {
                                paginationHTML += `<button class="btn-secondary" onclick="loadBackupHistory(${pag.page + 1})" style="padding: 6px 12px;">‰∏ã‰∏ÄÈ°µ</button>`;
                            }
                            pagination.innerHTML = paginationHTML;
                            pagination.style.display = 'flex';
                        } else {
                            pagination.style.display = 'none';
                        }
                    }
                } else {
                    throw new Error(result.error || 'Âä†ËΩΩÂ§±Ë¥•');
                }
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // ÊâãÂä®Ëß¶ÂèëÂ§á‰ªΩ
        async function triggerManualBackup() {
            if (!confirm('Á°ÆÂÆöË¶ÅÁ´ãÂç≥ÊâßË°å‰∏ÄÊ¨°Â§á‰ªΩÂêóÔºü')) {
                return;
            }
            
            try {
                const response = await fetch('/api/backup/manual', {
                    method: 'POST',
                    credentials: 'same-origin'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Â§á‰ªΩ‰ªªÂä°Â∑≤ÂêØÂä®ÔºåÂ∞ÜÂú®ÂêéÂè∞ÊâßË°å„ÄÇËØ∑Á®çÂêéÂà∑Êñ∞Êü•ÁúãÂ§á‰ªΩÂéÜÂè≤ËÆ∞ÂΩï„ÄÇ');
                    setTimeout(() => {
                        loadBackupHistory(backupHistoryPage);
                    }, 2000);
                } else {
                    alert('Â§á‰ªΩÂ§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'));
                }
            } catch (err) {
                alert('Â§á‰ªΩÂ§±Ë¥•: ' + err.message);
            }
        }
        
        // Ê†πÊçÆID‰∏ãËΩΩÂ§á‰ªΩ
        async function downloadBackupById(backupId) {
            try {
                const response = await fetch(`/api/backup/download/${backupId}`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || '‰∏ãËΩΩÂ§±Ë¥•');
                }
                
                // Ëé∑ÂèñÊñá‰ª∂ÂêçÔºà‰ªéContent-DispositionÂ§¥Êàñ‰ΩøÁî®ÈªòËÆ§ÂêçÁß∞Ôºâ
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = `backup_${backupId}.zip`;
                if (contentDisposition) {
                    const filenameMatch = contentDisposition.match(/filename="?([^"]+)"?/);
                    if (filenameMatch) {
                        filename = filenameMatch[1];
                    }
                }
                
                // ‰∏ãËΩΩÊñá‰ª∂
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } catch (err) {
                alert('‰∏ãËΩΩÂ§±Ë¥•: ' + err.message);
            }
        }
        
        // Âà†Èô§Â§á‰ªΩ
        async function deleteBackup(backupId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Â§á‰ªΩÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/backup/${backupId}`, {
                    method: 'DELETE',
                    credentials: 'same-origin'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Â§á‰ªΩÂ∑≤Âà†Èô§');
                    loadBackupHistory(backupHistoryPage);
                } else {
                    alert('Âà†Èô§Â§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'));
                }
            } catch (err) {
                alert('Âà†Èô§Â§±Ë¥•: ' + err.message);
            }
        }
        
        // ‰∏ãËΩΩÊï∞ÊçÆÂ∫ìÂ§á‰ªΩÔºàÊúÄÊñ∞Â§á‰ªΩÔºâ
        async function downloadBackup() {
            try {
                const response = await fetch('/api/database/management/backup');
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || '‰∏ãËΩΩÂ§±Ë¥•');
                }
                
                // Ëé∑ÂèñÊñá‰ª∂ÂêçÔºà‰ªéContent-DispositionÂ§¥Êàñ‰ΩøÁî®ÈªòËÆ§ÂêçÁß∞Ôºâ
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = 'traffic_data_backup.sql';
                if (contentDisposition) {
                    const filenameMatch = contentDisposition.match(/filename="?([^"]+)"?/);
                    if (filenameMatch) {
                        filename = filenameMatch[1];
                    }
                }
                
                // ‰∏ãËΩΩÊñá‰ª∂
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                alert('Â§á‰ªΩÊñá‰ª∂‰∏ãËΩΩÊàêÂäüÔºÅ');
                
            } catch (err) {
                const error = document.getElementById('dataManagementError');
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
            }
        }
        
        // Ê†ºÂºèÂåñÊï∞ÊçÆÂ∫ìÂ§ßÂ∞è
        function formatDatabaseSize(bytes) {
            if (bytes < 1024) {
                return { value: bytes.toFixed(0), unit: 'B' };
            } else if (bytes < 1024 * 1024) {
                return { value: (bytes / 1024).toFixed(1), unit: 'KB' };
            } else if (bytes < 1024 * 1024 * 1024) {
                return { value: (bytes / (1024 * 1024)).toFixed(2), unit: 'MB' };
            } else {
                return { value: (bytes / (1024 * 1024 * 1024)).toFixed(2), unit: 'GB' };
            }
        }
        
        // ============ Êä•Ë°®ÁÆ°ÁêÜÂäüËÉΩ ============
        let reportHistoryPage = 1;
        
        // ÂàùÂßãÂåñÊä•Ë°®ÁÆ°ÁêÜÈ°µÈù¢
        async function initReportPage() {
            await loadReportHistory(1);
        }
        
        // Âä†ËΩΩÊä•Ë°®ÂéÜÂè≤ËÆ∞ÂΩï
        async function loadReportHistory(page = 1) {
            reportHistoryPage = page;
            const loading = document.getElementById('reportHistoryLoading');
            const error = document.getElementById('reportHistoryError');
            const table = document.getElementById('reportHistoryTable');
            const empty = document.getElementById('reportHistoryEmpty');
            const tbody = document.getElementById('reportHistoryTableBody');
            
            loading.style.display = 'flex';
            error.style.display = 'none';
            table.style.display = 'none';
            empty.style.display = 'none';
            
            try {
                const reportTypeFilter = document.getElementById('reportTypeFilter').value;
                let url = `/api/report/history?page=${page}&per_page=20`;
                if (reportTypeFilter) {
                    url += `&report_type=${reportTypeFilter}`;
                }
                
                const response = await fetch(url, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    throw new Error('Âä†ËΩΩÂ§±Ë¥•');
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩÂ§±Ë¥•');
                }
                
                if (result.data.length === 0) {
                    empty.style.display = 'block';
                    table.style.display = 'none';
                } else {
                    empty.style.display = 'none';
                    table.style.display = 'block';
                    
                    const typeNames = {
                        'daily': 'Êó•Êä•',
                        'weekly': 'Âë®Êä•',
                        'monthly': 'ÊúàÊä•'
                    };
                    
                    tbody.innerHTML = result.data.map(report => {
                        const createdTime = new Date(report.created_at);
                        const statusBadge = report.status === 'success' 
                            ? '<span style="color: #28a745; font-weight: 500;">ÊàêÂäü</span>'
                            : `<span style="color: #dc3545; font-weight: 500;">Â§±Ë¥•</span>`;
                        
                        let actionsHtml = '';
                        if (report.status === 'success') {
                            if (report.file_path_pdf) {
                                actionsHtml += `<button onclick="downloadReport(${report.id}, 'pdf')" style="padding: 5px 10px; margin-right: 5px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer;">üìÑ PDF</button>`;
                            }
                            if (report.file_path_html) {
                                actionsHtml += `<button onclick="downloadReport(${report.id}, 'html')" style="padding: 5px 10px; margin-right: 5px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer;">üåê HTML</button>`;
                            }
                            if (report.file_path_excel) {
                                actionsHtml += `<button onclick="downloadReport(${report.id}, 'excel')" style="padding: 5px 10px; margin-right: 5px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer;">üìä Excel</button>`;
                            }
                        }
                        if (window.isAdmin) {
                            actionsHtml += `<button onclick="deleteReport(${report.id})" style="padding: 5px 10px; border: 1px solid #dc3545; background: white; color: #dc3545; border-radius: 4px; cursor: pointer;">üóëÔ∏è Âà†Èô§</button>`;
                        }
                        
                        return `
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">${report.id}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">${typeNames[report.report_type] || report.report_type}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">${report.report_period}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">${createdTime.toLocaleString('zh-CN')}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">${report.file_size_formatted || '0 B'}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">${statusBadge}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;">${actionsHtml || '-'}</td>
                            </tr>
                        `;
                    }).join('');
                    
                    // ÂàÜÈ°µ
                    const pagination = result.pagination;
                    if (pagination && pagination.pages > 1) {
                        let paginationHtml = '';
                        if (pagination.page > 1) {
                            paginationHtml += `<button onclick="loadReportHistory(${pagination.page - 1})" style="padding: 8px 15px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer;">‰∏ä‰∏ÄÈ°µ</button>`;
                        }
                        paginationHtml += `<span style="padding: 0 15px;">Á¨¨ ${pagination.page} / ${pagination.pages} È°µ (ÂÖ± ${pagination.total} Êù°)</span>`;
                        if (pagination.page < pagination.pages) {
                            paginationHtml += `<button onclick="loadReportHistory(${pagination.page + 1})" style="padding: 8px 15px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer;">‰∏ã‰∏ÄÈ°µ</button>`;
                        }
                        document.getElementById('reportHistoryPagination').innerHTML = paginationHtml;
                    } else {
                        document.getElementById('reportHistoryPagination').innerHTML = '';
                    }
                }
                
            } catch (err) {
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
                console.error('Âä†ËΩΩÊä•Ë°®ÂéÜÂè≤Â§±Ë¥•:', err);
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // ÊâãÂä®ÁîüÊàêÊä•Ë°®
        async function generateManualReport() {
            const reportType = document.getElementById('manualReportType').value;
            
            if (!confirm(`Á°ÆÂÆöË¶ÅÁîüÊàê${reportType === 'daily' ? 'Êó•Êä•' : reportType === 'weekly' ? 'Âë®Êä•' : 'ÊúàÊä•'}ÂêóÔºü`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/report/manual', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify({
                        report_type: reportType
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Êä•Ë°®ÁîüÊàê‰ªªÂä°Â∑≤ÂêØÂä®ÔºåÂ∞ÜÂú®ÂêéÂè∞ÊâßË°å„ÄÇËØ∑Á®çÂêéÂà∑Êñ∞Êü•ÁúãÊä•Ë°®ÂéÜÂè≤ËÆ∞ÂΩï„ÄÇ');
                    setTimeout(() => {
                        loadReportHistory(reportHistoryPage);
                    }, 2000);
                } else {
                    alert('Êä•Ë°®ÁîüÊàêÂ§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'));
                }
            } catch (err) {
                alert('Êä•Ë°®ÁîüÊàêÂ§±Ë¥•: ' + err.message);
            }
        }
        
        // ‰∏ãËΩΩÊä•Ë°®
        async function downloadReport(reportId, format) {
            try {
                const response = await fetch(`/api/report/download/${reportId}?format=${format}`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || '‰∏ãËΩΩÂ§±Ë¥•');
                }
                
                // Ëé∑ÂèñÊñá‰ª∂Âêç
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = `report_${reportId}.${format}`;
                if (contentDisposition) {
                    const filenameMatch = contentDisposition.match(/filename="?([^"]+)"?/);
                    if (filenameMatch) {
                        filename = filenameMatch[1];
                    }
                }
                
                // ‰∏ãËΩΩÊñá‰ª∂
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } catch (err) {
                alert('‰∏ãËΩΩÂ§±Ë¥•: ' + err.message);
            }
        }
        
        // Âà†Èô§Êä•Ë°®
        async function deleteReport(reportId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Êä•Ë°®ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/report/${reportId}`, {
                    method: 'DELETE',
                    credentials: 'same-origin'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Êä•Ë°®Â∑≤Âà†Èô§');
                    loadReportHistory(reportHistoryPage);
                } else {
                    alert('Âà†Èô§Â§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'));
                }
            } catch (err) {
                alert('Âà†Èô§Â§±Ë¥•: ' + err.message);
            }
        }
        
        // ============ Êï∞ÊçÆÂõæË°®ÂäüËÉΩ ============
        window.trafficTrendChart = null;
        window.deviceComparisonChart = null;
        
        // ÂàùÂßãÂåñÂõæË°®È°µÈù¢
        async function initChartsPage() {
            // Âä†ËΩΩËÆæÂ§áÂàóË°®Âà∞‰∏ãÊãâÊ°Ü
            await loadDevicesForChart();
            
            // ÁõëÂê¨ÂõæË°®Á±ªÂûãÂèòÂåñ
            const chartTypeSelect = document.getElementById('chartTypeSelect');
            if (chartTypeSelect) {
                chartTypeSelect.addEventListener('change', function() {
                    const chartType = this.value;
                    const deviceGroup = document.getElementById('deviceSelectorGroup');
                    
                    if (chartType === 'traffic_trend') {
                        deviceGroup.style.display = 'block';
                    } else {
                        deviceGroup.style.display = 'none';
                    }
                    
                    // ÈöêËóèÊâÄÊúâÂõæË°®
                    document.getElementById('trafficTrendChart').style.display = 'none';
                    document.getElementById('deviceComparisonChart').style.display = 'none';
                });
            }
            
            // ÈªòËÆ§Âä†ËΩΩÊµÅÈáèË∂ãÂäøÂõæÔºàÂÖ®ÁΩëÊµÅÈáèÔºåÊúÄËøë24Â∞èÊó∂Ôºâ
            loadChart();
        }
        
        // Âä†ËΩΩËÆæÂ§áÂàóË°®Âà∞ÂõæË°®ËÆæÂ§áÈÄâÊã©Âô®
        async function loadDevicesForChart() {
            try {
                const response = await fetch('/api/database/devices');
                const result = await response.json();
                
                const deviceSelect = document.getElementById('chartDeviceSelect');
                if (deviceSelect) {
                    deviceSelect.innerHTML = '<option value="total">ÂÖ®ÁΩëÊµÅÈáè</option>';
                    
                    if (result.success && result.data) {
                        result.data.forEach(device => {
                            const option = document.createElement('option');
                            option.value = device.id;
                            option.textContent = `${device.hostname || 'Êú™Áü•'} (${device.mac})`;
                            deviceSelect.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('Âä†ËΩΩËÆæÂ§áÂàóË°®Â§±Ë¥•:', error);
            }
        }
        
        // Âä†ËΩΩÂõæË°®
        async function loadChart() {
            const chartType = document.getElementById('chartTypeSelect').value;
            
            if (chartType === 'traffic_trend') {
                await loadTrafficTrendChart();
            } else if (chartType === 'device_comparison') {
                await loadDeviceComparison();
            }
        }
        
        // Âä†ËΩΩÊµÅÈáèË∂ãÂäøÂõæ
        async function loadTrafficTrendChart() {
            const loading = document.getElementById('chartLoading');
            const error = document.getElementById('chartError');
            const chartContainer = document.getElementById('trafficTrendChart');
            
            loading.style.display = 'block';
            error.style.display = 'none';
            chartContainer.style.display = 'none';
            
            try {
                const deviceSelect = document.getElementById('chartDeviceSelect');
                const timeRange = document.getElementById('timeRangeSelect').value;
                const deviceId = deviceSelect.value;
                
                let url = `/api/database/charts/traffic-trend?hours=${timeRange}&interval=5`;
                
                if (deviceId === 'total') {
                    url += '&type=total';
                } else {
                    url += `&type=device&device_id=${deviceId}`;
                }
                
                const response = await fetch(url);
                const result = await response.json();
                
                loading.style.display = 'none';
                
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩÂõæË°®Êï∞ÊçÆÂ§±Ë¥•');
                }
                
                // ÊòæÁ§∫ÂõæË°®ÂÆπÂô®
                chartContainer.style.display = 'block';
                document.getElementById('deviceComparisonChart').style.display = 'none';
                
                // ÂáÜÂ§áÊï∞ÊçÆ
                const labels = result.data.map(item => {
                    const date = new Date(item.timestamp);
                    return date.toLocaleString('zh-CN', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                });
                
                const downSpeedData = result.data.map(item => (item.down_speed / 1024).toFixed(2)); // KB/s
                const upSpeedData = result.data.map(item => (item.up_speed / 1024).toFixed(2)); // KB/s
                
                // ÈîÄÊØÅÊóßÂõæË°®
                if (window.trafficTrendChart) {
                    window.trafficTrendChart.destroy();
                }
                
                // ÂàõÂª∫Êñ∞ÂõæË°®
                const ctx = document.getElementById('trafficTrendCanvas').getContext('2d');
                const chartTheme = getChartThemeConfig();
                window.trafficTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '‰∏ãË°åÈÄüÁéá (KB/s)',
                            data: downSpeedData,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.1
                        }, {
                            label: '‰∏äË°åÈÄüÁéá (KB/s)',
                            data: upSpeedData,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            title: {
                                display: true,
                                text: deviceId === 'total' ? 'ÂÖ®ÁΩëÊµÅÈáèË∂ãÂäø' : 'ËÆæÂ§áÊµÅÈáèË∂ãÂäø',
                                color: chartTheme.textColor
                            },
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    color: chartTheme.textColor
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: chartTheme.textColor
                                },
                                grid: {
                                    color: chartTheme.gridColor
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: chartTheme.textColor
                                },
                                grid: {
                                    color: chartTheme.gridColor
                                },
                                title: {
                                    display: true,
                                    text: 'ÈÄüÁéá (KB/s)',
                                    color: chartTheme.textColor
                                }
                            }
                        }
                    }
                });
                
            } catch (err) {
                loading.style.display = 'none';
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
            }
        }
        
        // Âä†ËΩΩËÆæÂ§áÂØπÊØîÂõæ
        async function loadDeviceComparison() {
            const loading = document.getElementById('chartLoading');
            const error = document.getElementById('chartError');
            const chartContainer = document.getElementById('deviceComparisonChart');
            
            loading.style.display = 'block';
            error.style.display = 'none';
            chartContainer.style.display = 'none';
            
            try {
                const timeRange = document.getElementById('timeRangeSelect').value;
                const comparisonType = document.querySelector('input[name="comparisonType"]:checked').value;
                
                const url = `/api/database/charts/device-comparison?hours=${timeRange}&type=${comparisonType}`;
                const response = await fetch(url);
                const result = await response.json();
                
                loading.style.display = 'none';
                
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩÂõæË°®Êï∞ÊçÆÂ§±Ë¥•');
                }
                
                // Âè™ÊòæÁ§∫Ââç10‰∏™ËÆæÂ§á
                const data = result.data.slice(0, 10);
                
                if (data.length === 0) {
                    throw new Error('ÊöÇÊó†Êï∞ÊçÆ');
                }
                
                // ÊòæÁ§∫ÂõæË°®ÂÆπÂô®
                chartContainer.style.display = 'block';
                document.getElementById('trafficTrendChart').style.display = 'none';
                
                // ÂáÜÂ§áÊï∞ÊçÆ
                const labels = data.map(item => item.device_name);
                
                let dataset1, dataset2, yAxisLabel;
                
                if (comparisonType === 'speed') {
                    dataset1 = {
                        label: '‰∏ãË°åÈÄüÁéá (KB/s)',
                        data: data.map(item => (item.down_speed / 1024).toFixed(2)),
                        backgroundColor: 'rgba(75, 192, 192, 0.6)'
                    };
                    dataset2 = {
                        label: '‰∏äË°åÈÄüÁéá (KB/s)',
                        data: data.map(item => (item.up_speed / 1024).toFixed(2)),
                        backgroundColor: 'rgba(255, 99, 132, 0.6)'
                    };
                    yAxisLabel = 'ÈÄüÁéá (KB/s)';
                } else {
                    dataset1 = {
                        label: '‰∏ãËΩΩÊµÅÈáè (MB)',
                        data: data.map(item => (item.total_download / 1024 / 1024).toFixed(2)),
                        backgroundColor: 'rgba(75, 192, 192, 0.6)'
                    };
                    dataset2 = {
                        label: '‰∏ä‰º†ÊµÅÈáè (MB)',
                        data: data.map(item => (item.total_upload / 1024 / 1024).toFixed(2)),
                        backgroundColor: 'rgba(255, 99, 132, 0.6)'
                    };
                    yAxisLabel = 'ÊµÅÈáè (MB)';
                }
                
                // ÈîÄÊØÅÊóßÂõæË°®
                if (window.deviceComparisonChart) {
                    window.deviceComparisonChart.destroy();
                }
                
                // ÂàõÂª∫Êñ∞ÂõæË°®
                const ctx = document.getElementById('deviceComparisonCanvas').getContext('2d');
                const chartTheme = getChartThemeConfig();
                window.deviceComparisonChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [dataset1, dataset2]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            title: {
                                display: true,
                                text: comparisonType === 'speed' ? 'ËÆæÂ§áÈÄüÁéáÂØπÊØî' : 'ËÆæÂ§áÊµÅÈáèÂØπÊØî',
                                color: chartTheme.textColor
                            },
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    color: chartTheme.textColor
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: chartTheme.textColor
                                },
                                grid: {
                                    color: chartTheme.gridColor
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: chartTheme.textColor
                                },
                                grid: {
                                    color: chartTheme.gridColor
                                },
                                title: {
                                    display: true,
                                    text: yAxisLabel,
                                    color: chartTheme.textColor
                                }
                            }
                        }
                    }
                });
                
            } catch (err) {
                loading.style.display = 'none';
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
            }
        }
    </script>
    
    <!-- Chart.js Â∫ì -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- SheetJS (xlsx) Â∫ì - Áî®‰∫éExcelÂØºÂá∫ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- ============ ÂÆûÊó∂ÁõëÊéß‰ª™Ë°®ÁõòÂäüËÉΩ ============ -->
    <script>
        let dashboardRefreshInterval = null;
        let dashboardRefreshIntervalSeconds = 10;
        
        // ÂàùÂßãÂåñ‰ª™Ë°®Áõò
        function initDashboard() {
            // Âä†ËΩΩÊï∞ÊçÆ
            loadDashboardData();
            
            // ËÆæÁΩÆÂà∑Êñ∞Èó¥Èöî
            const intervalSelect = document.getElementById('refreshIntervalSelect');
            if (intervalSelect) {
                intervalSelect.addEventListener('change', function() {
                    const interval = parseInt(this.value);
                    dashboardRefreshIntervalSeconds = interval;
                    setupAutoRefresh(interval);
                });
                
                // ÂàùÂßãËÆæÁΩÆ
                setupAutoRefresh(dashboardRefreshIntervalSeconds);
            }
        }
        
        // ËÆæÁΩÆËá™Âä®Âà∑Êñ∞
        function setupAutoRefresh(intervalSeconds) {
            // Ê∏ÖÈô§Áé∞ÊúâÂÆöÊó∂Âô®
            if (dashboardRefreshInterval) {
                clearInterval(dashboardRefreshInterval);
                dashboardRefreshInterval = null;
            }
            
            // Â¶ÇÊûúÈó¥ÈöîÂ§ß‰∫é0ÔºåËÆæÁΩÆÊñ∞ÁöÑÂÆöÊó∂Âô®
            if (intervalSeconds > 0) {
                dashboardRefreshInterval = setInterval(() => {
                    loadDashboardData();
                }, intervalSeconds * 1000);
            }
        }
        
        // ÊâãÂä®Âà∑Êñ∞
        function manualRefreshDashboard() {
            loadDashboardData();
        }
        
        // Âä†ËΩΩ‰ª™Ë°®ÁõòÊï∞ÊçÆ
        async function loadDashboardData() {
            const error = document.getElementById('dashboardError');
            
            error.style.display = 'none';
            
            try {
                const response = await fetch('/api/database/dashboard', {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•');
                }
                
                const data = result.data;
                
                // Êõ¥Êñ∞ÂÆûÊó∂ÊµÅÈáèÂç°Áâá
                if (data.total) {
                    updateTrafficCards(data.total);
                }
                
                // Êõ¥Êñ∞Á≥ªÁªüÁä∂ÊÄÅ
                if (data.system_status) {
                    updateSystemStatus(data.system_status);
                }
                
                // Êõ¥Êñ∞ËÆæÂ§áÂàóË°®ÂíåÊéíË°åÊ¶ú
                if (data.devices) {
                    updateDeviceRanking(data.devices);
                }
                
            } catch (err) {
                console.error('Âä†ËΩΩ‰ª™Ë°®ÁõòÊï∞ÊçÆÂ§±Ë¥•:', err);
                error.style.display = 'block';
                error.textContent = 'ÈîôËØØ: ' + err.message;
            }
        }
        
        // Êõ¥Êñ∞ÊµÅÈáèÂç°Áâá
        function updateTrafficCards(totalData) {
            // ‰∏ãË°åÈÄüÁéá
            document.getElementById('currentDownSpeed').textContent = totalData.down_speed_formatted || '0 B/s';
            document.getElementById('currentDownSpeedFormatted').textContent = '';
            
            // ‰∏äË°åÈÄüÁéá
            document.getElementById('currentUpSpeed').textContent = totalData.up_speed_formatted || '0 B/s';
            document.getElementById('currentUpSpeedFormatted').textContent = '';
            
            // ÊÄª‰∏ãËΩΩÊµÅÈáè
            document.getElementById('totalDownload').textContent = totalData.total_download_formatted || '0 B';
            document.getElementById('totalDownloadFormatted').textContent = '';
            
            // ÊÄª‰∏ä‰º†ÊµÅÈáè
            document.getElementById('totalUpload').textContent = totalData.total_upload_formatted || '0 B';
            document.getElementById('totalUploadFormatted').textContent = '';
        }
        
        // Êõ¥Êñ∞Á≥ªÁªüÁä∂ÊÄÅ
        function updateSystemStatus(status) {
            document.getElementById('collectorStatus').textContent = status.collector_status || '-';
            document.getElementById('totalRecords').textContent = (status.total_records || 0).toLocaleString();
            document.getElementById('deviceCount').textContent = (status.device_count || 0).toLocaleString();
            
            if (status.latest_data_time) {
                const date = new Date(status.latest_data_time);
                document.getElementById('latestDataTime').textContent = date.toLocaleString('zh-CN');
            } else {
                document.getElementById('latestDataTime').textContent = '-';
            }
        }
        
        // Êõ¥Êñ∞ËÆæÂ§áÊéíË°åÊ¶ú
        function updateDeviceRanking(devices) {
            const tableBody = document.getElementById('rankingTableBody');
            const tableContainer = document.getElementById('deviceRankingTable');
            const empty = document.getElementById('rankingEmpty');
            
            if (!devices || devices.length === 0) {
                tableContainer.style.display = 'none';
                empty.style.display = 'block';
                return;
            }
            
            tableContainer.style.display = 'block';
            empty.style.display = 'none';
            
            // Âè™ÊòæÁ§∫Top 10
            const topDevices = devices.slice(0, 10);
            
            tableBody.innerHTML = topDevices.map((device, index) => {
                const statusClass = device.is_online ? 'online' : 'offline';
                const statusText = device.is_online ? 'Âú®Á∫ø' : 'Á¶ªÁ∫ø';
                const totalTrafficFormatted = formatBytesToSize(device.total_traffic_bytes);
                const lastActive = device.last_active ? new Date(device.last_active).toLocaleString('zh-CN') : '-';
                
                return `
                    <tr>
                        <td><span class="device-status ${statusClass}"></span>${statusText}</td>
                        <td>${escapeHtml(device.hostname)}</td>
                        <td>${escapeHtml(device.mac)}</td>
                        <td>${escapeHtml(device.ip)}</td>
                        <td>${device.down_speed_formatted || '-'}</td>
                        <td>${device.up_speed_formatted || '-'}</td>
                        <td>${totalTrafficFormatted}</td>
                        <td>${lastActive}</td>
                    </tr>
                `;
            }).join('');
        }
        
        // Ê†ºÂºèÂåñÈÄüÂ∫¶ÂÄºÔºàÁî®‰∫éÂ§ßÊï∞Â≠óÊòæÁ§∫Ôºâ
        function formatSpeedValue(bytesPerSecond) {
            if (bytesPerSecond < 1024) {
                return { value: bytesPerSecond.toFixed(0), unit: 'B/s' };
            } else if (bytesPerSecond < 1024 * 1024) {
                return { value: (bytesPerSecond / 1024).toFixed(1), unit: 'KB/s' };
            } else if (bytesPerSecond < 1024 * 1024 * 1024) {
                return { value: (bytesPerSecond / (1024 * 1024)).toFixed(2), unit: 'MB/s' };
            } else {
                return { value: (bytesPerSecond / (1024 * 1024 * 1024)).toFixed(2), unit: 'GB/s' };
            }
        }
        
        // Ê†ºÂºèÂåñÂ§ßÂ∞èÂÄºÔºàÁî®‰∫éÂ§ßÊï∞Â≠óÊòæÁ§∫Ôºâ
        function formatSizeValue(bytes) {
            if (bytes < 1024) {
                return { value: bytes.toFixed(0), unit: 'B' };
            } else if (bytes < 1024 * 1024) {
                return { value: (bytes / 1024).toFixed(1), unit: 'KB' };
            } else if (bytes < 1024 * 1024 * 1024) {
                return { value: (bytes / (1024 * 1024)).toFixed(2), unit: 'MB' };
            } else if (bytes < 1024 * 1024 * 1024 * 1024) {
                return { value: (bytes / (1024 * 1024 * 1024)).toFixed(2), unit: 'GB' };
            } else {
                return { value: (bytes / (1024 * 1024 * 1024 * 1024)).toFixed(2), unit: 'TB' };
            }
        }
        
        // Ê†ºÂºèÂåñÂ≠óËäÇ‰∏∫ÂèØËØªÂ§ßÂ∞è
        function formatBytesToSize(bytes) {
            const formatted = formatSizeValue(bytes);
            return `${formatted.value} ${formatted.unit}`;
        }
        
        // HTMLËΩ¨‰πâ
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // È°µÈù¢Âç∏ËΩΩÊó∂Ê∏ÖÈô§ÂÆöÊó∂Âô®
        window.addEventListener('beforeunload', function() {
            if (dashboardRefreshInterval) {
                clearInterval(dashboardRefreshInterval);
            }
            stopApiStatsRefresh();
        });
        
        // ============ APIÁªüËÆ°ÂäüËÉΩ ============
        
        // APIÁªüËÆ°Ëá™Âä®Âà∑Êñ∞ÂÆöÊó∂Âô®
        let apiStatsRefreshInterval = null;
        
        // ÂàùÂßãÂåñAPIÁªüËÆ°È°µÈù¢
        async function initApiStatsPage() {
            await loadApiStats();
            // ÂêØÂä®Ëá™Âä®Âà∑Êñ∞ÔºàÊØè5ÁßíÔºâ
            if (apiStatsRefreshInterval) {
                clearInterval(apiStatsRefreshInterval);
            }
            apiStatsRefreshInterval = setInterval(() => {
                loadApiStats();
            }, 5000);
        }
        
        // ÂÅúÊ≠¢APIÁªüËÆ°Ëá™Âä®Âà∑Êñ∞
        function stopApiStatsRefresh() {
            if (apiStatsRefreshInterval) {
                clearInterval(apiStatsRefreshInterval);
                apiStatsRefreshInterval = null;
            }
        }
        
        // Âä†ËΩΩAPIÁªüËÆ°Êï∞ÊçÆ
        async function loadApiStats() {
            const timeRange = document.getElementById('statsTimeRange')?.value || 'all';
            
            try {
                // Âä†ËΩΩÁªüËÆ°ÊëòË¶Å
                await loadApiStatsSummary(timeRange);
                // Âä†ËΩΩTopÁ´ØÁÇπ
                await loadTopEndpoints(timeRange);
                // Âä†ËΩΩÊâÄÊúâÁ´ØÁÇπ
                await loadApiEndpoints(timeRange);
            } catch (error) {
                console.error('Âä†ËΩΩAPIÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•:', error);
                showApiStatsError('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•: ' + error.message);
            }
        }
        
        // Âä†ËΩΩÁªüËÆ°ÊëòË¶Å
        async function loadApiStatsSummary(timeRange = 'all') {
            try {
                const response = await fetch(`/api/stats/summary?time_range=${timeRange}`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('ÈúÄË¶ÅÁÆ°ÁêÜÂëòÊùÉÈôê');
                    }
                    throw new Error('Âä†ËΩΩÁªüËÆ°ÊëòË¶ÅÂ§±Ë¥•');
                }
                
                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩÁªüËÆ°ÊëòË¶ÅÂ§±Ë¥•');
                }
                
                const data = result.data;
                const totalCalls = data.total_calls || 0;
                const totalEndpoints = data.total_endpoints || 0;
                const activeUsers = data.total_active_users || 0;
                document.getElementById('totalCalls').textContent = totalCalls.toLocaleString('zh-CN');
                document.getElementById('uniqueEndpoints').textContent = totalEndpoints.toLocaleString('zh-CN');
                document.getElementById('activeUsers').textContent = activeUsers.toLocaleString('zh-CN');
            } catch (error) {
                console.error('Âä†ËΩΩÁªüËÆ°ÊëòË¶ÅÂ§±Ë¥•:', error);
                document.getElementById('totalCalls').textContent = '-';
                document.getElementById('uniqueEndpoints').textContent = '-';
                document.getElementById('activeUsers').textContent = '-';
            }
        }
        
        // Âä†ËΩΩTopÁ´ØÁÇπ
        async function loadTopEndpoints(timeRange = 'all') {
            const loading = document.getElementById('topEndpointsLoading');
            const tableBody = document.getElementById('topEndpointsTableBody');
            
            loading.style.display = 'flex';
            
            try {
                const response = await fetch(`/api/stats/top?limit=10&time_range=${timeRange}`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('ÈúÄË¶ÅÁÆ°ÁêÜÂëòÊùÉÈôê');
                    }
                    throw new Error('Âä†ËΩΩTopÁ´ØÁÇπÂ§±Ë¥•');
                }
                
                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩTopÁ´ØÁÇπÂ§±Ë¥•');
                }
                
                const endpoints = result.data || [];
                
                if (endpoints.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="7" style="padding: 40px 20px; text-align: center; color: var(--text-secondary);">ÊöÇÊó†Êï∞ÊçÆ</td></tr>';
                } else {
                    tableBody.innerHTML = endpoints.map((endpoint, index) => {
                        const rankClass = index < 3 ? ' style="font-weight: bold; color: var(--accent-color);"' : '';
                        const rankIcon = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
                        const method = endpoint.method || '-';
                        const methodBadge = method !== '-' ? `<span style="display: inline-block; padding: 4px 10px; background: ${method === 'GET' ? '#4CAF50' : method === 'POST' ? '#2196F3' : method === 'PUT' ? '#FF9800' : method === 'DELETE' ? '#F44336' : '#9E9E9E'}; color: white; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase;">${method}</span>` : '-';
                        const lastCalled = endpoint.last_called_at ? new Date(endpoint.last_called_at).toLocaleString('zh-CN') : '-';
                        const userCount = endpoint.user_count || 0;
                        const totalCalls = endpoint.total_calls || 0;
                        const formattedCalls = totalCalls.toLocaleString('zh-CN');
                        return `
                            <tr style="border-bottom: 1px solid var(--border-color); transition: background-color 0.2s;" 
                                onmouseover="this.style.backgroundColor='var(--bg-secondary)'" 
                                onmouseout="this.style.backgroundColor='transparent'">
                                <td style="padding: 14px 16px; font-weight: 600;"${rankClass}>${rankIcon} ${index + 1}</td>
                                <td style="padding: 14px 16px; font-family: 'Courier New', monospace; color: var(--text-primary);">${escapeHtml(endpoint.endpoint)}</td>
                                <td style="padding: 14px 16px; text-align: center;">${methodBadge}</td>
                                <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">${formattedCalls}</td>
                                <td style="padding: 14px 16px; text-align: right; color: var(--text-secondary);">${userCount}</td>
                                <td style="padding: 14px 16px; color: var(--text-secondary); font-size: 13px;">${lastCalled}</td>
                                <td style="padding: 14px 16px; text-align: center;">
                                    <button onclick="showEndpointDetail('${escapeHtml(endpoint.endpoint.replace(/'/g, "\'"))}')" class="btn-secondary" style="padding: 8px 16px; font-size: 13px; border-radius: 6px; transition: all 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">Êü•ÁúãËØ¶ÊÉÖ</button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('Âä†ËΩΩTopÁ´ØÁÇπÂ§±Ë¥•:', error);
                tableBody.innerHTML = `<tr><td colspan="7" style="padding: 20px; text-align: center; color: var(--error-text);">Âä†ËΩΩÂ§±Ë¥•: ${escapeHtml(error.message)}</td></tr>`;
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // Âä†ËΩΩÊâÄÊúâÁ´ØÁÇπ
        async function loadApiEndpoints(timeRange = 'all') {
            const loading = document.getElementById('allEndpointsLoading');
            const tableBody = document.getElementById('allEndpointsTableBody');
            
            loading.style.display = 'flex';
            
            try {
                const response = await fetch(`/api/stats/endpoints?time_range=${timeRange}`, {
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('ÈúÄË¶ÅÁÆ°ÁêÜÂëòÊùÉÈôê');
                    }
                    throw new Error('Âä†ËΩΩÁ´ØÁÇπÂàóË°®Â§±Ë¥•');
                }
                
                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.error || 'Âä†ËΩΩÁ´ØÁÇπÂàóË°®Â§±Ë¥•');
                }
                
                const endpoints = result.data || [];
                
                // ÂêéÁ´ØÂ∑≤ÁªèÊåâÁ´ØÁÇπÂíåÊñπÊ≥ïÂàÜÁªÑÔºåÁõ¥Êé•‰ΩøÁî®Âπ∂ÊéíÂ∫è
                const sortedEndpoints = endpoints.sort((a, b) => (b.total_calls || 0) - (a.total_calls || 0));
                
                if (sortedEndpoints.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" style="padding: 40px 20px; text-align: center; color: var(--text-secondary);">ÊöÇÊó†Êï∞ÊçÆ</td></tr>';
                } else {
                    tableBody.innerHTML = sortedEndpoints.map(endpoint => {
                        const method = endpoint.method || '-';
                        const methodBadge = method !== '-' ? `<span style="display: inline-block; padding: 4px 10px; background: ${method === 'GET' ? '#4CAF50' : method === 'POST' ? '#2196F3' : method === 'PUT' ? '#FF9800' : method === 'DELETE' ? '#F44336' : '#9E9E9E'}; color: white; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase;">${method}</span>` : '-';
                        const userCount = endpoint.user_count || endpoint.unique_users || 0;
                        const lastCalledValue = endpoint.last_called_at || endpoint.last_called;
                        const lastCalled = lastCalledValue ? new Date(lastCalledValue).toLocaleString('zh-CN') : '-';
                        const formattedCalls = (endpoint.total_calls || 0).toLocaleString('zh-CN');
                        return `
                            <tr style="border-bottom: 1px solid var(--border-color); transition: background-color 0.2s;" 
                                onmouseover="this.style.backgroundColor='var(--bg-secondary)'" 
                                onmouseout="this.style.backgroundColor='transparent'">
                                <td style="padding: 14px 16px; font-family: 'Courier New', monospace; color: var(--text-primary);">${escapeHtml(endpoint.endpoint)}</td>
                                <td style="padding: 14px 16px; text-align: center;">${methodBadge}</td>
                                <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">${formattedCalls}</td>
                                <td style="padding: 14px 16px; text-align: right; color: var(--text-secondary);">${userCount}</td>
                                <td style="padding: 14px 16px; color: var(--text-secondary); font-size: 13px;">${lastCalled}</td>
                                <td style="padding: 14px 16px; text-align: center;">
                                    <button onclick="showEndpointDetail('${escapeHtml(endpoint.endpoint.replace(/'/g, "\'"))}')" class="btn-secondary" style="padding: 8px 16px; font-size: 13px; border-radius: 6px; transition: all 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">Êü•ÁúãËØ¶ÊÉÖ</button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('Âä†ËΩΩÁ´ØÁÇπÂàóË°®Â§±Ë¥•:', error);
                tableBody.innerHTML = `<tr><td colspan="6" style="padding: 20px; text-align: center; color: var(--error-text);">Âä†ËΩΩÂ§±Ë¥•: ${escapeHtml(error.message)}</td></tr>`;
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // ÊòæÁ§∫Á´ØÁÇπËØ¶ÊÉÖ
        function showEndpointDetail(endpoint) {
            alert('Á´ØÁÇπËØ¶ÊÉÖ: ' + endpoint + '\n\nÔºàËØ¶ÊÉÖÂäüËÉΩÂæÖÂÆûÁé∞Ôºâ');
        }
        
        // ËøáÊª§Á´ØÁÇπ
        function filterEndpoints() {
            const searchTerm = document.getElementById('endpointSearch')?.value.toLowerCase() || '';
            const table = document.getElementById('allEndpointsTable');
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // ÊòæÁ§∫ÈîôËØØÊ∂àÊÅØ
        function showApiStatsError(message) {
            const errorDiv = document.getElementById('apiStatsError');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // ============ MySQLÁÆ°ÁêÜÂäüËÉΩ ============
        async function initMysqlManagementPage() {
            await loadMysqlConfig();
            await checkMysqlStatus();
        }
        
        async function loadMysqlConfig() {
            try {
                const response = await fetch('/api/mysql/config', { credentials: 'same-origin' });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: `HTTPÈîôËØØ: ${response.status}` }));
                    throw new Error(errorData.error || 'Ëé∑ÂèñMySQLÈÖçÁΩÆÂ§±Ë¥•');
                }
                const result = await response.json();
                if (result.success) {
                    const config = result.data || {};
                    document.getElementById('mysqlHost').value = config.mysql_host || '';
                    document.getElementById('mysqlPort').value = config.mysql_port || '3306';
                    document.getElementById('mysqlUser').value = config.mysql_user || '';
                    document.getElementById('mysqlPassword').value = '';
                    document.getElementById('mysqlDatabase').value = config.mysql_database || '';
                    document.getElementById('mysqlCharset').value = config.mysql_charset || 'utf8mb4';
                } else {
                    throw new Error(result.error || 'Ëé∑ÂèñÈÖçÁΩÆÂ§±Ë¥•');
                }
            } catch (error) {
                showMysqlError('Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•: ' + error.message);
            }
        }
        
        async function saveMysqlConfig() {
            try {
                const config = {
                    mysql_host: document.getElementById('mysqlHost').value,
                    mysql_port: document.getElementById('mysqlPort').value,
                    mysql_user: document.getElementById('mysqlUser').value,
                    mysql_password: document.getElementById('mysqlPassword').value,
                    mysql_database: document.getElementById('mysqlDatabase').value,
                    mysql_charset: document.getElementById('mysqlCharset').value
                };
                const response = await fetch('/api/mysql/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'same-origin',
                    body: JSON.stringify(config)
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: `HTTPÈîôËØØ: ${response.status}` }));
                    throw new Error(errorData.error || `‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•: ${response.status}`);
                }
                
                const result = await response.json();
                if (result.success) {
                    showMysqlSuccess('MySQLÈÖçÁΩÆÂ∑≤‰øùÂ≠ò');
                    document.getElementById('mysqlPassword').value = '';
                } else {
                    throw new Error(result.error || '‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•');
                }
            } catch (error) {
                showMysqlError('‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•: ' + error.message);
            }
        }
        
        async function testMysqlConnection() {
            try {
                const config = {
                    mysql_host: document.getElementById('mysqlHost').value,
                    mysql_port: document.getElementById('mysqlPort').value,
                    mysql_user: document.getElementById('mysqlUser').value,
                    mysql_password: document.getElementById('mysqlPassword').value,
                    mysql_database: document.getElementById('mysqlDatabase').value,
                    mysql_charset: document.getElementById('mysqlCharset').value
                };
                const response = await fetch('/api/mysql/test-connection', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'same-origin',
                    body: JSON.stringify(config)
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: `HTTPÈîôËØØ: ${response.status}` }));
                    throw new Error(errorData.error || `ËØ∑Ê±ÇÂ§±Ë¥•: ${response.status}`);
                }
                
                const result = await response.json();
                if (result.success) {
                    showMysqlSuccess('MySQLËøûÊé•ÊµãËØïÊàêÂäü');
                } else {
                    throw new Error(result.error || 'ËøûÊé•ÊµãËØïÂ§±Ë¥•');
                }
            } catch (error) {
                showMysqlError('ËøûÊé•ÊµãËØïÂ§±Ë¥•: ' + error.message);
            }
        }
        
        async function checkMysqlStatus() {
            try {
                const response = await fetch('/api/mysql/status', { credentials: 'same-origin' });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP Error: ${response.status} - ${errorText}`);
                }
                const result = await response.json();
                if (result.success) {
                    const status = result.data;
                    const statusText = document.getElementById('mysqlStatusText');
                    const statusMessage = document.getElementById('mysqlStatusMessage');
                    
                    if (status.connected) {
                        statusText.textContent = 'Â∑≤ËøûÊé•';
                        statusText.style.color = '#10b981';
                        statusMessage.textContent = `‰∏ªÊú∫: ${status.host}:${status.port} | Êï∞ÊçÆÂ∫ì: ${status.database}`;
                        statusMessage.style.color = 'var(--text-secondary)';
                    } else {
                        statusText.textContent = 'Êú™ËøûÊé•';
                        statusText.style.color = '#ef4444';
                        statusMessage.textContent = status.message || 'ËøûÊé•Â§±Ë¥•';
                        statusMessage.style.color = '#ef4444';
                    }
                } else {
                    throw new Error(result.error || 'Ëé∑ÂèñÁä∂ÊÄÅÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('Ê£ÄÊü•MySQLÁä∂ÊÄÅÂ§±Ë¥•:', error);
                const statusText = document.getElementById('mysqlStatusText');
                const statusMessage = document.getElementById('mysqlStatusMessage');
                if (statusText) {
                    statusText.textContent = 'ÈîôËØØ';
                    statusText.style.color = '#ef4444';
                }
                if (statusMessage) {
                    statusMessage.textContent = 'Ëé∑ÂèñÁä∂ÊÄÅÂ§±Ë¥•: ' + error.message;
                    statusMessage.style.color = '#ef4444';
                }
            }
        }
        
        function showMysqlError(message) {
            const errorDiv = document.getElementById('mysqlError');
            const successDiv = document.getElementById('mysqlSuccess');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                if (successDiv) successDiv.style.display = 'none';
                setTimeout(() => { errorDiv.style.display = 'none'; }, 5000);
            }
        }
        
        function showMysqlSuccess(message) {
            const errorDiv = document.getElementById('mysqlError');
            const successDiv = document.getElementById('mysqlSuccess');
            if (successDiv) {
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                if (errorDiv) errorDiv.style.display = 'none';
                setTimeout(() => { successDiv.style.display = 'none'; }, 5000);
            }
        }
    
    </script>
</body>
</html>
