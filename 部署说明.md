# Bandix Monitor - Ubuntu 24.04 éƒ¨ç½²å®Œæ•´æŒ‡å—

## ğŸ“¦ å·²å®Œæˆçš„ä¼˜åŒ–å’Œéƒ¨ç½²æ–‡ä»¶

### 1. éƒ¨ç½²æ–‡æ¡£
- âœ… `DEPLOY_UBUNTU.md` - å®Œæ•´çš„ Ubuntu 24.04 éƒ¨ç½²æŒ‡å—
- âœ… `QUICK_START_UBUNTU.md` - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

### 2. éƒ¨ç½²è„šæœ¬å’Œé…ç½®
- âœ… `deploy.sh` - è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼ˆä¸€é”®éƒ¨ç½²ï¼‰
- âœ… `deploy/systemd/bandix-monitor.service` - systemd æœåŠ¡é…ç½®
- âœ… `deploy/nginx/bandix-monitor.conf` - Nginx åå‘ä»£ç†é…ç½®
- âœ… `deploy/gunicorn_config.py` - Gunicorn ç”Ÿäº§ç¯å¢ƒé…ç½®
- âœ… `deploy/optimize_production.py` - ç”Ÿäº§ç¯å¢ƒé…ç½®æ£€æŸ¥è„šæœ¬

### 3. ä»£ç ä¼˜åŒ–
- âœ… ä¼˜åŒ–äº† `app/bandix_api.py`ï¼Œæ ¹æ®ç¯å¢ƒå˜é‡è‡ªåŠ¨åˆ‡æ¢å¼€å‘/ç”Ÿäº§æ¨¡å¼
- âœ… ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨å¯ç”¨æ¨¡æ¿ç¼“å­˜å’Œé™æ€æ–‡ä»¶ç¼“å­˜
- âœ… ç”Ÿäº§ç¯å¢ƒç¦ç”¨ JSON ç¾åŒ–ä»¥æé«˜æ€§èƒ½
- âœ… æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½® SECRET_KEY

## ğŸš€ éƒ¨ç½²æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šè‡ªåŠ¨åŒ–è„šæœ¬éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨
cd /opt
sudo git clone <your-repo> bandix-monitor
# æˆ–ä½¿ç”¨ scp ä¸Šä¼ 

# 2. è¿è¡Œéƒ¨ç½²è„šæœ¬
cd /opt/bandix-monitor
sudo chmod +x deploy.sh
sudo ./deploy.sh
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ `DEPLOY_UBUNTU.md` æˆ– `QUICK_START_UBUNTU.md`

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åœ¨ systemd æœåŠ¡æ–‡ä»¶ä¸­è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```ini
Environment="FLASK_ENV=production"
Environment="SECRET_KEY=your-secret-key-here"
Environment="DEBUG=false"
```

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

1. **æ¨¡æ¿ç¼“å­˜**ï¼šç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨å¯ç”¨ï¼Œæé«˜æ€§èƒ½
2. **é™æ€æ–‡ä»¶ç¼“å­˜**ï¼šè®¾ç½® 1 å¹´ç¼“å­˜æ—¶é—´
3. **JSON è¾“å‡º**ï¼šç¦ç”¨ç¾åŒ–ï¼Œå‡å°‘å“åº”å¤§å°
4. **Gunicorn å·¥ä½œè¿›ç¨‹**ï¼šè‡ªåŠ¨æ ¹æ® CPU æ ¸å¿ƒæ•°é…ç½®

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰è¯·ç¡®è®¤ï¼š

- [ ] å·²å®‰è£… Python 3.10+
- [ ] å·²å®‰è£… MySQLï¼ˆå¦‚æœä½¿ç”¨ï¼‰
- [ ] å·²é…ç½® `app/config/bandix_config.ini`
- [ ] å·²è®¾ç½® SECRET_KEY ç¯å¢ƒå˜é‡
- [ ] å·²ä¿®æ”¹é»˜è®¤ API Key
- [ ] å·²ä¿®æ”¹æ•°æ®åº“å¯†ç 
- [ ] å·²é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] å·²é…ç½® SSL è¯ä¹¦ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

## ğŸ” éªŒè¯éƒ¨ç½²

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status bandix-monitor

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 5000

# 3. æµ‹è¯• API
curl http://localhost:5000/health

# 4. æ£€æŸ¥æ—¥å¿—
sudo journalctl -u bandix-monitor -n 50
tail -f /opt/bandix-monitor/logs/app.log
```

## ğŸ› ï¸ å¸¸ç”¨æ“ä½œ

### å¯åŠ¨/åœæ­¢æœåŠ¡

```bash
sudo systemctl start bandix-monitor
sudo systemctl stop bandix-monitor
sudo systemctl restart bandix-monitor
sudo systemctl status bandix-monitor
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# systemd æ—¥å¿—
sudo journalctl -u bandix-monitor -f

# åº”ç”¨æ—¥å¿—
tail -f /opt/bandix-monitor/logs/app.log
tail -f /opt/bandix-monitor/logs/app_error.log

# Gunicorn æ—¥å¿—
tail -f /opt/bandix-monitor/logs/gunicorn_access.log
tail -f /opt/bandix-monitor/logs/gunicorn_error.log
```

### æ›´æ–°åº”ç”¨

```bash
# 1. åœæ­¢æœåŠ¡
sudo systemctl stop bandix-monitor

# 2. å¤‡ä»½
sudo cp -r /opt/bandix-monitor /opt/bandix-monitor.backup

# 3. æ›´æ–°ä»£ç 
cd /opt/bandix-monitor
sudo -u bandix git pull  # æˆ–ä¸Šä¼ æ–°æ–‡ä»¶

# 4. æ›´æ–°ä¾èµ–
sudo -u bandix ./venv/bin/pip install -r requirements.txt --upgrade

# 5. é‡å¯æœåŠ¡
sudo systemctl start bandix-monitor
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç å’Œå¯†é’¥**
   - ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ API Key
   - ä¿®æ”¹æ•°æ®åº“å¯†ç 
   - è®¾ç½®å¼º SECRET_KEY

2. **å¯ç”¨ HTTPS**
   ```bash
   sudo apt install certbot python3-certbot-nginx
   sudo certbot --nginx -d your-domain.com
   ```

3. **é…ç½®é˜²ç«å¢™**
   ```bash
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   sudo ufw enable
   ```

4. **å®šæœŸå¤‡ä»½**
   - å¯ç”¨è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½
   - å®šæœŸæ£€æŸ¥å¤‡ä»½æ–‡ä»¶
   - æµ‹è¯•å¤‡ä»½æ¢å¤æµç¨‹

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### Gunicorn å·¥ä½œè¿›ç¨‹æ•°

åœ¨ `deploy/systemd/bandix-monitor.service` ä¸­è°ƒæ•´ï¼š

```ini
ExecStart=... --workers 4 ...
```

æ¨èå…¬å¼ï¼š`workers = (CPU æ ¸å¿ƒæ•° Ã— 2) + 1`

### æ•°æ®åº“ä¼˜åŒ–

1. å®šæœŸæ¸…ç†æ—§æ•°æ®
2. ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•
3. ä½¿ç”¨è¿æ¥æ± 

### Nginx ç¼“å­˜

åœ¨ Nginx é…ç½®ä¸­å¯ç”¨é™æ€æ–‡ä»¶ç¼“å­˜ï¼ˆå·²é…ç½®ï¼‰

## ğŸ› æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
sudo journalctl -u bandix-monitor -n 100 --no-pager

# æ£€æŸ¥é…ç½®æ–‡ä»¶
sudo -u bandix /opt/bandix-monitor/venv/bin/python3 -c "from app.services.config_manager import load_config_file; load_config_file()"
```

### Nginx 502 é”™è¯¯

```bash
# æ£€æŸ¥ Gunicorn æ˜¯å¦è¿è¡Œ
sudo systemctl status bandix-monitor

# æ£€æŸ¥ç«¯å£
sudo netstat -tlnp | grep 5000

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/bandix-monitor_error.log
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ MySQL æœåŠ¡
sudo systemctl status mysql

# æµ‹è¯•è¿æ¥
mysql -u hanbo -p -h localhost bandix_monitor
```

## ğŸ“ è·å–å¸®åŠ©

- æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š`DEPLOY_UBUNTU.md`
- æŸ¥çœ‹å¿«é€ŸæŒ‡å—ï¼š`QUICK_START_UBUNTU.md`
- æ£€æŸ¥é…ç½®ï¼šè¿è¡Œ `python deploy/optimize_production.py`

## ğŸ“ æ–‡ä»¶ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ deploy.sh                          # è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ DEPLOY_UBUNTU.md                   # å®Œæ•´éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ QUICK_START_UBUNTU.md              # å¿«é€Ÿéƒ¨ç½²æŒ‡å—
â”œâ”€â”€ éƒ¨ç½²è¯´æ˜.md                        # æœ¬æ–‡ä»¶
â”œâ”€â”€ deploy/
â”‚   â”œâ”€â”€ systemd/
â”‚   â”‚   â””â”€â”€ bandix-monitor.service    # systemd æœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ nginx/
â”‚   â”‚   â””â”€â”€ bandix-monitor.conf       # Nginx é…ç½®
â”‚   â”œâ”€â”€ gunicorn_config.py            # Gunicorn é…ç½®
â”‚   â”œâ”€â”€ optimize_production.py         # é…ç½®æ£€æŸ¥è„šæœ¬
â”‚   â””â”€â”€ README.md                      # éƒ¨ç½²é…ç½®è¯´æ˜
â””â”€â”€ app/
    â””â”€â”€ bandix_api.py                  # å·²ä¼˜åŒ–çš„ Flask åº”ç”¨
```

---

**æ³¨æ„**ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œè¯·åŠ¡å¿…ï¼š
1. ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç å’Œå¯†é’¥
2. é…ç½® SSL è¯ä¹¦
3. è®¾ç½®é˜²ç«å¢™è§„åˆ™
4. å¯ç”¨è‡ªåŠ¨å¤‡ä»½
5. é…ç½®ç›‘æ§å’Œå‘Šè­¦

